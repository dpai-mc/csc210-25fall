<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 11: Control Unit Design - Interactive Assignment</title>
    
    <!-- Chosen Palette: Scholarly Neutrals -->
    <!-- Application Structure Plan: This streamlined assignment focuses on core control unit concepts: control signal generation, instruction execution tracing, and architectural trade-offs. Students complete one detailed instruction trace, compare control approaches, and design a simple FSM. -->
    <!-- Visualization & Content Choices: Interactive text inputs for control signals, step-by-step instruction tracing with guidance, comparison analysis, and FSM design. All elements provide clear structure to support efficient learning. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter and Fira Code -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #383838;
        }
        
        .worksheet-input {
            font-family: 'Fira Code', monospace;
            border: 1px solid #D1C7BF;
            background-color: #FFFFFF;
            padding: 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
        }
        
        .worksheet-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        
        .submit-btn {
            background-color: #4A90E2;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .submit-btn:hover {
            background-color: #357ABD;
        }
        
        .code-block {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            font-family: 'Fira Code', monospace;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #383838;
        }
        
        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #383838;
        }
        
        .section-container {
            background-color: white;
            border: 1px solid #EADDD7;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            border: 1px solid #D1C7BF;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background-color: #EADDD7;
            font-weight: 600;
        }
        
        .instruction-step {
            background-color: #f9f9f9;
            border-left: 4px solid #4A90E2;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .no-print {
                display: none !important;
            }
            
            .section-container {
                page-break-inside: avoid;
                border: 1px solid #ccc;
            }
            
            .worksheet-input {
                border: none;
                border-bottom: 1px solid #000;
                background-color: transparent;
            }
            
            h1, h2, h3 {
                page-break-after: avoid;
            }
            
            .print-answer {
                display: block !important;
                margin-top: 0.5rem;
                font-family: 'Fira Code', monospace;
                color: #000;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            
            .print-answer span {
                display: inline !important;
            }
        }
        
        .print-answer {
            display: none;
        }
        
        .print-answer span {
            display: none;
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body class="antialiased">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:p-2 focus:bg-white focus:border focus:border-gray-800">Skip to main content</a>
    
    <main id="main-content" class="max-w-4xl mx-auto p-4 md:p-8">
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">Week 11: Control Unit Design</h1>
            <p class="text-lg text-gray-700 mb-4">Interactive Assignment - CSC210 Computer Organization & Architecture</p>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                <p class="font-semibold mb-2">Assignment Overview</p>
                <p class="text-sm">This assignment covers essential control unit design principles including control signal generation, instruction execution cycles, and architectural trade-offs. Complete all sections and use the "Save as PDF" button at the bottom to submit your work.</p>
                <p class="text-sm mt-2"><strong>Estimated Time:</strong> 2-4 hours</p>
                <p class="text-sm mt-2"><strong>Total Points:</strong> 100</p>
            </div>
            
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                <p class="font-semibold mb-2">Instructions</p>
                <ul class="text-sm space-y-1 list-disc list-inside">
                    <li>Complete all sections in order</li>
                    <li>Type your answers in the provided input fields</li>
                    <li>Be thorough but concise - focus on demonstrating understanding</li>
                    <li>When finished, click "Save as PDF" to generate your submission file</li>
                    <li>Your answers will be captured in the PDF even if they extend beyond textbox boundaries</li>
                </ul>
            </div>
        </header>

        <!-- Section 1: Control Signal Fundamentals -->
        <section class="section-container">
            <h2>Section 1: Control Signal Fundamentals (20 points)</h2>
            <p class="mb-4">Control signals coordinate all CPU components. Understanding their purpose and timing is essential.</p>
            
            <div class="mb-4">
                <label for="signal-purpose" class="block font-semibold mb-2">1. Explain the role of control signals in CPU operation. What does the control unit do with these signals? (5 points)</label>
                <textarea id="signal-purpose" class="worksheet-input" rows="4" placeholder="Describe the overall purpose and function of control signals..."></textarea>
                <div class="print-answer" id="print-signal-purpose"></div>
            </div>
            
            <div class="mb-4">
                <label for="signal-examples" class="block font-semibold mb-2">2. For each of the following control signals, briefly describe its purpose: (6 points - 2 points each)</label>
                
                <div class="ml-4 mb-3">
                    <p class="font-medium mb-1">a) PC_OUT</p>
                    <input type="text" id="signal-pc-out" class="worksheet-input" placeholder="Purpose of PC_OUT...">
                    <div class="print-answer" id="print-signal-pc-out"></div>
                </div>
                
                <div class="ml-4 mb-3">
                    <p class="font-medium mb-1">b) ALU_OP</p>
                    <input type="text" id="signal-alu-op" class="worksheet-input" placeholder="Purpose of ALU_OP...">
                    <div class="print-answer" id="print-signal-alu-op"></div>
                </div>
                
                <div class="ml-4 mb-3">
                    <p class="font-medium mb-1">c) MEM_READ</p>
                    <input type="text" id="signal-mem-read" class="worksheet-input" placeholder="Purpose of MEM_READ...">
                    <div class="print-answer" id="print-signal-mem-read"></div>
                </div>
            </div>
            
            <div class="mb-4">
                <label for="bus-contention" class="block font-semibold mb-2">3. What is bus contention and why must the control unit prevent it? Provide a specific example of signals that would cause bus contention if asserted simultaneously. (9 points)</label>
                <textarea id="bus-contention" class="worksheet-input" rows="6" placeholder="Define bus contention, explain why it's a problem, and provide an example..."></textarea>
                <div class="print-answer" id="print-bus-contention"></div>
            </div>
        </section>

        <!-- Section 2: Instruction Execution Tracing -->
        <section class="section-container">
            <h2>Section 2: Instruction Execution Cycle (30 points)</h2>
            <p class="mb-4">Trace the complete execution of a LOAD instruction through all phases, specifying control signals for each cycle.</p>
            
            <div class="bg-gray-50 border border-gray-300 p-4 mb-4 rounded">
                <p class="font-semibold mb-2">Instruction to Trace:</p>
                <p class="code-block inline">LOAD R1, [0x2000]</p>
                <p class="text-sm mt-2">This instruction loads the value from memory address 0x2000 into register R1.</p>
            </div>
            
            <div class="instruction-step mb-4">
                <h3 class="font-semibold mb-2">FETCH Phase</h3>
                <label for="fetch-trace" class="block mb-2">4. List all control signals needed during the FETCH phase. For EACH signal, explain what it accomplishes. Break this into Cycle 1 and Cycle 2 if needed. (10 points)</label>
                <textarea id="fetch-trace" class="worksheet-input" rows="8" placeholder="Cycle 1: 
  PC_OUT - [explain what this does]
  MAR_LOAD - [explain what this does]
  
Cycle 2:
  [list signals and explanations]"></textarea>
                <div class="print-answer" id="print-fetch-trace"></div>
            </div>
            
            <div class="instruction-step mb-4">
                <h3 class="font-semibold mb-2">DECODE Phase</h3>
                <label for="decode-trace" class="block mb-2">5. What happens during the DECODE phase for this LOAD instruction? What parts of the instruction register are accessed? (5 points)</label>
                <textarea id="decode-trace" class="worksheet-input" rows="4" placeholder="Describe the decode process..."></textarea>
                <div class="print-answer" id="print-decode-trace"></div>
            </div>
            
            <div class="instruction-step mb-4">
                <h3 class="font-semibold mb-2">EXECUTE Phase</h3>
                <label for="execute-trace" class="block mb-2">6. Break down the EXECUTE phase cycle-by-cycle. For each cycle, list the control signals and describe the data flow. (10 points)</label>
                <textarea id="execute-trace" class="worksheet-input" rows="8" placeholder="Execute Cycle 1:
  Signals: [list]
  Data flow: [describe what data moves where]
  
Execute Cycle 2:
  Signals: [list]
  Data flow: [describe]"></textarea>
                <div class="print-answer" id="print-execute-trace"></div>
            </div>
            
            <div class="mb-4">
                <label for="cycle-count" class="block font-semibold mb-2">7. How many total clock cycles does this LOAD instruction require? Why do memory-accessing instructions typically require more cycles than register-only instructions like ADD? (5 points)</label>
                <textarea id="cycle-count" class="worksheet-input" rows="4" placeholder="Total cycles: [number]
Explanation: [why memory instructions take longer]"></textarea>
                <div class="print-answer" id="print-cycle-count"></div>
            </div>
        </section>

        <!-- Section 3: Control Unit Design Approaches -->
        <section class="section-container">
            <h2>Section 3: Hardwired vs. Microprogrammed Control (25 points)</h2>
            <p class="mb-4">Compare the two fundamental approaches to control unit design.</p>
            
            <div class="mb-4">
                <label class="block font-semibold mb-2">8. Complete the comparison table: (15 points)</label>
                <table>
                    <thead>
                        <tr>
                            <th>Characteristic</th>
                            <th>Hardwired Control</th>
                            <th>Microprogrammed Control</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Implementation</strong><br><span class="text-sm text-gray-600">How is it built?</span></td>
                            <td><textarea id="comp-hw-impl" class="worksheet-input" rows="2" placeholder="How hardwired is implemented..."></textarea></td>
                            <td><textarea id="comp-micro-impl" class="worksheet-input" rows="2" placeholder="How microprogrammed is implemented..."></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>Speed</strong><br><span class="text-sm text-gray-600">Which is faster and why?</span></td>
                            <td><textarea id="comp-hw-speed" class="worksheet-input" rows="2" placeholder="Speed characteristics..."></textarea></td>
                            <td><textarea id="comp-micro-speed" class="worksheet-input" rows="2" placeholder="Speed characteristics..."></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>Flexibility</strong><br><span class="text-sm text-gray-600">Can it be modified?</span></td>
                            <td><textarea id="comp-hw-flex" class="worksheet-input" rows="2" placeholder="Flexibility..."></textarea></td>
                            <td><textarea id="comp-micro-flex" class="worksheet-input" rows="2" placeholder="Flexibility..."></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>Best Use Case</strong><br><span class="text-sm text-gray-600">When to use each?</span></td>
                            <td><textarea id="comp-hw-use" class="worksheet-input" rows="2" placeholder="When to use hardwired..."></textarea></td>
                            <td><textarea id="comp-micro-use" class="worksheet-input" rows="2" placeholder="When to use microprogrammed..."></textarea></td>
                        </tr>
                    </tbody>
                </table>
                <div class="print-answer">
                    <p><strong>Hardwired Implementation:</strong> <span id="print-comp-hw-impl"></span></p>
                    <p><strong>Microprogrammed Implementation:</strong> <span id="print-comp-micro-impl"></span></p>
                    <p><strong>Hardwired Speed:</strong> <span id="print-comp-hw-speed"></span></p>
                    <p><strong>Microprogrammed Speed:</strong> <span id="print-comp-micro-speed"></span></p>
                    <p><strong>Hardwired Flexibility:</strong> <span id="print-comp-hw-flex"></span></p>
                    <p><strong>Microprogrammed Flexibility:</strong> <span id="print-comp-micro-flex"></span></p>
                    <p><strong>Hardwired Use Case:</strong> <span id="print-comp-hw-use"></span></p>
                    <p><strong>Microprogrammed Use Case:</strong> <span id="print-comp-micro-use"></span></p>
                </div>
            </div>
            
            <div class="mb-4">
                <label for="design-choice" class="block font-semibold mb-2">9. Design Scenario: You're designing a high-performance gaming console processor. The instruction set is fixed and will never change, but execution speed is critical for rendering graphics in real-time. Which control unit design would you choose and why? Justify your answer using at least three specific factors from your comparison above. (10 points)</label>
                <textarea id="design-choice" class="worksheet-input" rows="7" placeholder="Choice: [Hardwired or Microprogrammed]

Justification:
1. [Factor 1 and explanation]
2. [Factor 2 and explanation]
3. [Factor 3 and explanation]"></textarea>
                <div class="print-answer" id="print-design-choice"></div>
            </div>
        </section>

        <!-- Section 4: FSM and Multi-Cycle Control -->
        <section class="section-container">
            <h2>Section 4: Finite State Machine Design (15 points)</h2>
            <p class="mb-4">Design a simplified FSM for instruction execution control.</p>
            
            <div class="mb-4">
                <label for="fsm-basics" class="block font-semibold mb-2">10. Explain why a Finite State Machine (FSM) is an appropriate model for a control unit. What does each state represent? What causes state transitions? (5 points)</label>
                <textarea id="fsm-basics" class="worksheet-input" rows="5" placeholder="Explain FSM appropriateness, state meaning, and transition causes..."></textarea>
                <div class="print-answer" id="print-fsm-basics"></div>
            </div>
            
            <div class="mb-4">
                <label for="fsm-design" class="block font-semibold mb-2">11. Design a simple FSM for executing an ADD instruction: <code class="inline code-block">ADD R3, R1, R2</code> (R3 = R1 + R2)</label>
                <p class="text-sm text-gray-600 mb-2">For each state, specify:</p>
                <ul class="text-sm list-disc list-inside mb-2 text-gray-600">
                    <li>State name or number</li>
                    <li>Which control signals are active</li>
                    <li>What the next state is</li>
                </ul>
                <p class="text-sm text-gray-600 mb-2"><strong>Start your FSM AFTER the FETCH phase is complete</strong> (assume you begin in state where IR contains the ADD instruction). (10 points)</p>
                <textarea id="fsm-design" class="worksheet-input" rows="10" placeholder="State 0 (DECODE): 
  Signals: [list]
  Next state: State 1
  
State 1 (EXECUTE-READ-R1):
  Signals: [list]
  Next state: State 2
  
[Continue with all necessary states...]"></textarea>
                <div class="print-answer" id="print-fsm-design"></div>
            </div>
        </section>

        <!-- Section 5: Critical Thinking -->
        <section class="section-container">
            <h2>Section 5: Critical Analysis (10 points)</h2>
            
            <div class="mb-4">
                <label for="critical-thinking" class="block font-semibold mb-2">12. A student proposes: "Why don't we just make every instruction execute in exactly one clock cycle? That would simplify the control unit and make everything faster!"</label>
                <p class="text-sm text-gray-600 mb-2">Explain why this proposal is not practical. Your answer should address:</p>
                <ul class="text-sm list-disc list-inside mb-2 text-gray-600">
                    <li>Why different instructions require different amounts of time</li>
                    <li>The clock period constraint problem</li>
                    <li>Resource conflicts that would arise</li>
                </ul>
                <textarea id="critical-thinking" class="worksheet-input" rows="8" placeholder="Explain the problems with single-cycle execution..."></textarea>
                <div class="print-answer" id="print-critical-thinking"></div>
            </div>
        </section>

        <!-- Reflection Section -->
        <section class="section-container">
            <h2>Reflection Questions (Optional - Not Graded)</h2>
            <p class="mb-4">These questions help consolidate your learning. Responses are optional.</p>
            
            <div class="mb-4">
                <label for="reflect1" class="block font-semibold mb-2">What was the most challenging concept in this assignment?</label>
                <textarea id="reflect1" class="worksheet-input" rows="2" placeholder="Optional reflection..."></textarea>
                <div class="print-answer" id="print-reflect1"></div>
            </div>
            
            <div class="mb-4">
                <label for="reflect2" class="block font-semibold mb-2">How has your understanding of how CPUs work changed after learning about control units?</label>
                <textarea id="reflect2" class="worksheet-input" rows="2" placeholder="Optional reflection..."></textarea>
                <div class="print-answer" id="print-reflect2"></div>
            </div>
        </section>

        <!-- Student Information -->
        <section class="section-container">
            <h2>Student Information</h2>
            <div class="mb-4">
                <label for="student-name" class="block font-semibold mb-2">Name:</label>
                <input type="text" id="student-name" class="worksheet-input" placeholder="Enter your full name">
                <div class="print-answer" id="print-student-name"></div>
            </div>
            <div class="mb-4">
                <label for="student-id" class="block font-semibold mb-2">Student ID:</label>
                <input type="text" id="student-id" class="worksheet-input" placeholder="Enter your student ID">
                <div class="print-answer" id="print-student-id"></div>
            </div>
            <div class="mb-4">
                <label for="date-completed" class="block font-semibold mb-2">Date Completed:</label>
                <input type="date" id="date-completed" class="worksheet-input">
                <div class="print-answer" id="print-date-completed"></div>
            </div>
        </section>

        <!-- Submission Button -->
        <div class="text-center mt-8 mb-8 no-print">
            <button onclick="testCapture()" class="check-btn mr-4">
                Test Answer Capture
            </button>
            <button onclick="preparePrintAndSave()" class="submit-btn">
                Save as PDF for Submission
            </button>
            <p class="text-sm text-gray-600 mt-2">Click "Test Answer Capture" first to verify all answers are captured. Then click "Save as PDF" when ready to submit.</p>
            <div id="capture-status" class="mt-4 text-sm"></div>
        </div>

        <footer class="text-center text-sm text-gray-600 mt-8 border-t border-gray-300 pt-4 no-print">
            <p>CSC210 Computer Organization & Architecture - Week 11 Assignment</p>
            <p class="mt-2">© 2024 - For educational use only</p>
        </footer>
    </main>

    <script>
        // Test function to verify all answers are captured
        function testCapture() {
            const allInputs = document.querySelectorAll('input[id], textarea[id]');
            let capturedCount = 0;
            let missingCount = 0;
            let emptyCount = 0;
            let missingElements = [];
            
            allInputs.forEach(input => {
                if (input.id) {
                    const printElement = document.getElementById('print-' + input.id);
                    
                    if (!printElement) {
                        missingCount++;
                        missingElements.push(input.id);
                    } else if (!input.value || input.value.trim() === '') {
                        emptyCount++;
                    } else {
                        capturedCount++;
                    }
                }
            });
            
            const statusDiv = document.getElementById('capture-status');
            let statusHTML = `<div class="p-4 rounded border ${missingCount > 0 ? 'bg-red-50 border-red-500' : 'bg-green-50 border-green-500'}">`;
            statusHTML += `<p class="font-semibold mb-2">Answer Capture Test Results:</p>`;
            statusHTML += `<p>✓ ${capturedCount} questions answered and ready to print</p>`;
            statusHTML += `<p>○ ${emptyCount} questions not yet answered</p>`;
            
            if (missingCount > 0) {
                statusHTML += `<p class="text-red-600 font-semibold">✗ ${missingCount} questions cannot be captured (technical issue)</p>`;
                statusHTML += `<p class="text-sm mt-2">Missing print elements for: ${missingElements.join(', ')}</p>`;
            } else {
                statusHTML += `<p class="text-green-600 font-semibold mt-2">✓ All fields are properly configured for printing!</p>`;
            }
            
            statusHTML += `</div>`;
            statusDiv.innerHTML = statusHTML;
            
            // Scroll to status
            statusDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Capture all input values for printing
        function preparePrintAndSave() {
            // Get ALL inputs and textareas that have an ID
            const allInputs = document.querySelectorAll('input[id], textarea[id]');
            
            console.log('Total inputs found:', allInputs.length);
            
            allInputs.forEach(input => {
                if (input.id) {
                    // Look for corresponding print element
                    const printElement = document.getElementById('print-' + input.id);
                    
                    if (printElement) {
                        // Set the text content - this works for both divs and spans
                        printElement.textContent = input.value || '[No answer provided]';
                        console.log('Captured:', input.id, '- Value length:', input.value.length);
                    } else {
                        console.warn('No print element found for:', input.id);
                    }
                }
            });
            
            // Trigger print dialog
            setTimeout(() => {
                window.print();
            }, 100); // Small delay to ensure all updates are rendered
        }
        
        // Initialize date to today
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('date-completed');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.value = today;
            }
        });
        
        // Warn before leaving if work is not saved
        let formModified = false;
        document.querySelectorAll('input, textarea').forEach(element => {
            element.addEventListener('change', function() {
                formModified = true;
            });
        });
        
        window.addEventListener('beforeunload', function(e) {
            if (formModified) {
                e.preventDefault();
                e.returnValue = '';
                return 'You have unsaved changes. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
