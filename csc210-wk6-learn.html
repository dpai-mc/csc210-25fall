<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 6: MIPS Arithmetic & Logic Instructions</title>
    
    <!-- CDN Links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Meta Comments -->
    <!-- Chosen Palette: Light background (#FDFBF8), Primary text (#383838), Primary accent (#EADDD7), Hover state (#F0EBE8) -->
    <!-- Application Structure Plan: Modular design with plug-in modules, enhanced interactivity, comprehensive MIPS instruction coverage -->
    <!-- Visualization & Content Choices: Interactive decoder, step-by-step simulator, detailed module content with examples -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    
    <!-- Embedded CSS -->
    <style>
        body {
            background-color: #FDFBF8;
            color: #383838;
            font-family: 'Inter', sans-serif;
        }
        
        .code-font {
            font-family: 'Fira Code', monospace;
        }
        
        .primary-accent {
            background-color: #EADDD7;
        }
        
        .hover-accent:hover {
            background-color: #F0EBE8;
        }
        
        .tab-active {
            background-color: #EADDD7;
            border-bottom: 2px solid #383838;
        }
        
        .code-highlight {
            background-color: #F0EBE8;
            border-left: 4px solid #EADDD7;
        }
        
        .instruction-box {
            border: 2px solid #EADDD7;
            background-color: #FDFBF8;
        }
        
        .register-display {
            background-color: #F0EBE8;
            border: 1px solid #EADDD7;
        }
        
        .module-content {
            min-height: 500px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .instruction-table {
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        
        .instruction-table th,
        .instruction-table td {
            border: 1px solid #EADDD7;
            padding: 8px;
            text-align: left;
        }
        
        .instruction-table th {
            background-color: #EADDD7;
            font-weight: 600;
        }
        
        .instruction-table tr:nth-child(even) {
            background-color: #F0EBE8;
        }
        
        .binary-display {
            font-family: 'Fira Code', monospace;
            background-color: #F0EBE8;
            border: 1px solid #EADDD7;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
        }
        
        .step-highlight {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 0.5rem;
            margin: 0.5rem 0;
        }
        
        @media print {
            .no-print { display: none; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-highlight {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { background-color: #F0EBE8; }
            50% { background-color: #EADDD7; }
        }
        
        .exercise-output {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="antialiased">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded">
        Skip to main content
    </a>

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Week 6: MIPS Arithmetic & Logic Instructions</h1>
            <p class="text-lg text-gray-600">Interactive Learning Guide</p>
            <div class="mt-4 p-4 primary-accent rounded-lg">
                <p class="font-medium">Learning Objectives: Master R-type and I-type instructions, implement arithmetic and logical operations, understand instruction encoding, and debug MIPS programs effectively.</p>
            </div>
        </header>

        <div class="mb-8 p-4 border-2 border-gray-300 rounded-lg">
            <h3 class="font-semibold mb-2">Your Progress</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="1">
                    <span class="block font-medium">Module 1</span>
                    <span class="text-sm">R-Type Instructions</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="2">
                    <span class="block font-medium">Module 2</span>
                    <span class="text-sm">I-Type Instructions</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="3">
                    <span class="block font-medium">Module 3</span>
                    <span class="text-sm">Shift Operations</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="4">
                    <span class="block font-medium">Module 4</span>
                    <span class="text-sm">Programming & Debug</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <nav class="mb-8" role="tablist">
            <div class="flex flex-wrap border-b-2 border-gray-300">
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="true" aria-controls="overview-panel" data-tab="overview">
                    Overview
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="instruction-decoder-panel" data-tab="instruction-decoder">
                    Instruction Decoder
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="simulator-panel" data-tab="simulator">
                    MIPS Simulator
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="exercises-panel" data-tab="exercises">
                    Practice Exercises
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="reference-panel" data-tab="reference">
                    Quick Reference
                </button>
            </div>
        </nav>

        <main id="main-content">
            <div id="overview-panel" class="tab-panel fade-in" role="tabpanel">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-4">Learning Modules</h2>
                        <div class="space-y-4">
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="1">
                                <h3 class="text-xl font-semibold mb-2">Module 1: R-Type Arithmetic Instructions</h3>
                                <p class="text-gray-600 mb-3">Master register-to-register operations, instruction encoding, and the complete set of R-type arithmetic and logical operations.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">3-4 hours</span>
                                    <span class="text-gray-500">Essential foundation</span>
                                </div>
                            </div>
                            
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="2">
                                <h3 class="text-xl font-semibold mb-2">Module 2: I-Type Instructions & Immediate Operands</h3>
                                <p class="text-gray-600 mb-3">Understand immediate operands, sign extension, constant loading, and all I-type instruction variants.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">3-4 hours</span>
                                    <span class="text-gray-500">Building complexity</span>
                                </div>
                            </div>
                            
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="3">
                                <h3 class="text-xl font-semibold mb-2">Module 3: Shift Operations & Bit Manipulation</h3>
                                <p class="text-gray-600 mb-3">Master logical and arithmetic shifts, rotation operations, and advanced bit manipulation techniques.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">2-3 hours</span>
                                    <span class="text-gray-500">Advanced techniques</span>
                                </div>
                            </div>
                            
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="4">
                                <h3 class="text-xl font-semibold mb-2">Module 4: Programming & Debugging</h3>
                                <p class="text-gray-600 mb-3">Convert C to MIPS, master debugging techniques, optimize performance, and handle real-world programming scenarios.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">4-5 hours</span>
                                    <span class="text-gray-500">Practical application</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div id="module-content" class="border-2 border-gray-300 rounded-lg p-6 module-content">
                            <h3 class="text-xl font-semibold mb-4">Select a Module to Begin</h3>
                            <p class="text-gray-600 mb-4">Click on any module card to view detailed content, interactive demonstrations, and hands-on exercises.</p>
                            
                            <div class="mt-6 p-4 primary-accent rounded-lg">
                                <h4 class="font-semibold mb-2">Prerequisites Check</h4>
                                <ul class="space-y-1 text-sm">
                                    <li>✓ Week 5: MIPS Architecture basics completed</li>
                                    <li>✓ Binary and hexadecimal number systems</li>
                                    <li>✓ Register file understanding</li>
                                    <li>✓ Basic C programming knowledge</li>
                                </ul>
                            </div>
                            
                            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-semibold mb-2">Learning Strategy</h4>
                                <p class="text-sm text-gray-700">Each module builds on the previous one. Complete them in order for the best learning experience. Use the simulator to test your understanding as you progress.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="instruction-decoder-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Interactive Instruction Decoder</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Enter MIPS Instruction</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="instruction-input" class="block font-medium mb-2">Assembly Instruction:</label>
                                <input type="text" id="instruction-input" 
                                       class="w-full p-3 border-2 border-gray-300 rounded code-font focus:ring-2 focus:ring-blue-500"
                                       placeholder="e.g., add $t0, $t1, $t2"
                                       aria-describedby="instruction-help">
                                <p id="instruction-help" class="text-sm text-gray-600 mt-1">Enter a MIPS assembly instruction to decode</p>
                            </div>
                            
                            <button id="decode-btn" class="w-full bg-blue-600 text-white py-3 px-6 rounded font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                                Decode Instruction
                            </button>
                            
                            <div class="space-y-2">
                                <h4 class="font-medium">Quick Examples:</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                    <button class="example-btn px-3 py-2 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="add $t0, $t1, $t2">add $t0, $t1, $t2</button>
                                    <button class="example-btn px-3 py-2 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="addi $t0, $t1, 100">addi $t0, $t1, 100</button>
                                    <button class="example-btn px-3 py-2 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="sll $t0, $t1, 4">sll $t0, $t1, 4</button>
                                    <button class="example-btn px-3 py-2 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="and $t0, $t1, $t2">and $t0, $t1, $t2</button>
                                    <button class="example-btn px-3 py-2 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="andi $t0, $t1, 0xFF">andi $t0, $t1, 0xFF</button>
                                    <button class="example-btn px-3 py-2 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="lui $t0, 0x1234">lui $t0, 0x1234</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-4">Instruction Analysis</h3>
                        <div id="decode-output" class="instruction-box p-4 rounded-lg min-h-[200px]">
                            <p class="text-gray-600">Enter an instruction to see its complete breakdown including binary encoding...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="simulator-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Interactive MIPS Simulator</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <h3 class="text-xl font-semibold mb-4">MIPS Assembly Code</h3>
                        <textarea id="code-input" 
                                  class="w-full h-64 p-4 border-2 border-gray-300 rounded code-font text-sm focus:ring-2 focus:ring-blue-500"
                                  placeholder="# Enter your MIPS code here
# Example: Calculate (5 + 3) * 2
li $t0, 5
li $t1, 3
add $t2, $t0, $t1    # $t2 = 8
sll $t3, $t2, 1      # $t3 = 16 (multiply by 2)"
                                  aria-label="MIPS assembly code input"></textarea>
                        
                        <div class="flex flex-wrap gap-4 mt-4">
                            <button id="run-btn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 focus:ring-2 focus:ring-green-500">
                                Run All
                            </button>
                            <button id="step-btn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                                Step Through
                            </button>
                            <button id="reset-btn" class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700 focus:ring-2 focus:ring-gray-500">
                                Reset
                            </button>
                            <button id="load-example-btn" class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 focus:ring-2 focus:ring-purple-500">
                                Load Example
                            </button>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-4">Registers</h3>
                        <div id="register-display" class="register-display p-4 rounded-lg text-sm code-font">
                        </div>
                        
                        <div class="mt-4">
                            <h4 class="font-semibold mb-2">Execution Status</h4>
                            <div id="execution-status" class="p-2 rounded text-sm bg-gray-100">
                                Ready to execute
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h4 class="font-semibold mb-2">Current Instruction</h4>
                            <div id="current-instruction" class="p-2 rounded text-sm bg-gray-100 code-font">
                                None
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="exercises-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Practice Exercises</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Choose an Exercise</h3>
                        <div class="space-y-4">
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="arithmetic">
                                <h4 class="font-semibold">Basic Arithmetic Operations</h4>
                                <p class="text-sm text-gray-600">Practice add, sub, and register operations with step-by-step verification</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded">Beginner</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="immediate">
                                <h4 class="font-semibold">Immediate Operations</h4>
                                <p class="text-sm text-gray-600">Work with addi, loading constants, and understanding sign extension</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Intermediate</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="bitwise">
                                <h4 class="font-semibold">Bitwise Operations</h4>
                                <p class="text-sm text-gray-600">Master and, or, xor, nor and complex bit manipulation patterns</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Intermediate</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="shifts">
                                <h4 class="font-semibold">Shift Operations</h4>
                                <p class="text-sm text-gray-600">Practice logical and arithmetic shifts for multiplication, division, and data manipulation</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded">Advanced</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="mixed">
                                <h4 class="font-semibold">Mixed Operations Challenge</h4>
                                <p class="text-sm text-gray-600">Combine multiple instruction types to solve complex problems</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded">Expert</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div id="exercise-content" class="border-2 border-gray-300 rounded-lg p-6 min-h-[400px]">
                            <h3 class="text-xl font-semibold mb-4">Select an Exercise</h3>
                            <p class="text-gray-600">Choose an exercise from the left to begin practicing. Each exercise includes guided solutions and immediate feedback.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reference-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Quick Reference</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="border-2 border-gray-300 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">R-Type Instructions</h3>
                        <div class="text-sm code-font space-y-1">
                            <div><strong>add</strong> rd, rs, rt</div>
                            <div><strong>sub</strong> rd, rs, rt</div>
                            <div><strong>and</strong> rd, rs, rt</div>
                            <div><strong>or</strong> rd, rs, rt</div>
                            <div><strong>xor</strong> rd, rs, rt</div>
                            <div><strong>nor</strong> rd, rs, rt</div>
                            <div><strong>slt</strong> rd, rs, rt</div>
                            <div><strong>sll</strong> rd, rt, shamt</div>
                            <div><strong>srl</strong> rd, rt, shamt</div>
                            <div><strong>sra</strong> rd, rt, shamt</div>
                        </div>
                    </div>

                    <div class="border-2 border-gray-300 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">I-Type Instructions</h3>
                        <div class="text-sm code-font space-y-1">
                            <div><strong>addi</strong> rt, rs, imm</div>
                            <div><strong>andi</strong> rt, rs, imm</div>
                            <div><strong>ori</strong> rt, rs, imm</div>
                            <div><strong>xori</strong> rt, rs, imm</div>
                            <div><strong>slti</strong> rt, rs, imm</div>
                            <div><strong>lui</strong> rt, imm</div>
                        </div>
                    </div>

                    <div class="border-2 border-gray-300 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">Common Registers</h3>
                        <div class="text-sm code-font space-y-1">
                            <div><strong>$t0-$t7:</strong> Temporary</div>
                            <div><strong>$s0-$s7:</strong> Saved</div>
                            <div><strong>$a0-$a3:</strong> Arguments</div>
                            <div><strong>$v0-$v1:</strong> Return values</div>
                            <div><strong>$zero:</strong> Always 0</div>
                            <div><strong>$ra:</strong> Return address</div>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">Instruction Formats</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border-2 border-gray-300 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">R-Type Format</h4>
                            <div class="binary-display">
                                op(6) | rs(5) | rt(5) | rd(5) | shamt(5) | funct(6)
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Used for register-to-register operations. Opcode = 0, function specifies operation.</p>
                        </div>
                        
                        <div class="border-2 border-gray-300 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">I-Type Format</h4>
                            <div class="binary-display">
                                op(6) | rs(5) | rt(5) | immediate(16)
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Used for immediate operations and memory access. Immediate is sign-extended.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Embedded JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- APPLICATION STATE ---
            let currentTab = 'overview';
            let currentModule = null;
            let registers = {};
            let progressData = { 1: 0, 2: 0, 3: 0, 4: 0 };
            
            // Simulator state
            let currentInstructionIndex = 0;
            let instructions = [];

            // --- COMPREHENSIVE MODULE CONTENT ---
            const moduleContent = {
                1: `
                    <div class="space-y-6">
                        <section>
                            <h3 class="text-xl font-semibold mb-4">R-Type Instruction Format Deep Dive</h3>
                            <div class="binary-display mb-4">
                                op(6) | rs(5) | rt(5) | rd(5) | shamt(5) | funct(6)<br>
                                000000 | source | target | dest | shift | function
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="code-highlight p-4 rounded">
                                    <h4 class="font-semibold mb-2">Field Descriptions:</h4>
                                    <ul class="text-sm space-y-1">
                                        <li><strong>op:</strong> Always 000000 for R-type</li>
                                        <li><strong>rs:</strong> First source register</li>
                                        <li><strong>rt:</strong> Second source register</li>
                                        <li><strong>rd:</strong> Destination register</li>
                                        <li><strong>shamt:</strong> Shift amount (0-31)</li>
                                        <li><strong>funct:</strong> Function code (operation)</li>
                                    </ul>
                                </div>
                                <div class="code-highlight p-4 rounded">
                                    <h4 class="font-semibold mb-2">Key Characteristics:</h4>
                                    <ul class="text-sm space-y-1">
                                        <li>All operands are registers</li>
                                        <li>Result stored in rd register</li>
                                        <li>32-bit arithmetic operations</li>
                                        <li>Two's complement representation</li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <section>
                            <h3 class="text-xl font-semibold mb-4">Arithmetic Operations</h3>
                            <table class="instruction-table w-full mb-4">
                                <thead>
                                    <tr>
                                        <th>Instruction</th>
                                        <th>Function Code</th>
                                        <th>Operation</th>
                                        <th>Example</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="code-font">add</td>
                                        <td class="code-font">100000</td>
                                        <td>Addition with overflow</td>
                                        <td class="code-font">add $t0, $t1, $t2</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">addu</td>
                                        <td class="code-font">100001</td>
                                        <td>Addition without overflow</td>
                                        <td class="code-font">addu $t0, $t1, $t2</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">sub</td>
                                        <td class="code-font">100010</td>
                                        <td>Subtraction with overflow</td>
                                        <td class="code-font">sub $t0, $t1, $t2</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">subu</td>
                                        <td class="code-font">100011</td>
                                        <td>Subtraction without overflow</td>
                                        <td class="code-font">subu $t0, $t1, $t2</td>
                                    </tr>
                                </tbody>
                            </table>
                        </section>

                        <div class="mt-6">
                            <button class="complete-activity bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700" data-module="1">Complete Module 1</button>
                        </div>
                    </div>`,
                2: `
                    <div class="space-y-6">
                        <section>
                            <h3 class="text-xl font-semibold mb-4">I-Type Instruction Format</h3>
                            <div class="binary-display mb-4">
                                op(6) | rs(5) | rt(5) | immediate(16)<br>
                                opcode | source | target | constant value
                            </div>
                            <div class="code-highlight p-4 rounded mb-4">
                                <h4 class="font-semibold mb-2">Key Differences from R-Type:</h4>
                                <ul class="text-sm space-y-1">
                                    <li>Unique opcode for each instruction (not 000000)</li>
                                    <li>16-bit immediate value instead of second source register</li>
                                    <li>rt is the destination (not rd)</li>
                                    <li>No function field needed</li>
                                </ul>
                            </div>
                        </section>

                        <section>
                            <h3 class="text-xl font-semibold mb-4">Arithmetic Immediate Instructions</h3>
                            <table class="instruction-table w-full mb-4">
                                <thead>
                                    <tr>
                                        <th>Instruction</th>
                                        <th>Opcode</th>
                                        <th>Operation</th>
                                        <th>Range</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="code-font">addi</td>
                                        <td class="code-font">001000</td>
                                        <td>Add immediate</td>
                                        <td>-32,768 to +32,767</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">andi</td>
                                        <td class="code-font">001100</td>
                                        <td>AND immediate (zero extend)</td>
                                        <td>0 to 65,535</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">ori</td>
                                        <td class="code-font">001101</td>
                                        <td>OR immediate (zero extend)</td>
                                        <td>0 to 65,535</td>
                                    </tr>
                                </tbody>
                            </table>
                        </section>

                        <div class="mt-6">
                            <button class="complete-activity bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700" data-module="2">Complete Module 2</button>
                        </div>
                    </div>`,
                3: `
                    <div class="space-y-6">
                        <section>
                            <h3 class="text-xl font-semibold mb-4">Understanding Shift Operations</h3>
                            <div class="code-highlight p-4 rounded mb-4">
                                <h4 class="font-semibold mb-2">Why Shifts Matter:</h4>
                                <ul class="text-sm space-y-1">
                                    <li>Fastest way to multiply/divide by powers of 2</li>
                                    <li>Essential for bit manipulation and data packing</li>
                                    <li>Used in address calculations and data alignment</li>
                                    <li>Critical for implementing efficient algorithms</li>
                                </ul>
                            </div>
                        </section>

                        <section>
                            <h3 class="text-xl font-semibold mb-4">Shift Instructions</h3>
                            <table class="instruction-table w-full mb-4">
                                <thead>
                                    <tr>
                                        <th>Instruction</th>
                                        <th>Operation</th>
                                        <th>Fill Bits</th>
                                        <th>Use Case</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="code-font">sll</td>
                                        <td>Shift Left Logical</td>
                                        <td>Zero from right</td>
                                        <td>Multiply by 2^n</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">srl</td>
                                        <td>Shift Right Logical</td>
                                        <td>Zero from left</td>
                                        <td>Unsigned divide by 2^n</td>
                                    </tr>
                                    <tr>
                                        <td class="code-font">sra</td>
                                        <td>Shift Right Arithmetic</td>
                                        <td>Sign bit from left</td>
                                        <td>Signed divide by 2^n</td>
                                    </tr>
                                </tbody>
                            </table>
                        </section>

                        <div class="mt-6">
                            <button class="complete-activity bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700" data-module="3">Complete Module 3</button>
                        </div>
                    </div>`,
                4: `
                    <div class="space-y-6">
                        <section>
                            <h3 class="text-xl font-semibold mb-4">C to MIPS Translation Strategies</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="code-highlight p-4 rounded">
                                    <h4 class="font-semibold mb-2">C Code Example:</h4>
                                    <div class="code-font text-sm space-y-1">
                                        <div>int a = 10;</div>
                                        <div>int b = 20;</div>
                                        <div>int result;</div>
                                        <div>result = (a + b) * 2;</div>
                                    </div>
                                </div>
                                <div class="code-highlight p-4 rounded">
                                    <h4 class="font-semibold mb-2">MIPS Translation:</h4>
                                    <div class="code-font text-sm space-y-1">
                                        <div>li $s0, 10        # a = 10</div>
                                        <div>li $s1, 20        # b = 20</div>
                                        <div>add $t0, $s0, $s1 # temp = a + b</div>
                                        <div>sll $s2, $t0, 1   # result = temp * 2</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section>
                            <h3 class="text-xl font-semibold mb-4">Debugging Techniques</h3>
                            <div class="code-highlight p-4 rounded">
                                <h4 class="font-semibold mb-2">Best Practices:</h4>
                                <ul class="text-sm space-y-1">
                                    <li>Use meaningful register names in comments</li>
                                    <li>Test with simple, known inputs first</li>
                                    <li>Use single-step execution to watch register changes</li>
                                    <li>Verify branch conditions carefully</li>
                                </ul>
                            </div>
                        </section>

                        <div class="mt-6">
                            <button class="complete-activity bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700" data-module="4">Complete Module 4</button>
                        </div>
                    </div>`
            };
            
            const exerciseContent = {
                'arithmetic': {
                    title: 'Basic Arithmetic Operations',
                    problem: 'Write MIPS code to perform: result = (15 + 7) - (10 - 3)',
                    solution: `# Load values into registers
li $t0, 15          # First operand
li $t1, 7           # Second operand  
li $t2, 10          # Third operand
li $t3, 3           # Fourth operand

# Perform calculations
add $t4, $t0, $t1   # $t4 = 15 + 7 = 22
sub $t5, $t2, $t3   # $t5 = 10 - 3 = 7
sub $t6, $t4, $t5   # $t6 = 22 - 7 = 15`,
                    explanation: 'This demonstrates basic arithmetic operations. The result should be 15.'
                },
                'immediate': {
                    title: 'Immediate Operations',
                    problem: 'Load 500 into $t0, add 250, then subtract 100 using immediate instructions.',
                    solution: `# Load initial value
li $t0, 500         # $t0 = 500
# Add immediate value
addi $t0, $t0, 250  # $t0 = 750
# Subtract immediate value  
addi $t0, $t0, -100 # $t0 = 650`,
                    explanation: 'This shows immediate arithmetic and negative immediates for subtraction.'
                },
                'bitwise': {
                    title: 'Bitwise Operations',
                    problem: 'Given A = 0xAAAA and B = 0x5555, compute A AND B, A OR B, and A XOR B.',
                    solution: `# Load the values
li $t0, 0xAAAA      # A = 0xAAAA
li $t1, 0x5555      # B = 0x5555
# Perform bitwise operations
and $t2, $t0, $t1   # $t2 = A AND B = 0x0000
or  $t3, $t0, $t1   # $t3 = A OR B  = 0xFFFF  
xor $t4, $t0, $t1   # $t4 = A XOR B = 0xFFFF`,
                    explanation: 'This demonstrates bitwise operations with complementary patterns.'
                },
                'shifts': {
                    title: 'Shift Operations',
                    problem: 'Start with 12, multiply by 8 using shifts, then divide by 4 using shifts.',
                    solution: `# Load initial value
li $t0, 12          # Start with 12
# Multiply by 8 using left shift (8 = 2^3)
sll $t1, $t0, 3     # $t1 = 12 * 8 = 96
# Divide by 4 using right shift (4 = 2^2)  
srl $t2, $t1, 2     # $t2 = 96 / 4 = 24`,
                    explanation: 'Shows how shifts replace multiplication/division by powers of 2.'
                },
                'mixed': {
                    title: 'Mixed Operations Challenge',
                    problem: 'Implement: result = ((x << 2) + y) & 0xFF where x = 10, y = 25',
                    solution: `# Load initial values
li $s0, 10          # x = 10
li $s1, 25          # y = 25
# Implement: result = ((x << 2) + y) & 0xFF
sll $t0, $s0, 2     # $t0 = x << 2 = 40
add $t1, $t0, $s1   # $t1 = 40 + 25 = 65
andi $t2, $t1, 0xFF # $t2 = 65 & 0xFF = 65`,
                    explanation: 'Combines shifting, addition, and bitwise operations.'
                }
            };
            
            const instructionPatterns = {
                'add': { type: 'R', opcode: '000000', funct: '100000', format: 'add rd, rs, rt' },
                'addu': { type: 'R', opcode: '000000', funct: '100001', format: 'addu rd, rs, rt' },
                'sub': { type: 'R', opcode: '000000', funct: '100010', format: 'sub rd, rs, rt' },
                'subu': { type: 'R', opcode: '000000', funct: '100011', format: 'subu rd, rs, rt' },
                'and': { type: 'R', opcode: '000000', funct: '100100', format: 'and rd, rs, rt' },
                'or': { type: 'R', opcode: '000000', funct: '100101', format: 'or rd, rs, rt' },
                'xor': { type: 'R', opcode: '000000', funct: '100110', format: 'xor rd, rs, rt' },
                'nor': { type: 'R', opcode: '000000', funct: '100111', format: 'nor rd, rs, rt' },
                'slt': { type: 'R', opcode: '000000', funct: '101010', format: 'slt rd, rs, rt' },
                'sll': { type: 'R', opcode: '000000', funct: '000000', format: 'sll rd, rt, shamt' },
                'srl': { type: 'R', opcode: '000000', funct: '000010', format: 'srl rd, rt, shamt' },
                'sra': { type: 'R', opcode: '000000', funct: '000011', format: 'sra rd, rt, shamt' },
                'addi': { type: 'I', opcode: '001000', format: 'addi rt, rs, immediate' },
                'andi': { type: 'I', opcode: '001100', format: 'andi rt, rs, immediate' },
                'ori': { type: 'I', opcode: '001101', format: 'ori rt, rs, immediate' },
                'xori': { type: 'I', opcode: '001110', format: 'xori rt, rs, immediate' },
                'lui': { type: 'I', opcode: '001111', format: 'lui rt, immediate' },
                'slti': { type: 'I', opcode: '001010', format: 'slti rt, rs, immediate' }
            };

            // Register name mappings
            const registerMap = {
                '$zero': 0, '$at': 1, '$v0': 2, '$v1': 3,
                '$a0': 4, '$a1': 5, '$a2': 6, '$a3': 7,
                '$t0': 8, '$t1': 9, '$t2': 10, '$t3': 11,
                '$t4': 12, '$t5': 13, '$t6': 14, '$t7': 15,
                '$s0': 16, '$s1': 17, '$s2': 18, '$s3': 19,
                '$s4': 20, '$s5': 21, '$s6': 22, '$s7': 23,
                '$t8': 24, '$t9': 25, '$k0': 26, '$k1': 27,
                '$gp': 28, '$sp': 29, '$fp': 30, '$ra': 31
            };

            // --- UTILITY FUNCTIONS ---
            function handleModuleComplete(moduleNum) {
                progressData[moduleNum] = 100;
                updateProgressDisplay();
                const btn = document.querySelector(`.complete-activity[data-module="${moduleNum}"]`);
                if (btn) {
                    btn.textContent = 'Module Complete! ✓';
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-green-800', 'cursor-not-allowed');
                    btn.disabled = true;
                }
            }

            function updateProgressDisplay() {
                Object.keys(progressData).forEach(moduleNum => {
                    const progressBar = document.querySelector(`.progress-item[data-module="${moduleNum}"] .progress-bar`);
                    if (progressBar) progressBar.style.width = `${progressData[moduleNum]}%`;
                });
            }

            function showModule(moduleNum) {
                const moduleContentDiv = document.getElementById('module-content');
                const module = moduleContent[moduleNum];
                if (module) {
                    moduleContentDiv.innerHTML = `<h3 class="text-xl font-semibold mb-4">Module ${moduleNum}</h3>${module}`;
                    
                    // Re-attach event listener to the new complete button
                    const completeBtn = moduleContentDiv.querySelector('.complete-activity');
                    if (completeBtn) {
                        completeBtn.addEventListener('click', () => {
                            handleModuleComplete(parseInt(moduleNum));
                        });
                    }
                }
                
                // Update visual selection
                document.querySelectorAll('.module-card').forEach(c => c.classList.remove('ring-2', 'ring-blue-500'));
                const selectedCard = document.querySelector(`.module-card[data-module="${moduleNum}"]`);
                if (selectedCard) selectedCard.classList.add('ring-2', 'ring-blue-500');
            }

            // --- TAB NAVIGATION ---
            function showTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(btn => {
                    const isSelected = btn.getAttribute('data-tab') === tabName;
                    btn.classList.toggle('tab-active', isSelected);
                    btn.setAttribute('aria-selected', isSelected);
                });
                
                // Update tab panels
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.toggle('hidden', panel.id !== `${tabName}-panel`);
                });
                
                currentTab = tabName;
            }

            // --- INSTRUCTION DECODER ---
            function decodeInstruction(instruction) {
                const parts = instruction.trim().toLowerCase().replace(/,/g, '').split(/\s+/);
                const op = parts[0];
                
                if (!instructionPatterns[op]) {
                    return '<p class="text-red-600">Unknown instruction: ' + op + '</p>';
                }
                
                const pattern = instructionPatterns[op];
                let output = `<h4 class="font-semibold mb-3">Instruction: <code class="code-font bg-gray-200 px-2 py-1 rounded">${instruction}</code></h4>
                              <div class="mb-4 space-y-2">
                                <p><strong>Type:</strong> ${pattern.type}-Type</p>
                                <p><strong>Format:</strong> <code class="bg-gray-200 px-1 rounded">${pattern.format}</code></p>
                                <p><strong>Opcode:</strong> <code class="bg-gray-200 px-1 rounded">${pattern.opcode}</code></p>
                                ${pattern.type === 'R' ? `<p><strong>Function:</strong> <code class="bg-gray-200 px-1 rounded">${pattern.funct}</code></p>` : ''}
                              </div>`;

                // Parse fields
                let fields = {};
                if (pattern.type === 'R') {
                    if (['sll', 'srl', 'sra'].includes(op)) {
                        fields = { rd: parts[1], rt: parts[2], shamt: parts[3] };
                    } else {
                        fields = { rd: parts[1], rs: parts[2], rt: parts[3] };
                    }
                } else { // I-Type
                    if (op === 'lui') {
                        fields = { rt: parts[1], immediate: parts[2] };
                    } else {
                        fields = { rt: parts[1], rs: parts[2], immediate: parts[3] };
                    }
                }
                
                output += '<h5 class="font-medium mb-2">Fields:</h5>';
                output += '<div class="binary-display space-y-1">';
                for(const [key, value] of Object.entries(fields)) {
                    output += `<div><strong>${key}:</strong> ${value || 'N/A'}</div>`;
                }
                output += '</div>';
                
                return output;
            }

            // --- SIMULATOR FUNCTIONS ---
            function getRegisterValue(reg) {
                const cleanReg = reg.replace(', '');
                return registers[cleanReg] || 0;
            }
            
            function setRegisterValue(reg, value) {
                const cleanReg = reg.replace(', '');
                if (cleanReg !== 'zero') {
                    registers[cleanReg] = value & 0xFFFFFFFF;
                }
            }

            function updateRegisterDisplay() {
                const regNames = ['t0', 't1', 't2', 't3', 't4', 't5', 's0', 's1'];
                let html = '<div class="space-y-1">';
                regNames.forEach(reg => {
                    const value = registers[reg] || 0;
                    html += `<div class="flex justify-between">
                               <span>${reg}:</span> 
                               <span>0x${value.toString(16).padStart(8, '0').toUpperCase()}</span>
                             </div>`;
                });
                html += '</div>';
                document.getElementById('register-display').innerHTML = html;
            }

            function executeInstruction(instruction) {
                const parts = instruction.toLowerCase().replace(/,/g, '').split(/\s+/);
                const op = parts[0];
                
                try {
                    switch (op) {
                        case 'li':
                            setRegisterValue(parts[1], parseInt(parts[2]));
                            return `Loaded ${parseInt(parts[2])} into ${parts[1]}`;
                        case 'add':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) + getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} + ${parts[3]} = ${getRegisterValue(parts[1])}`;
                        case 'sub':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) - getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} - ${parts[3]} = ${getRegisterValue(parts[1])}`;
                        case 'addi':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) + parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} + ${parseInt(parts[3])} = ${getRegisterValue(parts[1])}`;
                        case 'and':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) & getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} & ${parts[3]} = 0x${getRegisterValue(parts[1]).toString(16)}`;
                        case 'andi':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) & parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} & ${parseInt(parts[3])} = 0x${getRegisterValue(parts[1]).toString(16)}`;
                        case 'or':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) | getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} | ${parts[3]} = 0x${getRegisterValue(parts[1]).toString(16)}`;
                        case 'ori':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) | parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} | ${parseInt(parts[3])} = 0x${getRegisterValue(parts[1]).toString(16)}`;
                        case 'xor':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) ^ getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} ^ ${parts[3]} = 0x${getRegisterValue(parts[1]).toString(16)}`;
                        case 'sll':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) << parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} << ${parseInt(parts[3])} = ${getRegisterValue(parts[1])}`;
                        case 'srl':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) >>> parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} >>> ${parseInt(parts[3])} = ${getRegisterValue(parts[1])}`;
                        case 'sra':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) >> parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} >> ${parseInt(parts[3])} = ${getRegisterValue(parts[1])}`;
                        default:
                            return `Unsupported instruction: ${op}`;
                    }
                } catch (error) {
                    return `Error executing: ${instruction}`;
                }
            }
            
            function parseInstructions(code) {
                return code.split('\n')
                    .map(line => line.trim())
                    .filter(line => line && !line.startsWith('#'));
            }

            function resetSimulator() {
                registers = {};
                ['t0','t1','t2','t3','t4','t5','t6','t7','s0','s1','s2','s3'].forEach(reg => {
                    registers[reg] = 0;
                });
                currentInstructionIndex = 0;
                instructions = [];
                updateRegisterDisplay();
                
                const status = document.getElementById('execution-status');
                const currentInst = document.getElementById('current-instruction');
                status.textContent = 'Ready to execute';
                status.className = 'p-2 rounded text-sm bg-gray-100';
                currentInst.textContent = 'None';
                currentInst.className = 'p-2 rounded text-sm bg-gray-100 code-font';
            }

            // --- EVENT HANDLERS ---
            function handleTabClick(e) {
                const tabName = e.target.getAttribute('data-tab');
                if (tabName) showTab(tabName);
            }

            function handleModuleClick(e) {
                const moduleCard = e.target.closest('.module-card');
                if (moduleCard) {
                    const moduleNum = moduleCard.getAttribute('data-module');
                    showModule(moduleNum);
                }
            }

            function handleProgressClick(e) {
                const progressItem = e.target.closest('.progress-item');
                if (progressItem) {
                    const moduleNum = progressItem.getAttribute('data-module');
                    showModule(moduleNum);
                }
            }

            function handleExerciseClick(e) {
                const exerciseCard = e.target.closest('.exercise-card');
                if (exerciseCard) {
                    const exerciseKey = exerciseCard.getAttribute('data-exercise');
                    const exercise = exerciseContent[exerciseKey];
                    const exerciseContentDiv = document.getElementById('exercise-content');
                    
                    if (exercise) {
                        exerciseContentDiv.innerHTML = `
                            <h3 class="text-xl font-semibold mb-2">${exercise.title}</h3>
                            <div class="mb-4 p-4 bg-blue-50 rounded">
                                <h4 class="font-semibold mb-2">Problem:</h4>
                                <p class="text-gray-700">${exercise.problem}</p>
                            </div>
                            <textarea id="exercise-input" class="w-full h-32 p-2 border-2 border-gray-300 rounded code-font text-sm" placeholder="# Enter your solution here..."></textarea>
                            <div class="flex gap-2 mt-3">
                                <button id="check-solution" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Check Solution</button>
                                <button id="show-solution" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Show Solution</button>
                                <button id="test-solution" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Test in Simulator</button>
                            </div>
                            <div id="exercise-feedback" class="exercise-output hidden"></div>`;
                            
                        // Add event listeners for exercise buttons using event delegation
                        exerciseContentDiv.querySelector('#show-solution').addEventListener('click', () => {
                            exerciseContentDiv.querySelector('#exercise-input').value = exercise.solution;
                            const feedback = exerciseContentDiv.querySelector('#exercise-feedback');
                            feedback.innerHTML = `<h5 class="font-semibold mb-2">Explanation:</h5><p>${exercise.explanation}</p>`;
                            feedback.classList.remove('hidden');
                        });
                        
                        exerciseContentDiv.querySelector('#test-solution').addEventListener('click', () => {
                            const code = exerciseContentDiv.querySelector('#exercise-input').value;
                            document.getElementById('code-input').value = code;
                            showTab('simulator');
                        });
                        
                        exerciseContentDiv.querySelector('#check-solution').addEventListener('click', () => {
                            const userCode = exerciseContentDiv.querySelector('#exercise-input').value.trim();
                            const feedback = exerciseContentDiv.querySelector('#exercise-feedback');
                            if (userCode) {
                                feedback.innerHTML = `<h5 class="font-semibold mb-2">Feedback:</h5><p>Code entered! Use 'Test in Simulator' to verify your solution, or 'Show Solution' to compare with the expected answer.</p>`;
                                feedback.classList.remove('hidden');
                            } else {
                                feedback.innerHTML = `<h5 class="font-semibold mb-2">Feedback:</h5><p class="text-red-600">Please enter some code first.</p>`;
                                feedback.classList.remove('hidden');
                            }
                        });
                    }
                    
                    // Update visual selection
                    document.querySelectorAll('.exercise-card').forEach(c => c.classList.remove('ring-2', 'ring-blue-500'));
                    exerciseCard.classList.add('ring-2', 'ring-blue-500');
                }
            }

            // --- INITIALIZATION ---
            function initializeApp() {
                console.log('Initializing MIPS Learning Guide...');
                
                // Initialize state
                resetSimulator();
                updateProgressDisplay();
                
                // Set up tab navigation
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', handleTabClick);
                });

                // Set up module navigation
                document.querySelectorAll('.module-card').forEach(card => {
                    card.addEventListener('click', handleModuleClick);
                });

                // Set up progress bar navigation
                document.querySelectorAll('.progress-item').forEach(item => {
                    item.addEventListener('click', handleProgressClick);
                });

                // Set up exercise navigation
                document.querySelectorAll('.exercise-card').forEach(card => {
                    card.addEventListener('click', handleExerciseClick);
                });

                // Set up instruction decoder
                const instructionInput = document.getElementById('instruction-input');
                const decodeBtn = document.getElementById('decode-btn');
                const decodeOutput = document.getElementById('decode-output');
                
                decodeBtn.addEventListener('click', () => {
                    const instruction = instructionInput.value.trim();
                    if (instruction) {
                        decodeOutput.innerHTML = decodeInstruction(instruction);
                    } else {
                        decodeOutput.innerHTML = '<p class="text-red-600">Please enter an instruction.</p>';
                    }
                });
                
                instructionInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') decodeBtn.click();
                });

                // Set up example buttons for decoder
                document.querySelectorAll('.example-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const instruction = btn.getAttribute('data-instruction');
                        instructionInput.value = instruction;
                        decodeOutput.innerHTML = decodeInstruction(instruction);
                    });
                });

                // Set up simulator controls
                const codeInput = document.getElementById('code-input');
                const status = document.getElementById('execution-status');
                const currentInst = document.getElementById('current-instruction');
                
                document.getElementById('run-btn').addEventListener('click', () => {
                    resetSimulator();
                    instructions = parseInstructions(codeInput.value);
                    if (instructions.length === 0) {
                        status.textContent = 'No code to execute';
                        status.className = 'p-2 rounded text-sm bg-yellow-100 text-yellow-800';
                        return;
                    }
                    instructions.forEach(inst => executeInstruction(inst));
                    updateRegisterDisplay();
                    status.textContent = `Executed ${instructions.length} instructions.`;
                    status.className = 'p-2 rounded text-sm bg-green-100 text-green-800';
                    currentInst.textContent = 'All executed';
                });
                
                document.getElementById('step-btn').addEventListener('click', () => {
                    if (instructions.length === 0 || currentInstructionIndex === 0) {
                        resetSimulator();
                        instructions = parseInstructions(codeInput.value);
                    }
                    if (currentInstructionIndex < instructions.length) {
                        const instruction = instructions[currentInstructionIndex];
                        const result = executeInstruction(instruction);
                        updateRegisterDisplay();
                        status.textContent = `Step ${currentInstructionIndex + 1}: ${result}`;
                        status.className = 'p-2 rounded text-sm bg-blue-100 text-blue-800';
                        currentInst.textContent = instruction;
                        currentInst.className = 'p-2 rounded text-sm bg-yellow-100 code-font';
                        currentInstructionIndex++;
                    } else {
                        status.textContent = 'All instructions executed.';
                        status.className = 'p-2 rounded text-sm bg-green-100 text-green-800';
                        currentInst.textContent = 'Complete';
                        currentInst.className = 'p-2 rounded text-sm bg-green-100 code-font';
                    }
                });
                
                document.getElementById('reset-btn').addEventListener('click', resetSimulator);
                
                document.getElementById('load-example-btn').addEventListener('click', () => {
                    const exampleCode = `# Example: Calculate (5 + 3) * 2 using shifts
li $t0, 5
li $t1, 3
add $t2, $t0, $t1    # $t2 = 8
sll $t3, $t2, 1      # $t3 = 16 (multiply by 2)

# Demonstrate bitwise operations  
li $t4, 0xF0        # Load 240
andi $t5, $t4, 0x0F # Extract lower 4 bits`;
                    codeInput.value = exampleCode;
                });

                // Initialize with overview tab
                showTab('overview');
                
                console.log('MIPS Learning Guide initialized successfully!');
            }

            // Start the application
            initializeApp();
        });
    </script>
</body>
</html>
