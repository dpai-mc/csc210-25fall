
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 6: MIPS Arithmetic & Logic Instructions</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #FDFBF8;
            color: #383838;
            font-family: 'Inter', sans-serif;
        }
        
        .code-font {
            font-family: 'Fira Code', monospace;
        }
        
        .primary-accent {
            background-color: #EADDD7;
        }
        
        .hover-accent:hover {
            background-color: #F0EBE8;
        }
        
        .tab-active {
            background-color: #EADDD7;
            border-bottom: 2px solid #383838;
        }
        
        .code-highlight {
            background-color: #F0EBE8;
            border-left: 4px solid #EADDD7;
        }
        
        .instruction-box {
            border: 2px solid #EADDD7;
            background-color: #FDFBF8;
        }
        
        .register-display {
            background-color: #F0EBE8;
            border: 1px solid #EADDD7;
        }
        
        @media print {
            .no-print { display: none; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-highlight {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { background-color: #F0EBE8; }
            50% { background-color: #EADDD7; }
        }
    </style>
</head>
<body class="antialiased">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded">
        Skip to main content
    </a>

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Week 6: MIPS Arithmetic & Logic Instructions</h1>
            <p class="text-lg text-gray-600">Interactive Learning Guide</p>
            <div class="mt-4 p-4 primary-accent rounded-lg">
                <p class="font-medium">Learning Objectives: Master R-type and I-type instructions, implement arithmetic and logical operations, and debug MIPS programs effectively.</p>
            </div>
        </header>

        <div class="mb-8 p-4 border-2 border-gray-300 rounded-lg">
            <h3 class="font-semibold mb-2">Your Progress</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="1">
                    <span class="block font-medium">Module 1</span>
                    <span class="text-sm">R-Type Instructions</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="2">
                    <span class="block font-medium">Module 2</span>
                    <span class="text-sm">I-Type Instructions</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="3">
                    <span class="block font-medium">Module 3</span>
                    <span class="text-sm">Shift Operations</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item p-2 text-center rounded cursor-pointer hover-accent" data-module="4">
                    <span class="block font-medium">Module 4</span>
                    <span class="text-sm">Programming & Debug</span>
                    <div class="progress-indicator mt-1 h-2 bg-gray-200 rounded">
                        <div class="progress-bar h-full bg-green-500 rounded" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <nav class="mb-8" role="tablist">
            <div class="flex flex-wrap border-b-2 border-gray-300">
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="true" aria-controls="overview-panel" data-tab="overview">
                    Overview
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="instruction-decoder-panel" data-tab="instruction-decoder">
                    Instruction Decoder
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="simulator-panel" data-tab="simulator">
                    MIPS Simulator
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="exercises-panel" data-tab="exercises">
                    Practice Exercises
                </button>
                <button class="tab-button px-6 py-3 font-medium hover-accent focus:ring-2 focus:ring-blue-500" 
                        role="tab" aria-selected="false" aria-controls="reference-panel" data-tab="reference">
                    Quick Reference
                </button>
            </div>
        </nav>

        <main id="main-content">
            <div id="overview-panel" class="tab-panel fade-in" role="tabpanel">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-4">Learning Modules</h2>
                        <div class="space-y-4">
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="1">
                                <h3 class="text-xl font-semibold mb-2">Module 1: R-Type Arithmetic Instructions</h3>
                                <p class="text-gray-600 mb-3">Learn register-to-register operations, instruction format, and basic arithmetic.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">2-3 hours</span>
                                    <span class="text-gray-500">Essential foundation</span>
                                </div>
                            </div>
                            
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="2">
                                <h3 class="text-xl font-semibold mb-2">Module 2: I-Type Instructions & Immediate Operands</h3>
                                <p class="text-gray-600 mb-3">Master immediate operands, sign extension, and constant operations.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">2-3 hours</span>
                                    <span class="text-gray-500">Building complexity</span>
                                </div>
                            </div>
                            
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="3">
                                <h3 class="text-xl font-semibold mb-2">Module 3: Shift Operations & Bit Manipulation</h3>
                                <p class="text-gray-600 mb-3">Explore shift instructions and advanced bit manipulation techniques.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">2-3 hours</span>
                                    <span class="text-gray-500">Advanced techniques</span>
                                </div>
                            </div>
                            
                            <div class="module-card p-6 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-module="4">
                                <h3 class="text-xl font-semibold mb-2">Module 4: Programming & Debugging</h3>
                                <p class="text-gray-600 mb-3">Convert C to MIPS, master debugging, and optimize performance.</p>
                                <div class="flex items-center text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">3-4 hours</span>
                                    <span class="text-gray-500">Practical application</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div id="module-content" class="border-2 border-gray-300 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">Select a Module to Begin</h3>
                            <p class="text-gray-600">Click on any module card to view detailed content, activities, and interactive exercises.</p>
                            
                            <div class="mt-6 p-4 primary-accent rounded-lg">
                                <h4 class="font-semibold mb-2">Prerequisites Check</h4>
                                <ul class="space-y-1 text-sm">
                                    <li>✓ Week 5: MIPS Architecture basics completed</li>
                                    <li>✓ Binary and hexadecimal number systems</li>
                                    <li>✓ Register file understanding</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="instruction-decoder-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Interactive Instruction Decoder</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Enter MIPS Instruction</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="instruction-input" class="block font-medium mb-2">Assembly Instruction:</label>
                                <input type="text" id="instruction-input" 
                                       class="w-full p-3 border-2 border-gray-300 rounded code-font focus:ring-2 focus:ring-blue-500"
                                       placeholder="e.g., add $t0, $t1, $t2"
                                       aria-describedby="instruction-help">
                                <p id="instruction-help" class="text-sm text-gray-600 mt-1">Enter a MIPS assembly instruction to decode</p>
                            </div>
                            
                            <button id="decode-btn" class="w-full bg-blue-600 text-white py-3 px-6 rounded font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                                Decode Instruction
                            </button>
                            
                            <div class="space-y-2">
                                <h4 class="font-medium">Quick Examples:</h4>
                                <div class="flex flex-wrap gap-2">
                                    <button class="example-btn px-3 py-1 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="add $t0, $t1, $t2">add $t0, $t1, $t2</button>
                                    <button class="example-btn px-3 py-1 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="addi $t0, $t1, 100">addi $t0, $t1, 100</button>
                                    <button class="example-btn px-3 py-1 text-sm border border-gray-300 rounded code-font hover-accent" data-instruction="sll $t0, $t1, 4">sll $t0, $t1, 4</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-4">Instruction Analysis</h3>
                        <div id="decode-output" class="instruction-box p-4 rounded-lg min-h-[100px]">
                            <p class="text-gray-600">Enter an instruction to see its breakdown...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="simulator-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Interactive MIPS Simulator</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <h3 class="text-xl font-semibold mb-4">MIPS Assembly Code</h3>
                        <textarea id="code-input" 
                                  class="w-full h-64 p-4 border-2 border-gray-300 rounded code-font text-sm focus:ring-2 focus:ring-blue-500"
                                  placeholder="# Enter your MIPS code here
li $t0, 10
li $t1, 20
add $t2, $t0, $t1"
                                  aria-label="MIPS assembly code input"></textarea>
                        
                        <div class="flex gap-4 mt-4">
                            <button id="run-btn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 focus:ring-2 focus:ring-green-500">
                                Run Code
                            </button>
                            <button id="step-btn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                                Step Through
                            </button>
                            <button id="reset-btn" class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700 focus:ring-2 focus:ring-gray-500">
                                Reset
                            </button>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-4">Registers</h3>
                        <div id="register-display" class="register-display p-4 rounded-lg text-sm code-font">
                            </div>
                        
                        <div class="mt-4">
                            <h4 class="font-semibold mb-2">Execution Status</h4>
                            <div id="execution-status" class="p-2 rounded text-sm bg-gray-100">
                                Ready to execute
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="exercises-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Practice Exercises</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Choose an Exercise</h3>
                        <div class="space-y-4">
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="arithmetic">
                                <h4 class="font-semibold">Basic Arithmetic Operations</h4>
                                <p class="text-sm text-gray-600">Practice add, sub, and register operations</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded">Beginner</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="immediate">
                                <h4 class="font-semibold">Immediate Operations</h4>
                                <p class="text-sm text-gray-600">Work with addi, constants, and I-type instructions</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Intermediate</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="bitwise">
                                <h4 class="font-semibold">Bitwise Operations</h4>
                                <p class="text-sm text-gray-600">Master and, or, xor, and bit manipulation</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Intermediate</span>
                            </div>
                            
                            <div class="exercise-card p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover-accent" data-exercise="shifts">
                                <h4 class="font-semibold">Shift Operations</h4>
                                <p class="text-sm text-gray-600">Practice sll, srl, sra for multiplication and division</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded">Advanced</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div id="exercise-content" class="border-2 border-gray-300 rounded-lg p-6 min-h-[300px]">
                            <h3 class="text-xl font-semibold mb-4">Select an Exercise</h3>
                            <p class="text-gray-600">Choose an exercise from the left to begin practicing.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reference-panel" class="tab-panel hidden" role="tabpanel">
                <h2 class="text-2xl font-bold mb-6">Quick Reference</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="border-2 border-gray-300 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">R-Type Instructions</h3>
                        <div class="text-sm code-font space-y-1">
                            <div><strong>add</strong> rd, rs, rt</div>
                            <div><strong>sub</strong> rd, rs, rt</div>
                            <div><strong>and</strong> rd, rs, rt</div>
                            <div><strong>or</strong> rd, rs, rt</div>
                            <div><strong>xor</strong> rd, rs, rt</div>
                            <div><strong>nor</strong> rd, rs, rt</div>
                            <div><strong>sll</strong> rd, rt, shamt</div>
                            <div><strong>srl</strong> rd, rt, shamt</div>
                            <div><strong>sra</strong> rd, rt, shamt</div>
                        </div>
                    </div>

                    <div class="border-2 border-gray-300 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">I-Type Instructions</h3>
                        <div class="text-sm code-font space-y-1">
                            <div><strong>addi</strong> rt, rs, imm</div>
                            <div><strong>andi</strong> rt, rs, imm</div>
                            <div><strong>ori</strong> rt, rs, imm</div>
                            <div><strong>xori</strong> rt, rs, imm</div>
                            <div><strong>slti</strong> rt, rs, imm</div>
                            <div><strong>lui</strong> rt, imm</div>
                        </div>
                    </div>

                    <div class="border-2 border-gray-300 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">Common Registers</h3>
                        <div class="text-sm code-font space-y-1">
                            <div><strong>$t0-$t7:</strong> Temporary</div>
                            <div><strong>$s0-$s7:</strong> Saved</div>
                            <div><strong>$a0-$a3:</strong> Arguments</div>
                            <div><strong>$v0-$v1:</strong> Return values</div>
                            <div><strong>$zero:</strong> Always 0</div>
                            <div><strong>$ra:</strong> Return address</div>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">Instruction Formats</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border-2 border-gray-300 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">R-Type Format</h4>
                            <div class="code-font text-sm p-2 bg-gray-100 rounded">
                                op(6) | rs(5) | rt(5) | rd(5) | shamt(5) | funct(6)
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Used for register-to-register operations</p>
                        </div>
                        
                        <div class="border-2 border-gray-300 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">I-Type Format</h4>
                            <div class="code-font text-sm p-2 bg-gray-100 rounded">
                                op(6) | rs(5) | rt(5) | immediate(16)
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Used for immediate operations and loads/stores</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- APPLICATION STATE ---
            let currentTab = 'overview';
            let currentModule = null;
            let registers = {};
            let progressData = { 1: 0, 2: 0, 3: 0, 4: 0 };
            
            // Simulator state
            let currentInstructionIndex = 0;
            let instructions = [];

            // --- DATA & CONTENT ---
            const moduleContent = {
                1: {
                    title: "Module 1: R-Type Arithmetic Instructions",
                    content: `
                        <h3 class="text-xl font-semibold mb-4">R-Type Instruction Format</h3>
                        <div class="code-highlight p-4 rounded mb-4"><div class="code-font text-sm">op(6) | rs(5) | rt(5) | rd(5) | shamt(5) | funct(6)</div></div>
                        <h4 class="font-semibold mb-2">Key Characteristics:</h4>
                        <ul class="list-disc pl-6 mb-4 space-y-1">
                            <li>Opcode always <code>000000</code> for R-type</li>
                            <li>Function code (funct) specifies the operation</li>
                            <li>Three register operands: rs, rt, rd</li>
                        </ul>
                        <h4 class="font-semibold mb-2">Practice Example:</h4>
                        <div class="code-highlight p-4 rounded mb-4"><div class="code-font text-sm">add $t0, $t1, $t2  # $t0 = $t1 + $t2<br>sub $t3, $t0, $t1  # $t3 = $t0 - $t1</div></div>
                        <button class="complete-activity bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" data-module="1">Mark Module 1 Complete</button>`
                },
                2: {
                    title: "Module 2: I-Type Instructions & Immediate Operands",
                    content: `
                        <h3 class="text-xl font-semibold mb-4">I-Type Instruction Format</h3>
                        <div class="code-highlight p-4 rounded mb-4"><div class="code-font text-sm">op(6) | rs(5) | rt(5) | immediate(16)</div></div>
                        <h4 class="font-semibold mb-2">Key Characteristics:</h4>
                        <ul class="list-disc pl-6 mb-4 space-y-1">
                            <li>Unique opcode for each instruction type</li>
                            <li>16-bit immediate value (constant)</li>
                            <li>Sign-extended to 32 bits for arithmetic operations</li>
                        </ul>
                        <h4 class="font-semibold mb-2">Practice Example:</h4>
                        <div class="code-highlight p-4 rounded mb-4"><div class="code-font text-sm">addi $t0, $t1, 100  # $t0 = $t1 + 100<br>andi $t2, $t0, 0xFF # $t2 = $t0 & 0xFF</div></div>
                        <button class="complete-activity bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" data-module="2">Mark Module 2 Complete</button>`
                },
                3: {
                    title: "Module 3: Shift Operations & Bit Manipulation",
                    content: `
                        <h3 class="text-xl font-semibold mb-4">Shift Instructions</h3>
                        <h4 class="font-semibold mb-2">Three Types of Shifts:</h4>
                        <ul class="list-disc pl-6 mb-4 space-y-1">
                            <li><strong>sll:</strong> Shift Left Logical (multiply by 2^n)</li>
                            <li><strong>srl:</strong> Shift Right Logical (unsigned divide by 2^n)</li>
                            <li><strong>sra:</strong> Shift Right Arithmetic (signed divide by 2^n)</li>
                        </ul>
                        <h4 class="font-semibold mb-2">Practice Example:</h4>
                        <div class="code-highlight p-4 rounded mb-4"><div class="code-font text-sm">li $t0, 8           # Load 8<br>sll $t1, $t0, 2     # $t1 = 8 << 2 = 32<br>srl $t2, $t1, 1     # $t2 = 32 >> 1 = 16</div></div>
                        <button class="complete-activity bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" data-module="3">Mark Module 3 Complete</button>`
                },
                4: {
                    title: "Module 4: Programming & Debugging",
                    content: `
                        <h3 class="text-xl font-semibold mb-4">C to MIPS Translation</h3>
                        <h4 class="font-semibold mb-2">Translation Example:</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <h5 class="font-medium mb-2">C Code:</h5>
                                <div class="code-highlight p-3 rounded"><div class="code-font text-sm">int result = (a + b) * 4;</div></div>
                            </div>
                            <div>
                                <h5 class="font-medium mb-2">MIPS Translation (a=$s0, b=$s1):</h5>
                                <div class="code-highlight p-3 rounded"><div class="code-font text-sm">add $t0, $s0, $s1   # a + b<br>sll $t0, $t0, 2     # * 4</div></div>
                            </div>
                        </div>
                        <h4 class="font-semibold mb-2">Debugging Tips:</h4>
                        <ul class="list-disc pl-6 mb-4 space-y-1">
                            <li>Use single-step execution to watch register changes.</li>
                            <li>Add comments to your code to track logic.</li>
                            <li>Test with known input values to verify outputs.</li>
                        </ul>
                        <button class="complete-activity bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" data-module="4">Mark Module 4 Complete</button>`
                }
            };
            
            const exerciseContent = {
                'arithmetic': {
                    title: 'Basic Arithmetic',
                    problem: 'Given `$t1` has a value of 15 and `$t2` has a value of 7, write MIPS code to calculate `$t0 = $t1 - $t2`.'
                },
                'immediate': {
                    title: 'Immediate Operations',
                    problem: 'Load the immediate value `120` into register `$t0`. Then, add ` -20` to it and store the result in `$t1`.'
                },
                'bitwise': {
                    title: 'Bitwise Operations',
                    problem: 'Given `$t1 = 0xAAAA` and `$t2 = 0x5555`, compute the bitwise OR and store the result in `$t3`. You can use the `li` pseudo-instruction to load hex values.'
                },
                'shifts': {
                    title: 'Shift Operations',
                    problem: 'Place the value `25` into register `$t0`. Then, multiply it by 4 using only a shift instruction. Store the result in `$t1`.'
                }
            };
            
            const instructionPatterns = {
                'add': { type: 'R', opcode: '000000', funct: '100000', format: 'add rd, rs, rt' },
                'sub': { type: 'R', opcode: '000000', funct: '100010', format: 'sub rd, rs, rt' },
                'and': { type: 'R', opcode: '000000', funct: '100100', format: 'and rd, rs, rt' },
                'or': { type: 'R', opcode: '000000', funct: '100101', format: 'or rd, rs, rt' },
                'xor': { type: 'R', opcode: '000000', funct: '100110', format: 'xor rd, rs, rt' },
                'nor': { type: 'R', opcode: '000000', funct: '100111', format: 'nor rd, rs, rt' },
                'sll': { type: 'R', opcode: '000000', funct: '000000', format: 'sll rd, rt, shamt' },
                'srl': { type: 'R', opcode: '000000', funct: '000010', format: 'srl rd, rt, shamt' },
                'sra': { type: 'R', opcode: '000000', funct: '000011', format: 'sra rd, rt, shamt' },
                'addi': { type: 'I', opcode: '001000', format: 'addi rt, rs, immediate' },
                'andi': { type: 'I', opcode: '001100', format: 'andi rt, rs, immediate' },
                'ori': { type: 'I', opcode: '001101', format: 'ori rt, rs, immediate' },
                'xori': { type: 'I', opcode: '001110', format: 'xori rt, rs, immediate' },
                'lui': { type: 'I', opcode: '001111', format: 'lui rt, immediate' },
                'slti': { type: 'I', opcode: '001010', format: 'slti rt, rs, immediate' }
            };
            
            // --- CORE LOGIC ---

            // Tab Navigation
            function showTab(tabName) {
                document.querySelectorAll('.tab-button').forEach(btn => {
                    const isSelected = btn.getAttribute('data-tab') === tabName;
                    btn.classList.toggle('tab-active', isSelected);
                    btn.setAttribute('aria-selected', isSelected);
                });
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.toggle('hidden', panel.id !== `${tabName}-panel`);
                });
                if(document.getElementById(`${tabName}-panel`)) {
                    document.getElementById(`${tabName}-panel`).classList.add('fade-in');
                }
                currentTab = tabName;
            }

            // Progress Tracking
            function markModuleComplete(moduleNum) {
                progressData[moduleNum] = 100;
                updateProgressDisplay();
                const btn = document.querySelector(`.complete-activity[data-module="${moduleNum}"]`);
                if (btn) {
                    btn.textContent = 'Module Complete! ✓';
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-green-800', 'cursor-not-allowed');
                    btn.disabled = true;
                    btn.classList.add('pulse-highlight');
                    setTimeout(() => btn.classList.remove('pulse-highlight'), 2000);
                }
            }

            function updateProgressDisplay() {
                Object.keys(progressData).forEach(moduleNum => {
                    const progressBar = document.querySelector(`.progress-item[data-module="${moduleNum}"] .progress-bar`);
                    if (progressBar) progressBar.style.width = `${progressData[moduleNum]}%`;
                });
            }

            // Instruction Decoder Logic
            function decodeInstruction(instruction) {
                const parts = instruction.trim().toLowerCase().replace(/,/g, '').split(/\s+/);
                const op = parts[0];
                if (!instructionPatterns[op]) {
                    return '<p class="text-red-600">Unknown instruction: ' + op + '</p>';
                }
                const pattern = instructionPatterns[op];
                let output = `<h4 class="font-semibold mb-2">Instruction: <code class="code-font">${instruction}</code></h4>
                              <div class="mb-4 space-y-1">
                                <p><strong>Type:</strong> ${pattern.type}-Type</p>
                                <p><strong>Format:</strong> <code class="bg-gray-200 px-1 rounded">${pattern.format}</code></p>
                                <p><strong>Opcode (binary):</strong> <code class="bg-gray-200 px-1 rounded">${pattern.opcode}</code></p>
                                ${pattern.type === 'R' ? `<p><strong>Function (binary):</strong> <code class="bg-gray-200 px-1 rounded">${pattern.funct}</code></p>` : ''}
                              </div>
                              <h5 class="font-medium mb-2">Field Breakdown:</h5>`;

                let fields = {};
                if (pattern.type === 'R') {
                    if (['sll', 'srl', 'sra'].includes(op)) {
                        fields = { rd: parts[1], rt: parts[2], shamt: parts[3] };
                    } else {
                        fields = { rd: parts[1], rs: parts[2], rt: parts[3] };
                    }
                } else { // I-Type
                     if (op === 'lui') {
                        fields = { rt: parts[1], immediate: parts[2] };
                    } else {
                        fields = { rt: parts[1], rs: parts[2], immediate: parts[3] };
                    }
                }
                
                output += '<div class="code-font text-sm bg-gray-100 p-2 rounded space-y-1">';
                for(const [key, value] of Object.entries(fields)) {
                    output += `<div><strong>${key.padEnd(10, ' ')}:</strong> ${value || 'N/A'}</div>`;
                }
                output += '</div>';
                return output;
            }
            
            // MIPS Simulator Logic
            function getRegisterValue(reg) {
                const cleanReg = reg.replace('$', '');
                return registers[cleanReg] || 0;
            }
            
            function setRegisterValue(reg, value) {
                 const cleanReg = reg.replace('$', '');
                 if (cleanReg !== 'zero') {
                     registers[cleanReg] = value & 0xFFFFFFFF; // Ensure 32-bit value
                 }
            }

            function updateRegisterDisplaySim() {
                const regNames = ['t0', 't1', 't2', 't3', 't4', 't5', 't6', 't7'];
                let html = '<div class="space-y-1">';
                regNames.forEach(reg => {
                    const value = registers[reg] || 0;
                    html += `<div>$${reg}: 0x${value.toString(16).padStart(8, '0').toUpperCase()}</div>`;
                });
                html += '</div>';
                document.getElementById('register-display').innerHTML = html;
            }

            function executeInstructionSim(instruction) {
                const parts = instruction.toLowerCase().replace(/,/g, '').split(/\s+/);
                const op = parts[0];
                
                try {
                    switch (op) {
                        case 'li':
                            setRegisterValue(parts[1], parseInt(parts[2]));
                            return `Loaded ${parseInt(parts[2])} into ${parts[1]}`;
                        case 'add':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) + getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} + ${parts[3]}`;
                        case 'sub':
                             setRegisterValue(parts[1], getRegisterValue(parts[2]) - getRegisterValue(parts[3]));
                             return `${parts[1]} = ${parts[2]} - ${parts[3]}`;
                        case 'addi':
                             setRegisterValue(parts[1], getRegisterValue(parts[2]) + parseInt(parts[3]));
                             return `${parts[1]} = ${parts[2]} + ${parseInt(parts[3])}`;
                        case 'and':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) & getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} & ${parts[3]}`;
                        case 'or':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) | getRegisterValue(parts[3]));
                            return `${parts[1]} = ${parts[2]} | ${parts[3]}`;
                        case 'sll':
                            setRegisterValue(parts[1], getRegisterValue(parts[2]) << parseInt(parts[3]));
                            return `${parts[1]} = ${parts[2]} << ${parseInt(parts[3])}`;
                        default:
                            return `Unsupported instruction: ${op}`;
                    }
                } catch (error) {
                    return `Error executing: ${instruction}`;
                }
            }
            
            function parseInstructions(code) {
                return code.split('\n')
                    .map(line => line.trim())
                    .filter(line => line && !line.startsWith('#'));
            }

            function resetSimulator() {
                registers = { t0:0,t1:0,t2:0,t3:0,t4:0,t5:0,t6:0,t7:0,s0:0,s1:0,s2:0,s3:0,s4:0,s5:0,s6:0,s7:0 };
                currentInstructionIndex = 0;
                instructions = [];
                updateRegisterDisplaySim();
                const status = document.getElementById('execution-status');
                status.textContent = 'Ready to execute';
                status.className = 'p-2 rounded text-sm bg-gray-100';
            }

            // --- INITIALIZATION ---
            function initializeApplication() {
                // Initialize Tabs
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', () => showTab(btn.getAttribute('data-tab')));
                });

                // Initialize Modules
                const moduleContentDiv = document.getElementById('module-content');
                document.querySelectorAll('.module-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const moduleNum = card.getAttribute('data-module');
                        const module = moduleContent[moduleNum];
                        if (module) {
                            moduleContentDiv.innerHTML = `<h3 class="text-xl font-semibold mb-4">${module.title}</h3>${module.content}`;
                            moduleContentDiv.querySelector('.complete-activity')?.addEventListener('click', (e) => {
                                markModuleComplete(parseInt(e.target.getAttribute('data-module')));
                            });
                        }
                        document.querySelectorAll('.module-card').forEach(c => c.classList.remove('ring-2', 'ring-blue-500'));
                        card.classList.add('ring-2', 'ring-blue-500');
                    });
                });
                
                // Initialize Instruction Decoder
                const instructionInput = document.getElementById('instruction-input');
                const decodeBtn = document.getElementById('decode-btn');
                const decodeOutput = document.getElementById('decode-output');
                decodeBtn.addEventListener('click', () => {
                     decodeOutput.innerHTML = instructionInput.value ? decodeInstruction(instructionInput.value) : '<p class="text-red-600">Please enter an instruction.</p>';
                });
                instructionInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') decodeBtn.click(); });
                document.querySelectorAll('.example-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const instruction = btn.getAttribute('data-instruction');
                        instructionInput.value = instruction;
                        decodeOutput.innerHTML = decodeInstruction(instruction);
                    });
                });
                
                // Initialize Simulator
                const codeInput = document.getElementById('code-input');
                const status = document.getElementById('execution-status');
                document.getElementById('run-btn').addEventListener('click', () => {
                    resetSimulator();
                    instructions = parseInstructions(codeInput.value);
                    if (instructions.length === 0) {
                        status.textContent = 'No code to execute';
                        status.className = 'p-2 rounded text-sm bg-yellow-100 text-yellow-800';
                        return;
                    }
                    instructions.forEach(inst => executeInstructionSim(inst));
                    updateRegisterDisplaySim();
                    status.textContent = `Executed ${instructions.length} instructions.`;
                    status.className = 'p-2 rounded text-sm bg-green-100 text-green-800';
                });
                 document.getElementById('step-btn').addEventListener('click', () => {
                    if(instructions.length === 0 || currentInstructionIndex === 0 && instructions[0] !== parseInstructions(codeInput.value)[0]) {
                        resetSimulator();
                        instructions = parseInstructions(codeInput.value);
                    }
                    if (currentInstructionIndex < instructions.length) {
                        const result = executeInstructionSim(instructions[currentInstructionIndex]);
                        updateRegisterDisplaySim();
                        status.textContent = `Step ${currentInstructionIndex + 1}: ${result}`;
                        status.className = 'p-2 rounded text-sm bg-blue-100 text-blue-800';
                        currentInstructionIndex++;
                    } else {
                        status.textContent = 'All instructions executed.';
                        status.className = 'p-2 rounded text-sm bg-green-100 text-green-800';
                    }
                });
                document.getElementById('reset-btn').addEventListener('click', resetSimulator);
                
                // Initialize Exercises
                const exerciseContentDiv = document.getElementById('exercise-content');
                document.querySelectorAll('.exercise-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const exerciseKey = card.getAttribute('data-exercise');
                        const exercise = exerciseContent[exerciseKey];
                        if (exercise) {
                            exerciseContentDiv.innerHTML = `
                                <h3 class="text-xl font-semibold mb-2">${exercise.title}</h3>
                                <p class="text-gray-700 mb-4">${exercise.problem}</p>
                                <textarea class="w-full h-32 p-2 border-2 border-gray-300 rounded code-font text-sm" placeholder="# Enter your solution here..."></textarea>
                                <button class="mt-3 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Check Answer (Not Implemented)</button>`;
                        }
                         document.querySelectorAll('.exercise-card').forEach(c => c.classList.remove('ring-2', 'ring-blue-500'));
                        card.classList.add('ring-2', 'ring-blue-500');
                    });
                });
                
                // Final setup
                resetSimulator();
                updateProgressDisplay();
                showTab('overview');
                console.log('MIPS Learning Guide Initialized.');
            }

            // Run the application
            initializeApplication();
        });
    </script>
</body>
</html>



