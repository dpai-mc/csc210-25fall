<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arithmetic Circuits - CSC210</title>
    <style>
/* * CSC210 Module Shared Styles
 * Version: 1.0.0
 * * This CSS file provides consistent styling across all modules
 * and ensures proper integration with the main learning platform.
 */

/* ===== CSS CUSTOM PROPERTIES (DESIGN SYSTEM) ===== */
:root {
    /* Primary Color Palette - Must match platform */
    --primary-color: #2563eb;
    --secondary-color: #3b82f6;
    --accent-color: #f59e0b;
    --success-color: #059669;
    --error-color: #dc2626;
    --warning-color: #d97706;
    --info-color: #0891b2;
    
    /* Background Colors */
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-tertiary: #e2e8f0;
    --bg-inverse: #1e293b;
    
    /* Text Colors */
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-light: #f1f5f9;
    
    /* Font Styles */
    --font-family-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    --font-family-mono: "Courier New", Courier, monospace;
    --font-size-base: 16px;
    --font-weight-normal: 400;
    --font-weight-bold: 700;
    
    /* Spacing & Sizing */
    --spacing-unit: 8px;
    --border-radius: 4px;
    
    /* Transitions */
    --transition-speed: 0.2s;
}

/* ===== GENERAL STYLES ===== */
body {
    font-family: var(--font-family-sans);
    color: var(--text-primary);
    background-color: var(--bg-secondary);
    line-height: 1.6;
    margin: 0;
    padding: calc(var(--spacing-unit) * 3);
}

.module-container {
    max-width: 900px;
    margin: auto;
    background-color: var(--bg-primary);
    border-radius: var(--border-radius);
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    padding: calc(var(--spacing-unit) * 4);
}

h1, h2, h3 {
    color: var(--primary-color);
    border-bottom: 2px solid var(--bg-tertiary);
    padding-bottom: var(--spacing-unit);
    margin-top: calc(var(--spacing-unit) * 3);
}

p {
    margin-bottom: calc(var(--spacing-unit) * 2);
}

code {
    font-family: var(--font-family-mono);
    background-color: var(--bg-tertiary);
    padding: 2px 5px;
    border-radius: var(--border-radius);
}

/* ===== INTERACTIVE COMPONENTS ===== */
.simulation-container {
    border: 1px solid var(--bg-tertiary);
    padding: calc(var(--spacing-unit) * 2);
    margin-top: calc(var(--spacing-unit) * 2);
    border-radius: var(--border-radius);
}

.simulation-container svg {
    width: 100%;
    height: auto;
    user-select: none;
}

.controls {
    margin-top: var(--spacing-unit);
    display: flex;
    gap: calc(var(--spacing-unit) * 2);
}

button {
    background-color: var(--primary-color);
    color: var(--text-light);
    border: none;
    padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background-color var(--transition-speed);
}

button:hover {
    background-color: var(--secondary-color);
}

/* ===== QUIZ STYLES ===== */
.quiz-container {
    margin-top: calc(var(--spacing-unit) * 4);
}

.question {
    background: var(--bg-secondary);
    padding: calc(var(--spacing-unit) * 2);
    margin-bottom: var(--spacing-unit);
    border-radius: var(--border-radius);
}

.question ul {
    list-style-type: none;
    padding: 0;
}

.question li {
    padding: var(--spacing-unit);
    cursor: pointer;
}

.question li:hover {
    background-color: var(--bg-tertiary);
}

.feedback {
    margin-top: var(--spacing-unit);
    padding: var(--spacing-unit);
    border-radius: var(--border-radius);
}

.feedback.correct {
    background-color: var(--success-color);
    color: var(--text-light);
}

.feedback.incorrect {
    background-color: var(--error-color);
    color: var(--text-light);
}

/* SVG specific styles */
.wire {
    stroke-width: 2;
    stroke: var(--text-secondary);
    fill: none;
}

.wire.on {
    stroke: var(--accent-color);
    stroke-width: 3;
}

.gate {
    fill: var(--bg-secondary);
    stroke: var(--primary-color);
    stroke-width: 2;
}

.label {
    font-family: var(--font-family-sans);
    font-size: 14px;
    fill: var(--text-primary);
    user-select: none;
}

.interactive:hover {
    cursor: pointer;
    opacity: 0.8;
}
    </style>
</head>
<body>
    <div class="module-container">
        <header>
            <h1>Module 3: Arithmetic Circuits</h1>
            <p>Understanding how computers perform basic arithmetic using logic gates.</p>
        </header>

        <section id="half-adder">
            <h2>The Half-Adder</h2>
            <p>A half-adder is a fundamental digital circuit that adds two single binary digits (A and B). It produces two outputs: a <strong>Sum (S)</strong> and a <strong>Carry (C)</strong>.</p>
            <p>The logic is: S = A XOR B, and C = A AND B.</p>
            
            <div class="simulation-container">
                <h3>Interactive Half-Adder</h3>
                <p>Click on the input boxes (A or B) to toggle their values between 0 and 1.</p>
                <svg id="half-adder-svg" viewBox="0 0 400 250">
                    <path id="wire-a-xor" class="wire" d="M 50 50 H 150"/>
                    <path id="wire-b-xor" class="wire" d="M 50 150 H 150"/>
                    <path id="wire-a-and" class="wire" d="M 50 50 H 75 V 100 H 150"/>
                    <path id="wire-b-and" class="wire" d="M 50 150 H 75 V 120 H 150"/>
                    <path id="wire-sum" class="wire" d="M 250 75 H 350"/>
                    <path id="wire-carry" class="wire" d="M 250 110 H 350"/>

                    <path id="gate-xor" class="gate" d="M 150 50 C 175 50, 175 100, 150 100 M 145 40 C 175 50, 175 100, 145 110 "/>
                    <text x="190" y="80" class="label">XOR</text>
                    <path id="gate-and" class="gate" d="M 150 100 H 200 A 25 25 0 0 1 200 150 H 150 Z"/>
                    <text x="165" y="130" class="label">AND</text>

                    <rect id="input-a" class="interactive" x="30" y="40" width="20" height="20" fill="lightblue"/>
                    <text x="10" y="55" class="label">A</text>
                    <text id="text-a" x="35" y="55" class="label">0</text>
                    <rect id="input-b" class="interactive" x="30" y="140" width="20" height="20" fill="lightblue"/>
                    <text x="10" y="155" class="label">B</text>
                    <text id="text-b" x="35" y="155" class="label">0</text>
                    
                    <rect id="output-sum" x="350" y="65" width="20" height="20" fill="lightgreen"/>
                    <text x="375" y="80" class="label">Sum</text>
                    <text id="text-sum" x="355" y="80" class="label">0</text>
                    <rect id="output-carry" x="350" y="125" width="20" height="20" fill="lightgreen"/>
                    <text x="375" y="140" class="label">Carry</text>
                    <text id="text-carry-ha" x="355" y="140" class="label">0</text>
                </svg>
            </div>
        </section>

        <section id="full-adder">
            <h2>The Full-Adder</h2>
            <p>A full-adder is a more complex circuit that adds three binary digits: A, B, and a Carry-In (C-in). It's essential for multi-bit addition. It produces a Sum (S) and a Carry-Out (C-out).</p>
            <p>It can be constructed from two half-adders and an OR gate.</p>

            <div class="simulation-container">
                <h3>Interactive Full-Adder</h3>
                <p>Click on the input boxes (A, B, or C-in) to toggle their values.</p>
                <svg id="full-adder-svg" viewBox="0 0 500 300">
                    <text x="150" y="150">Full-Adder SVG Placeholder</text>
                </svg>
            </div>
        </section>

        <section id="ripple-carry">
            <h2>The 4-Bit Ripple-Carry Adder</h2>
            <p>To add numbers with more than one bit, we chain full-adders together. The carry-out of one full-adder becomes the carry-in of the next. This is called a ripple-carry adder.</p>
            
            <div class="simulation-container">
                <h3>Interactive 4-Bit Adder</h3>
                <p>The interactive SVG diagram for the 4-bit ripple-carry adder should be placed here.</p>
                <svg id="ripple-carry-svg" viewBox="0 0 600 400">
                     <text x="200" y="200">4-Bit Ripple-Carry Adder SVG Placeholder</text>
                </svg>
            </div>
        </section>

        <section id="assessment">
            <h2>Assessment Quiz</h2>
            <p>Test your understanding of arithmetic circuits.</p>
            <div id="quiz-container" class="quiz-container"></div>
            <button id="submit-quiz">Submit Answers</button>
            <div id="quiz-results"></div>
        </section>
    </div>

    <script>
// Enhanced Quiz Manager
class QuizManager {
    constructor(quizData) {
        this.quizData = quizData;
        this.userAnswers = {};
        this.container = document.getElementById('quiz-container');
        this.resultsContainer = document.getElementById('quiz-results');
        this.submitButton = document.getElementById('submit-quiz');
        this.render();
        this.submitButton.addEventListener('click', () => this.showResults());
    }

    render() {
        this.quizData.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'question';
            let optionsHtml = '<ul>';
            q.options.forEach((option, i) => {
                optionsHtml += `<li><input type="radio" name="q${index}" value="${i}">${option}</li>`;
            });
            optionsHtml += '</ul>';
            questionEl.innerHTML = `<p>${index + 1}. ${q.question}</p>${optionsHtml}`;
            this.container.appendChild(questionEl);
        });
    }

    showResults() {
        let score = 0;
        this.quizData.forEach((q, index) => {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (selected && parseInt(selected.value) === q.answer) {
                score++;
            }
        });
        this.resultsContainer.innerHTML = `<h3>Your score: ${score} out of ${this.quizData.length}</h3>`;
    }

    calculateScore() {
        // ... (calculation logic)
        return 0; // Placeholder
    }
}

// Base class for circuit simulators
class CircuitSimulator {
    constructor(svgId) {
        this.svg = document.getElementById(svgId);
        if (!this.svg) {
            throw new Error(`SVG element with ID "${svgId}" not found.`);
        }
        this.inputs = {};
        this.outputs = {};
        this.wires = {};
    }

    updateWire(wireId, state) {
        const wire = this.wires[wireId] || this.svg.getElementById(wireId);
        if (wire) {
            this.wires[wireId] = wire;
            wire.classList.toggle('on', state === 1);
        }
    }

    updateText(textId, value) {
        const textElement = this.svg.getElementById(textId);
        if (textElement) {
            textElement.textContent = value;
        }
    }
}

// Half-Adder Simulator
class HalfAdderSimulator extends CircuitSimulator {
    constructor(svgId) {
        super(svgId);
        this.inputs = { a: 0, b: 0 };
        this.outputs = { sum: 0, carry: 0 };
        this.initListeners();
        this.update();
    }

    initListeners() {
        this.svg.getElementById('input-a').addEventListener('click', () => this.toggleInput('a'));
        this.svg.getElementById('input-b').addEventListener('click', () => this.toggleInput('b'));
    }

    toggleInput(input) {
        this.inputs[input] = 1 - this.inputs[input];
        this.update();
    }

    update() {
        const { a, b } = this.inputs;
        this.outputs.sum = a ^ b; // XOR
        this.outputs.carry = a & b; // AND

        // Update visuals
        this.updateText('text-a', a);
        this.updateText('text-b', b);
        this.updateText('text-sum', this.outputs.sum);
        this.updateText('text-carry-ha', this.outputs.carry);
        
        this.updateWire('wire-a-xor', a);
        this.updateWire('wire-a-and', a);
        this.updateWire('wire-b-xor', b);
        this.updateWire('wire-b-and', b);
        this.updateWire('wire-sum', this.outputs.sum);
        this.updateWire('wire-carry', this.outputs.carry);
    }
}

// Full-Adder and Ripple-Carry simulators would be defined here...
class FullAdderSimulator extends CircuitSimulator {
    // ... Implementation
}

class RippleCarryAdderSimulator extends CircuitSimulator {
    // ... Implementation
}

// Main module initialization function
function initializeCompleteArithmeticModule() {
    try {
        console.log("Initializing Arithmetic Circuits Module...");

        // Initialize simulators
        window.halfAdder = new HalfAdderSimulator('half-adder-svg');
        // The following lines will fail if the SVG elements don't exist,
        // which is expected if they are just placeholders.
        try {
            window.fullAdder = new FullAdderSimulator('full-adder-svg');
        } catch (e) {
            console.warn("FullAdder SVG not found. Skipping initialization.");
        }
        try {
            window.rippleCarryAdder = new RippleCarryAdderSimulator('ripple-carry-svg');
        } catch(e) {
            console.warn("RippleCarryAdder SVG not found. Skipping initialization.");
        }
        
        // Quiz data
        const quizData = [
            {
                question: "What are the outputs of a half-adder?",
                options: ["Sum and Carry", "Input and Output", "A and B"],
                answer: 0
            },
            {
                question: "A full-adder can be constructed from:",
                options: ["Two AND gates and one OR gate", "Two XOR gates", "Two half-adders and an OR gate"],
                answer: 2
            }
        ];

        // Initialize quiz system
        window.quizManager = new QuizManager(quizData);

        console.log("Module initialized successfully.");
    } catch (error) {
        console.error("Failed to initialize arithmetic module:", error);
        // Display an error message to the user in the UI
        const container = document.querySelector('.module-container');
        if (container) {
            const errorDiv = document.createElement('div');
            errorDiv.textContent = 'Error: The interactive module could not be loaded. Please try refreshing the page.';
            errorDiv.style.color = 'red';
            errorDiv.style.padding = '10px';
            errorDiv.style.border = '1px solid red';
            container.prepend(errorDiv);
        }
    }
}

function cleanupArithmeticModule() {
    try {
        console.log("Cleaning up Arithmetic Module...");
        
        // Update completion status if appropriate
        if (window.progressTracker && window.progressTracker.getTotalProgress() === 100) {
            window.progressTracker.markComplete({
                quizScore: window.quizManager ? window.quizManager.calculateScore() : 0,
                timeSpent: window.progressTracker.getTimeSpent(),
                sectionsCompleted: ['half-adder', 'full-adder', 'ripple-carry', 'assessment']
            });
        }
        
        // Clear any ongoing animations or timers
        // (Add cleanup code here if needed)
        
    } catch (error) {
        console.warn('Error during module cleanup:', error);
    }
}

// Initialize when DOM is fully loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeCompleteArithmeticModule);
} else {
    // DOM already loaded
    initializeCompleteArithmeticModule();
}

// Handle page unload
window.addEventListener('beforeunload', cleanupArithmeticModule);

// Export for debugging
window.ArithmeticModule = {
    initialize: initializeCompleteArithmeticModule,
    cleanup: cleanupArithmeticModule,
    getStatus: () => ({
        progressTracker: window.progressTracker,
        simulators: {
            halfAdder: window.halfAdder,
            fullAdder: window.fullAdder, 
            rippleCarryAdder: window.rippleCarryAdder
        },
        quizManager: window.quizManager
    })
};
    </script>
</body>
</html>
