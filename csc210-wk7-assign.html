<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 7 Assignment: MIPS Control Flow & Procedures</title>
    
    <!-- Required CDN Links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Meta Comments -->
    <!-- Chosen Palette: Scholarly Neutrals -->
    <!-- Application Structure Plan: Progressive MIPS programming exercises covering branching, loops, procedures, and recursion -->
    <!-- Visualization & Content Choices: Interactive code completion with real-time feedback and MARS simulator integration -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    
    <style>
        body {
            background-color: #FDFBF8;
            color: #383838;
            font-family: 'Inter', sans-serif;
        }

        .worksheet-input {
            font-family: 'Fira Code', monospace;
            border: 1px solid #D1C7BF;
            background-color: #FFFFFF;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .worksheet-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }

        .submit-btn {
            background-color: #4A90E2;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
        }

        .submit-btn:hover {
            background-color: #357ABD;
        }

        .check-btn {
            background-color: #EADDD7;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
        }

        .check-btn:hover {
            background-color: #D1C7BF;
        }

        .code-block {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            font-family: 'Fira Code', monospace;
        }

        .success-feedback {
            background-color: #28a745;
            color: white;
        }

        .error-feedback {
            background-color: #dc3545;
            color: white;
        }

        .hint-feedback {
            background-color: #ffc107;
            color: #212529;
        }

        @media print {
            .no-print { display: none; }
            body { background: white; color: black; }
            .worksheet-input { border: 1px solid #000; }
        }
    </style>
</head>

<body class="antialiased">
    <main class="container mx-auto max-w-4xl p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Week 7 Assignment: MIPS Control Flow & Procedures</h1>
            <div class="text-lg text-gray-600 mb-6">
                <p>Master conditional branching, loops, and procedure calls in MIPS assembly</p>
                <p class="text-sm mt-2"><strong>Due:</strong> [Insert Due Date] | <strong>Points:</strong> 100</p>
            </div>
        </header>

        <!-- Assignment Overview -->
        <section class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">ðŸ“‹ Assignment Overview</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold mb-2">Learning Objectives:</h3>
                    <ul class="text-sm space-y-1">
                        <li>âœ“ Implement conditional branching logic</li>
                        <li>âœ“ Construct while, for, and do-while loops</li>
                        <li>âœ“ Follow MIPS calling conventions</li>
                        <li>âœ“ Manage the runtime stack properly</li>
                        <li>âœ“ Write recursive procedures</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Tools Needed:</h3>
                    <ul class="text-sm space-y-1">
                        <li>â€¢ MARS MIPS Simulator</li>
                        <li>â€¢ Text editor or IDE</li>
                        <li>â€¢ MIPS Green Sheet (reference)</li>
                        <li>â€¢ This interactive worksheet</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Problem 1: Conditional Logic -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Problem 1: Grade Calculator (20 points)</h2>
            <p class="mb-4">Write a MIPS program that reads a numeric grade (0-100) and outputs the corresponding letter grade using the standard scale:</p>
            
            <div class="bg-gray-50 p-4 rounded mb-4">
                <ul class="text-sm space-y-1">
                    <li>A: 90-100</li>
                    <li>B: 80-89</li>
                    <li>C: 70-79</li>
                    <li>D: 60-69</li>
                    <li>F: 0-59</li>
                </ul>
            </div>

            <div class="mb-4">
                <label class="block font-medium mb-2">Complete the MIPS code below:</label>
                <div class="code-block mb-4">.data
grade_prompt: .asciiz "Enter numeric grade (0-100): "
grade_a: .asciiz "Letter Grade: A\n"
grade_b: .asciiz "Letter Grade: B\n"
grade_c: .asciiz "Letter Grade: C\n"
grade_d: .asciiz "Letter Grade: D\n"
grade_f: .asciiz "Letter Grade: F\n"

.text
.globl main
main:
    # Print prompt
    li $v0, 4
    la $a0, grade_prompt
    syscall
    
    # Read integer
    li $v0, 5
    syscall
    move $t0, $v0    # $t0 = grade
    
    # Your conditional logic here
    # Complete the branching structure</div>
                
                <textarea class="worksheet-input w-full h-40" id="problem1-answer" 
                          placeholder="Write your conditional branching code here...
Example:
    li $t1, 90
    bge $t0, $t1, print_a
    # Continue with other conditions..."></textarea>
            </div>

            <div class="mb-4">
                <button class="check-btn" onclick="checkProblem1()">Check Solution</button>
                <div id="problem1-feedback" class="mt-2"></div>
            </div>

            <details class="mb-4">
                <summary class="cursor-pointer font-medium">ðŸ’¡ Hints (click to expand)</summary>
                <div class="mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded">
                    <ul class="text-sm space-y-1">
                        <li>â€¢ Use bge (branch greater or equal) to check upper bounds</li>
                        <li>â€¢ Start with the highest grade and work down</li>
                        <li>â€¢ Each branch should jump to the appropriate print statement</li>
                        <li>â€¢ Don't forget to exit the program after printing</li>
                    </ul>
                </div>
            </details>
        </section>

        <!-- Problem 2: Loop Construction -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Problem 2: Sum Calculator (25 points)</h2>
            <p class="mb-4">Write a MIPS program that calculates the sum of integers from 1 to N, where N is entered by the user. Use a loop structure.</p>

            <div class="grid md:grid-cols-2 gap-6 mb-4">
                <div>
                    <h3 class="font-semibold mb-2">Part A: While Loop Implementation</h3>
                    <textarea class="worksheet-input w-full h-32" id="problem2a-answer" 
                              placeholder="# Calculate sum using while loop
# Assume N is in $t0, sum should be in $t1
li $t1, 0        # sum = 0
li $t2, 1        # counter = 1

# Your while loop here..."></textarea>
                    <button class="check-btn mt-2" onclick="checkProblem2A()">Check While Loop</button>
                    <div id="problem2a-feedback" class="mt-2"></div>
                </div>

                <div>
                    <h3 class="font-semibold mb-2">Part B: For Loop Implementation</h3>
                    <textarea class="worksheet-input w-full h-32" id="problem2b-answer" 
                              placeholder="# Calculate sum using for loop pattern
# Assume N is in $t0, sum should be in $t1
li $t1, 0        # sum = 0

# Your for loop here..."></textarea>
                    <button class="check-btn mt-2" onclick="checkProblem2B()">Check For Loop</button>
                    <div id="problem2b-feedback" class="mt-2"></div>
                </div>
            </div>

            <div class="mb-4">
                <h3 class="font-semibold mb-2">Part C: Complete Program</h3>
                <p class="text-sm mb-2">Combine your loop with input/output to create a complete program:</p>
                <textarea class="worksheet-input w-full h-40" id="problem2c-answer" 
                          placeholder="Write the complete program including:
- Data section with prompts
- Input reading
- Your loop implementation  
- Output of the result"></textarea>
                <button class="check-btn mt-2" onclick="checkProblem2C()">Check Complete Program</button>
                <div id="problem2c-feedback" class="mt-2"></div>
            </div>
        </section>

        <!-- Problem 3: Procedure Calls -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Problem 3: Maximum Finder Procedure (25 points)</h2>
            <p class="mb-4">Write a MIPS procedure that finds the maximum of three integers following proper calling conventions.</p>

            <div class="bg-blue-50 p-4 rounded mb-4">
                <h3 class="font-semibold mb-2">Procedure Specification:</h3>
                <ul class="text-sm space-y-1">
                    <li><strong>Name:</strong> find_max_three</li>
                    <li><strong>Parameters:</strong> Three integers in $a0, $a1, $a2</li>
                    <li><strong>Returns:</strong> Maximum value in $v0</li>
                    <li><strong>Requirements:</strong> Must follow MIPS calling conventions</li>
                </ul>
            </div>

            <div class="mb-4">
                <label class="block font-medium mb-2">Implement the procedure:</label>
                <textarea class="worksheet-input w-full h-48" id="problem3-answer" 
                          placeholder="find_max_three:
    # Prologue - save registers if needed
    
    # Your logic to find maximum of $a0, $a1, $a2
    # Store result in $v0
    
    # Compare $a0 and $a1 first
    # Then compare result with $a2
    
    # Epilogue - restore registers and return
    jr $ra"></textarea>
            </div>

            <div class="mb-4">
                <label class="block font-medium mb-2">Write a main program that tests your procedure:</label>
                <textarea class="worksheet-input w-full h-32" id="problem3-main" 
                          placeholder="main:
    # Load test values into $a0, $a1, $a2
    # Call find_max_three
    # Print the result"></textarea>
            </div>

            <button class="check-btn" onclick="checkProblem3()">Check Procedure Implementation</button>
            <div id="problem3-feedback" class="mt-2"></div>
        </section>

        <!-- Problem 4: Stack Management -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Problem 4: Stack Operations (15 points)</h2>
            <p class="mb-4">Complete the stack management code for a procedure that calls another procedure.</p>

            <div class="code-block mb-4">outer_procedure:
    # This procedure calls inner_procedure and uses $s0, $s1
    # Complete the prologue and epilogue</div>

            <div class="grid md:grid-cols-2 gap-6 mb-4">
                <div>
                    <label class="block font-medium mb-2">Prologue (saving registers):</label>
                    <textarea class="worksheet-input w-full h-24" id="problem4a-answer" 
                              placeholder="# Save necessary registers
addi $sp, $sp, ___
sw $ra, ___($sp)
sw $s0, ___($sp)
sw $s1, ___($sp)"></textarea>
                </div>

                <div>
                    <label class="block font-medium mb-2">Epilogue (restoring registers):</label>
                    <textarea class="worksheet-input w-full h-24" id="problem4b-answer" 
                              placeholder="# Restore registers
lw $s1, ___($sp)
lw $s0, ___($sp) 
lw $ra, ___($sp)
addi $sp, $sp, ___
jr $ra"></textarea>
                </div>
            </div>

            <button class="check-btn" onclick="checkProblem4()">Check Stack Operations</button>
            <div id="problem4-feedback" class="mt-2"></div>
        </section>

        <!-- Problem 5: Recursive Programming -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Problem 5: Recursive Factorial (15 points)</h2>
            <p class="mb-4">Implement a recursive factorial function with proper stack management and base case handling.</p>

            <div class="bg-red-50 p-4 rounded mb-4">
                <h3 class="font-semibold mb-2">Factorial Definition:</h3>
                <ul class="text-sm space-y-1">
                    <li>factorial(0) = 1 (base case)</li>
                    <li>factorial(n) = n Ã— factorial(n-1) for n > 0</li>
                </ul>
            </div>

            <div class="mb-4">
                <label class="block font-medium mb-2">Complete the recursive factorial procedure:</label>
                <textarea class="worksheet-input w-full h-56" id="problem5-answer" 
                          placeholder="factorial:
    # Input: $a0 = n
    # Output: $v0 = n!
    
    # Prologue
    
    # Base case: if n == 0, return 1
    
    # Recursive case:
    # 1. Save n
    # 2. Calculate factorial(n-1)  
    # 3. Multiply result by n
    # 4. Return result
    
    # Epilogue"></textarea>
            </div>

            <button class="check-btn" onclick="checkProblem5()">Check Recursive Implementation</button>
            <div id="problem5-feedback" class="mt-2"></div>
        </section>

        <!-- Submission Section -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-4">ðŸ“¤ Submission</h2>
            <div class="bg-gray-50 p-6 rounded-lg">
                <div class="mb-4">
                    <h3 class="font-semibold mb-2">Completion Status:</h3>
                    <div class="grid md:grid-cols-5 gap-4 text-sm">
                        <div class="text-center">
                            <div id="status1" class="w-8 h-8 rounded-full bg-gray-300 mx-auto mb-1"></div>
                            <div>Problem 1</div>
                        </div>
                        <div class="text-center">
                            <div id="status2" class="w-8 h-8 rounded-full bg-gray-300 mx-auto mb-1"></div>
                            <div>Problem 2</div>
                        </div>
                        <div class="text-center">
                            <div id="status3" class="w-8 h-8 rounded-full bg-gray-300 mx-auto mb-1"></div>
                            <div>Problem 3</div>
                        </div>
                        <div class="text-center">
                            <div id="status4" class="w-8 h-8 rounded-full bg-gray-300 mx-auto mb-1"></div>
                            <div>Problem 4</div>
                        </div>
                        <div class="text-center">
                            <div id="status5" class="w-8 h-8 rounded-full bg-gray-300 mx-auto mb-1"></div>
                            <div>Problem 5</div>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button class="submit-btn" onclick="window.print()">ðŸ’¾ Save as PDF</button>
                    <p class="text-sm text-gray-600 mt-2">Save this completed assignment and submit according to your instructor's directions.</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Problem completion tracking
        let problemStatus = {
            1: false, 2: false, 3: false, 4: false, 5: false
        };

        // Problem 1: Grade Calculator
        function checkProblem1() {
            const answer = document.getElementById('problem1-answer').value.toLowerCase();
            const feedback = document.getElementById('problem1-feedback');
            
            // Check for key components
            const hasComparisons = answer.includes('bge') || answer.includes('blt') || answer.includes('ble') || answer.includes('bgt');
            const hasLabels = answer.includes(':') && (answer.includes('print') || answer.includes('grade'));
            const hasConstants = answer.includes('90') && answer.includes('80') && answer.includes('70') && answer.includes('60');
            
            if (hasComparisons && hasLabels && hasConstants) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Great! Your solution includes proper branching logic, labels, and grade boundaries.</div>';
                problemStatus[1] = true;
                updateStatus(1);
            } else {
                let hints = [];
                if (!hasComparisons) hints.push('Include branch instructions (bge, blt, etc.)');
                if (!hasLabels) hints.push('Create labels for each grade output');
                if (!hasConstants) hints.push('Use the correct grade boundaries (90, 80, 70, 60)');
                
                feedback.innerHTML = `<div class="p-3 rounded hint-feedback">ðŸ’¡ Getting closer! Consider: ${hints.join(', ')}</div>`;
            }
        }

        // Problem 2A: While Loop
        function checkProblem2A() {
            const answer = document.getElementById('problem2a-answer').value.toLowerCase();
            const feedback = document.getElementById('problem2a-feedback');
            
            const hasLoop = answer.includes('loop') || answer.includes('while');
            const hasCondition = answer.includes('bgt') || answer.includes('ble') || answer.includes('bge') || answer.includes('blt');
            const hasAdd = answer.includes('add') && answer.includes('$t1');
            const hasIncrement = answer.includes('addi') && answer.includes('$t2');
            const hasJump = answer.includes('j ') || answer.includes('b ');
            
            if (hasLoop && hasCondition && hasAdd && hasIncrement && hasJump) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Excellent while loop structure!</div>';
                updateProblem2Status();
            } else {
                feedback.innerHTML = '<div class="p-3 rounded hint-feedback">ðŸ’¡ Include: loop label, condition check, sum accumulation, counter increment, and jump back.</div>';
            }
        }

        // Problem 2B: For Loop
        function checkProblem2B() {
            const answer = document.getElementById('problem2b-answer').value.toLowerCase();
            const feedback = document.getElementById('problem2b-feedback');
            
            const hasLoop = answer.includes('for') || answer.includes('loop');
            const hasCondition = answer.includes('bgt') || answer.includes('ble') || answer.includes('bge') || answer.includes('blt');
            const hasAdd = answer.includes('add');
            
            if (hasLoop && hasCondition && hasAdd) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Good for loop implementation!</div>';
                updateProblem2Status();
            } else {
                feedback.innerHTML = '<div class="p-3 rounded hint-feedback">ðŸ’¡ For loops need initialization, condition, body, and increment.</div>';
            }
        }

        // Problem 2C: Complete Program
        function checkProblem2C() {
            const answer = document.getElementById('problem2c-answer').value.toLowerCase();
            const feedback = document.getElementById('problem2c-feedback');
            
            const hasData = answer.includes('.data');
            const hasInput = answer.includes('syscall') && answer.includes('5');
            const hasOutput = answer.includes('syscall') && answer.includes('1');
            const hasLoop = answer.includes('loop') || answer.includes('while') || answer.includes('for');
            
            if (hasData && hasInput && hasOutput && hasLoop) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Complete program with all required components!</div>';
                problemStatus[2] = true;
                updateStatus(2);
            } else {
                feedback.innerHTML = '<div class="p-3 rounded hint-feedback">ðŸ’¡ Include: .data section, input syscall, loop implementation, and output syscall.</div>';
            }
        }

        function updateProblem2Status() {
            const a = document.getElementById('problem2a-feedback').innerHTML.includes('success-feedback');
            const b = document.getElementById('problem2b-feedback').innerHTML.includes('success-feedback');
            const c = document.getElementById('problem2c-feedback').innerHTML.includes('success-feedback');
            
            if (a && b && c) {
                problemStatus[2] = true;
                updateStatus(2);
            }
        }

        // Problem 3: Procedure Implementation
        function checkProblem3() {
            const answer = document.getElementById('problem3-answer').value.toLowerCase();
            const main = document.getElementById('problem3-main').value.toLowerCase();
            const feedback = document.getElementById('problem3-feedback');
            
            const hasLabel = answer.includes('find_max_three:');
            const hasComparisons = answer.includes('bgt') || answer.includes('bge') || answer.includes('blt') || answer.includes('ble');
            const hasReturn = answer.includes('jr $ra');
            const hasResult = answer.includes('$v0');
            const hasCall = main.includes('jal') && main.includes('find_max_three');
            
            if (hasLabel && hasComparisons && hasReturn && hasResult && hasCall) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Excellent procedure with proper calling conventions!</div>';
                problemStatus[3] = true;
                updateStatus(3);
            } else {
                feedback.innerHTML = '<div class="p-3 rounded hint-feedback">ðŸ’¡ Include: procedure label, comparison logic, $v0 result, jr $ra return, and jal call in main.</div>';
            }
        }

        // Problem 4: Stack Operations
        function checkProblem4() {
            const prologue = document.getElementById('problem4a-answer').value;
            const epilogue = document.getElementById('problem4b-answer').value;
            const feedback = document.getElementById('problem4-feedback');
            
            const prologueCorrect = prologue.includes('-12') && prologue.includes('8($sp)') && prologue.includes('4($sp)') && prologue.includes('0($sp)');
            const epilogueCorrect = epilogue.includes('0($sp)') && epilogue.includes('4($sp)') && epilogue.includes('8($sp)') && epilogue.includes('12');
            
            if (prologueCorrect && epilogueCorrect) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Perfect stack management! Proper allocation, saving, and restoration order.</div>';
                problemStatus[4] = true;
                updateStatus(4);
            } else {
                feedback.innerHTML = '<div class="p-3 rounded hint-feedback">ðŸ’¡ Remember: allocate -12 bytes, save in order ($ra at 8, $s0 at 4, $s1 at 0), restore in reverse order.</div>';
            }
        }

        // Problem 5: Recursive Factorial
        function checkProblem5() {
            const answer = document.getElementById('problem5-answer').value.toLowerCase();
            const feedback = document.getElementById('problem5-feedback');
            
            const hasBaseCase = answer.includes('beq') && answer.includes('0') && answer.includes('1');
            const hasRecursiveCall = answer.includes('jal') && answer.includes('factorial');
            const hasStack = answer.includes('addi') && answer.includes('$sp') && answer.includes('sw') && answer.includes('lw');
            const hasMultiplication = answer.includes('mul') || (answer.includes('mult') && answer.includes('mflo'));
            const hasReturn = answer.includes('jr $ra');
            
            if (hasBaseCase && hasRecursiveCall && hasStack && hasMultiplication && hasReturn) {
                feedback.innerHTML = '<div class="p-3 rounded success-feedback">âœ… Outstanding recursive implementation with proper base case, stack management, and multiplication!</div>';
                problemStatus[5] = true;
                updateStatus(5);
            } else {
                feedback.innerHTML = '<div class="p-3 rounded hint-feedback">ðŸ’¡ Include: base case check, recursive jal call, stack operations, multiplication of result, and return.</div>';
            }
        }

        // Update visual status indicators
        function updateStatus(problemNum) {
            const status = document.getElementById(`status${problemNum}`);
            if (problemStatus[problemNum]) {
                status.className = 'w-8 h-8 rounded-full bg-green-500 mx-auto mb-1';
                status.innerHTML = '<div class="text-white text-xs leading-8">âœ“</div>';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            console.log('MIPS Control Flow & Procedures Assignment loaded');
        });
    </script>
</body>
</html>