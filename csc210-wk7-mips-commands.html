<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIPS Control Flow Instructions - Interactive Reference Guide</title>
    
    <!-- CDN Links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #FDFBF8;
            color: #383838;
            font-family: 'Inter', sans-serif;
        }
        
        .code-font {
            font-family: 'Fira Code', monospace;
        }
        
        .tab-active {
            background-color: #EADDD7;
            border-bottom: 3px solid #383838;
        }
        
        .tab-inactive {
            background-color: #F0EBE8;
        }
        
        .tab-inactive:hover {
            background-color: #EADDD7;
        }
        
        .interactive-box {
            border: 2px solid #EADDD7;
            border-radius: 8px;
            background-color: #FDFBF8;
        }
        
        .instruction-card {
            border: 1px solid #EADDD7;
            border-radius: 6px;
            background-color: #FDFBF8;
            transition: all 0.3s ease;
        }
        
        .instruction-card:hover {
            background-color: #F0EBE8;
            border-color: #383838;
        }
        
        .binary-field {
            border: 1px solid #383838;
            text-align: center;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            background-color: #F0EBE8;
        }
        
        .field-label {
            font-size: 10px;
            color: #666;
            text-align: center;
        }
        
        .success-highlight {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
/* Add this to the existing style section */
.binary-bit {
    width: 24px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: 1px solid #ccc;
    font-family: 'Fira Code', monospace;
    font-size: 11px;
    font-weight: bold;
    border-radius: 3px;
    transition: all 0.2s ease;
    flex-shrink: 0; /* Prevent shrinking */
}

.binary-bit:hover {
    border-color: #6b7280;
    transform: scale(1.05);
}

.binary-bit.active {
    background-color: #3b82f6;
    color: white;
    border-color: #2563eb;
}

.binary-bit.active:hover {
    background-color: #2563eb;
}

/* Field coloring for visual grouping */
.binary-bit.opcode-field {
    background-color: #fef2f2;
    border-color: #fca5a5;
}

.binary-bit.opcode-field.active {
    background-color: #dc2626;
    border-color: #b91c1c;
}

.binary-bit.register-field {
    background-color: #eff6ff;
    border-color: #93c5fd;
}

.binary-bit.register-field.active {
    background-color: #2563eb;
    border-color: #1d4ed8;
}

.binary-bit.immediate-field {
    background-color: #f0fdf4;
    border-color: #86efac;
}

.binary-bit.immediate-field.active {
    background-color: #16a34a;
    border-color: #15803d;
}
        
        .field-group {
            border: 2px solid #6b7280;
            border-radius: 4px;
            padding: 2px;
            margin: 1px;
        }
        
        .field-group.opcode { border-color: #dc2626; background-color: #fef2f2; }
        .field-group.register { border-color: #2563eb; background-color: #eff6ff; }
        .field-group.immediate { border-color: #059669; background-color: #f0fdf4; }
        .field-group.address { border-color: #d97706; background-color: #fffbeb; }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">üìò MIPS Control Flow Instructions</h1>
            <h2 class="text-xl md:text-2xl text-gray-600 mb-6">Interactive Reference & Binary Encoding Guide</h2>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-red-600">15+</div>
                    <div class="text-sm">Branch Instructions</div>
                </div>
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-blue-600">4</div>
                    <div class="text-sm">Jump Instructions</div>
                </div>
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-orange-600">3</div>
                    <div class="text-sm">Instruction Formats</div>
                </div>
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-green-600">32</div>
                    <div class="text-sm">Bits per Instruction</div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="mb-8" role="tablist">
            <div class="flex flex-wrap justify-center gap-2">
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-active" 
                        data-tab="formats" role="tab" aria-selected="true">
                    üìã Instruction Formats
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="branches" role="tab" aria-selected="false">
                    üîÄ Branch Instructions
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="jumps" role="tab" aria-selected="false">
                    üöÄ Jump Instructions
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="encoder" role="tab" aria-selected="false">
                    üîß Binary Encoder
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="practice" role="tab" aria-selected="false">
                    üéØ Practice Quiz
                </button>
            </div>
        </nav>

        <main id="main-content">
            <!-- Instruction Formats Panel -->
            <div id="formats-panel" class="tab-content">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üìã MIPS Instruction Formats</h2>
                    
                    <!-- Format Overview -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéØ Three Main Instruction Types</h3>
                        <p class="mb-6">All MIPS instructions are exactly 32 bits long and follow one of three formats:</p>
                        
                        <div class="grid lg:grid-cols-3 gap-6">
                            <!-- R-Type -->
                            <div class="bg-white p-4 rounded-lg border-l-4 border-red-500">
                                <h4 class="font-semibold text-red-600 mb-3">R-Type (Register)</h4>
                                <p class="text-sm mb-4">Used for register operations like jr</p>
                                
                                <div class="mb-4">
                                    <div class="grid grid-cols-6 gap-0 text-xs">
                                        <div class="field-label">op (6)</div>
                                        <div class="field-label">rs (5)</div>
                                        <div class="field-label">rt (5)</div>
                                        <div class="field-label">rd (5)</div>
                                        <div class="field-label">shamt (5)</div>
                                        <div class="field-label">funct (6)</div>
                                    </div>
                                    <div class="grid grid-cols-6 gap-0">
                                        <div class="binary-field p-2">000000</div>
                                        <div class="binary-field p-2">rs</div>
                                        <div class="binary-field p-2">00000</div>
                                        <div class="binary-field p-2">00000</div>
                                        <div class="binary-field p-2">00000</div>
                                        <div class="binary-field p-2">funct</div>
                                    </div>
                                </div>
                                
                                <div class="text-xs space-y-1">
                                    <div><strong>op:</strong> Always 000000 for R-type</div>
                                    <div><strong>rs:</strong> Source register</div>
                                    <div><strong>funct:</strong> Function code (jr=001000)</div>
                                </div>
                            </div>

                            <!-- I-Type -->
                            <div class="bg-white p-4 rounded-lg border-l-4 border-blue-500">
                                <h4 class="font-semibold text-blue-600 mb-3">I-Type (Immediate)</h4>
                                <p class="text-sm mb-4">Used for branches with offsets</p>
                                
                                <div class="mb-4">
                                    <div class="grid grid-cols-4 gap-0 text-xs">
                                        <div class="field-label">op (6)</div>
                                        <div class="field-label">rs (5)</div>
                                        <div class="field-label">rt (5)</div>
                                        <div class="field-label">immediate (16)</div>
                                    </div>
                                    <div class="grid grid-cols-4 gap-0">
                                        <div class="binary-field p-2">opcode</div>
                                        <div class="binary-field p-2">rs</div>
                                        <div class="binary-field p-2">rt</div>
                                        <div class="binary-field p-2">offset</div>
                                    </div>
                                </div>
                                
                                <div class="text-xs space-y-1">
                                    <div><strong>op:</strong> Identifies instruction</div>
                                    <div><strong>rs/rt:</strong> Registers to compare</div>
                                    <div><strong>immediate:</strong> Branch offset</div>
                                </div>
                            </div>

                            <!-- J-Type -->
                            <div class="bg-white p-4 rounded-lg border-l-4 border-orange-500">
                                <h4 class="font-semibold text-orange-600 mb-3">J-Type (Jump)</h4>
                                <p class="text-sm mb-4">Used for jumps with large addresses</p>
                                
                                <div class="mb-4">
                                    <div class="grid grid-cols-2 gap-0 text-xs">
                                        <div class="field-label">op (6)</div>
                                        <div class="field-label">address (26)</div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-0">
                                        <div class="binary-field p-2">opcode</div>
                                        <div class="binary-field p-2">jump target</div>
                                    </div>
                                </div>
                                
                                <div class="text-xs space-y-1">
                                    <div><strong>op:</strong> j=000010, jal=000011</div>
                                    <div><strong>address:</strong> 26-bit jump target</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Format Identifier -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéÆ Interactive Format Identifier</h3>
                        <p class="mb-4">Click on an instruction to see its format breakdown:</p>
                        
                        <div class="grid md:grid-cols-3 gap-4 mb-6">
                            <button class="instruction-btn p-4 border rounded-lg hover:bg-gray-50 transition-colors" 
                                    onclick="showInstructionFormat('beq', 'I')">
                                <div class="code-font font-semibold">beq $t0, $t1, label</div>
                                <div class="text-sm text-gray-600">Branch if Equal</div>
                            </button>
                            <button class="instruction-btn p-4 border rounded-lg hover:bg-gray-50 transition-colors" 
                                    onclick="showInstructionFormat('j', 'J')">
                                <div class="code-font font-semibold">j label</div>
                                <div class="text-sm text-gray-600">Jump</div>
                            </button>
                            <button class="instruction-btn p-4 border rounded-lg hover:bg-gray-50 transition-colors" 
                                    onclick="showInstructionFormat('jr', 'R')">
                                <div class="code-font font-semibold">jr $ra</div>
                                <div class="text-sm text-gray-600">Jump Register</div>
                            </button>
                        </div>
                        
                        <div id="format-display" class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-center text-gray-500">
                                Click an instruction above to see its binary format
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Branch Instructions Panel -->
            <div id="branches-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üîÄ Branch Instructions</h2>
                    
                    <!-- Branch Introduction -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéØ What are Branch Instructions?</h3>
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-3 text-blue-600">Understanding Branches</h4>
                                <p class="text-sm mb-4">
                                    <strong>Branch instructions</strong> are <em>conditional</em> control flow instructions that can change 
                                    the normal sequential execution of a program. They examine values in registers and decide whether 
                                    to "take the branch" (jump to a different location) or continue with the next instruction.
                                </p>
                                <div class="bg-blue-50 p-3 rounded text-sm">
                                    <strong>Key Characteristics:</strong>
                                    <ul class="list-disc list-inside mt-2 space-y-1">
                                        <li><strong>Conditional:</strong> Only execute if condition is true</li>
                                        <li><strong>PC-Relative:</strong> Target calculated relative to current position</li>
                                        <li><strong>Limited Range:</strong> Can branch ¬±32KB from current instruction</li>
                                        <li><strong>I-Type Format:</strong> Use 16-bit offset field</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-3 text-green-600">Labels and Targets</h4>
                                <p class="text-sm mb-4">
                                    In MIPS assembly, a <strong>label</strong> is a symbolic name that represents a memory address. 
                                    When you write <code>beq $t0, $t1, loop_start</code>, the assembler converts <code>loop_start</code> 
                                    into a numeric offset.
                                </p>
                                <div class="bg-green-50 p-3 rounded text-sm">
                                    <strong>Examples of Labels:</strong>
                                    <div class="code-font mt-2 space-y-1">
                                        <div>main:           # Program entry point</div>
                                        <div>loop_start:     # Beginning of a loop</div>
                                        <div>exit_program:   # End of program</div>
                                        <div>error_handler:  # Error handling code</div>
                                    </div>
                                </div>
                                <p class="text-xs mt-2 text-gray-600">
                                    <strong>Branch Target Calculation:</strong> target = PC + 4 + (offset √ó 4)
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Branch Reference -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìö Complete Branch Reference</h3>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <!-- Two-Register Branches -->
                            <div>
                                <h4 class="font-semibold mb-4 text-blue-600">üî¢ Two-Register Branches</h4>
                                <div class="space-y-3">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">beq rs, rt, label</div>
                                                <div class="text-sm text-gray-600">Branch if Equal</div>
                                            </div>
                                            <div class="text-xs bg-blue-100 px-2 py-1 rounded">000100</div>
                                        </div>
                                        <div class="text-sm">Branches if rs == rt</div>
                                        <div class="text-xs text-gray-500 mt-1">Common for loop termination and equality checks</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">bne rs, rt, label</div>
                                                <div class="text-sm text-gray-600">Branch if Not Equal</div>
                                            </div>
                                            <div class="text-xs bg-blue-100 px-2 py-1 rounded">000101</div>
                                        </div>
                                        <div class="text-sm">Branches if rs != rt</div>
                                        <div class="text-xs text-gray-500 mt-1">Common for null checks: bne $t0, $zero, continue</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Single Register Branches -->
                            <div>
                                <h4 class="font-semibold mb-4 text-green-600">üéØ Single Register Branches</h4>
                                <div class="space-y-3">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">bltz rs, label</div>
                                                <div class="text-sm text-gray-600">Branch if Less Than Zero</div>
                                            </div>
                                            <div class="text-xs bg-green-100 px-2 py-1 rounded">000001</div>
                                        </div>
                                        <div class="text-sm">Branches if rs < 0</div>
                                        <div class="text-xs text-gray-500 mt-1">Useful for negative number detection</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">bgez rs, label</div>
                                                <div class="text-sm text-gray-600">Branch Greater or Equal Zero</div>
                                            </div>
                                            <div class="text-xs bg-green-100 px-2 py-1 rounded">000001</div>
                                        </div>
                                        <div class="text-sm">Branches if rs ‚â• 0</div>
                                        <div class="text-xs text-gray-500 mt-1">Useful for positive/zero number checks</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Branch Decoder -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üîç Interactive Branch Decoder</h3>
                        <p class="mb-4">Enter a branch instruction to see its binary encoding:</p>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block font-medium mb-2">Enter Branch Instruction:</label>
                                <input type="text" id="branch-input" 
                                       class="w-full p-3 border rounded code-font" 
                                       placeholder="beq $t0, $t1, loop_start">
                                
                                <div class="mt-4 space-y-2">
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm"
                                            onclick="loadBranchExample('beq $t0, $t1, 8')">
                                        Example: beq
                                    </button>
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm ml-2"
                                            onclick="loadBranchExample('bne $s0, $zero, -4')">
                                        Example: bne
                                    </button>
                                    <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm ml-2"
                                            onclick="loadBranchExample('bltz $t0, error_handler')">
                                        Example: bltz
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-2">Binary Encoding:</h4>
                                <div id="branch-decode-result" class="bg-gray-50 p-4 rounded min-h-32">
                                    <div class="text-center text-gray-500 mt-4">
                                        Enter a branch instruction to see its encoding
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Jump Instructions Panel -->
            <div id="jumps-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üöÄ Jump Instructions</h2>
                    
                    <!-- Jump Introduction -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéØ What are Jump Instructions?</h3>
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-3 text-orange-600">Understanding Jumps</h4>
                                <p class="text-sm mb-4">
                                    <strong>Jump instructions</strong> are <em>unconditional</em> control flow instructions that 
                                    always change the program's execution flow. Unlike branches, jumps don't test any conditions‚Äîthey 
                                    always transfer control to the specified target address.
                                </p>
                                <div class="bg-orange-50 p-3 rounded text-sm">
                                    <strong>Key Characteristics:</strong>
                                    <ul class="list-disc list-inside mt-2 space-y-1">
                                        <li><strong>Unconditional:</strong> Always executed, no condition checking</li>
                                        <li><strong>Larger Range:</strong> Can reach any address in 256MB region</li>
                                        <li><strong>Two Types:</strong> Direct (J-type) and Indirect (R-type)</li>
                                        <li><strong>Function Calls:</strong> Some jumps save return addresses</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-3 text-red-600">Targets in Jump Instructions</h4>
                                <p class="text-sm mb-4">
                                    Jump <strong>targets</strong> can be specified in two ways: as labels (like branches) or as 
                                    register contents. The target represents where program execution should continue.
                                </p>
                                <div class="bg-red-50 p-3 rounded text-sm">
                                    <strong>Types of Jump Targets:</strong>
                                    <div class="mt-2 space-y-2">
                                        <div><strong>Direct (Labels):</strong></div>
                                        <div class="code-font ml-4 text-xs">
                                            j main_loop      # Jump to main_loop label<br>
                                            jal calculate    # Call calculate function
                                        </div>
                                        <div><strong>Indirect (Registers):</strong></div>
                                        <div class="code-font ml-4 text-xs">
                                            jr $ra          # Return from function<br>
                                            jalr $t0        # Call function at address in $t0
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs mt-2 text-gray-600">
                                    <strong>Common Uses:</strong> Function calls, returns, long-distance jumps, jump tables
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Jump Instructions Reference -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìö Complete Jump Reference</h3>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <!-- J-Type Jumps -->
                            <div>
                                <h4 class="font-semibold mb-4 text-orange-600">üåê J-Type Jumps (Direct)</h4>
                                <div class="space-y-4">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">j target</div>
                                                <div class="text-sm text-gray-600">Jump</div>
                                            </div>
                                            <div class="text-xs bg-orange-100 px-2 py-1 rounded">000010</div>
                                        </div>
                                        <div class="text-sm mb-2">Unconditionally jump to target address</div>
                                        <div class="text-xs text-gray-500">PC = (PC+4)[31:28] | address << 2</div>
                                        <div class="text-xs mt-2"><strong>Use case:</strong> Long jumps, goto-style control flow</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">jal target</div>
                                                <div class="text-sm text-gray-600">Jump and Link</div>
                                            </div>
                                            <div class="text-xs bg-orange-100 px-2 py-1 rounded">000011</div>
                                        </div>
                                        <div class="text-sm mb-2">Jump to target and save return address in $ra</div>
                                        <div class="text-xs text-gray-500">$ra = PC + 4, then PC = target</div>
                                        <div class="text-xs mt-2"><strong>Use case:</strong> Function calls, procedure invocation</div>
                                    </div>
                                </div>
                            </div>

                            <!-- R-Type Jumps -->
                            <div>
                                <h4 class="font-semibold mb-4 text-red-600">üìç R-Type Jumps (Indirect)</h4>
                                <div class="space-y-4">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">jr rs</div>
                                                <div class="text-sm text-gray-600">Jump Register</div>
                                            </div>
                                                                                        <div class="text-xs bg-red-100 px-2 py-1 rounded">001000</div>
                                        </div>
                                        <div class="text-sm mb-2">Jump to address stored in register rs</div>
                                        <div class="text-xs text-gray-500">PC = rs (commonly used for function returns)</div>
                                        <div class="text-xs mt-2"><strong>Use case:</strong> Function returns, computed jumps</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">jalr rs, rd</div>
                                                <div class="text-sm text-gray-600">Jump and Link Register</div>
                                            </div>
                                            <div class="text-xs bg-red-100 px-2 py-1 rounded">001001</div>
                                        </div>
                                        <div class="text-sm mb-2">Jump to rs, save return address in rd</div>
                                        <div class="text-xs text-gray-500">rd = PC + 4, then PC = rs</div>
                                        <div class="text-xs mt-2"><strong>Use case:</strong> Dynamic function calls, jump tables</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Jump vs Branch Comparison -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">‚ö° Jump vs Branch Comparison</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="p-3 text-left">Aspect</th>
                                        <th class="p-3 text-left">Branch Instructions</th>
                                        <th class="p-3 text-left">Jump Instructions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="p-3 font-medium">Execution</td>
                                        <td class="p-3">Conditional (based on comparison)</td>
                                        <td class="p-3">Unconditional (always taken)</td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 font-medium">Range</td>
                                        <td class="p-3">¬±32KB (16-bit offset)</td>
                                        <td class="p-3">256MB region (26-bit address) or unlimited (register)</td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 font-medium">Address Type</td>
                                        <td class="p-3">PC-relative</td>
                                        <td class="p-3">Absolute (J-type) or Register-based (R-type)</td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 font-medium">Primary Use</td>
                                        <td class="p-3">Loops, conditionals, if-statements</td>
                                        <td class="p-3">Function calls, returns, long jumps</td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 font-medium">Format</td>
                                        <td class="p-3">I-type</td>
                                        <td class="p-3">J-type (j, jal) or R-type (jr, jalr)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Jump Address Calculator -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üßÆ Jump Address Calculator</h3>
                        <p class="mb-4">Calculate jump target addresses for J-type instructions:</p>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium mb-3">J-Type Address Calculation</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium">Current PC (hex):</label>
                                        <input type="text" id="j-pc" class="w-full p-2 border rounded code-font" 
                                               value="0x00400000" oninput="calculateJump()">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">26-bit Address Field (hex):</label>
                                        <input type="text" id="j-address" class="w-full p-2 border rounded code-font" 
                                               value="0x100010" oninput="calculateJump()">
                                    </div>
                                    <div class="bg-green-50 p-3 rounded">
                                        <div class="text-sm font-medium">Target Address:</div>
                                        <div id="j-result" class="code-font text-lg text-green-700">0x00400040</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-3">Calculation Steps</h4>
                                <div id="j-steps" class="bg-gray-50 p-3 rounded text-sm">
                                    <div>Loading...</div>
                                </div>
                                <div class="mt-4 bg-blue-50 p-3 rounded">
                                    <h5 class="font-medium text-sm mb-2">üí° How J-Type Addressing Works</h5>
                                    <div class="text-xs space-y-1">
                                        <div>‚Ä¢ Take upper 4 bits of (PC+4)</div>
                                        <div>‚Ä¢ Concatenate with 26-bit address field</div>
                                        <div>‚Ä¢ Shift left 2 bits (word alignment)</div>
                                        <div>‚Ä¢ Result is the jump target address</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Binary Encoder Panel -->
            <div id="encoder-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üîß Interactive Binary Encoder</h2>
                    
                    <!-- Instruction Builder -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üèóÔ∏è Build Your Own Instruction</h3>
                        <p class="mb-6">Select an instruction type and configure its fields to generate the complete 32-bit binary encoding:</p>
                        
                        <div class="grid lg:grid-cols-2 gap-8">
                            <div>
                                <div class="mb-6">
                                    <label class="block font-medium mb-2">Instruction Type:</label>
                                    <select id="instruction-type" class="w-full p-3 border rounded" onchange="updateInstructionBuilder()">
                                        <option value="">Select instruction type...</option>
                                        <option value="beq">beq - Branch if Equal</option>
                                        <option value="bne">bne - Branch if Not Equal</option>
                                        <option value="j">j - Jump</option>
                                        <option value="jal">jal - Jump and Link</option>
                                        <option value="jr">jr - Jump Register</option>
                                    </select>
                                </div>

                                <div id="instruction-fields" class="space-y-4">
                                    <div class="text-center text-gray-500 py-8">
                                        Select an instruction type to configure fields
                                    </div>
                                </div>

                                <button class="w-full bg-blue-600 text-white p-3 rounded font-semibold hover:bg-blue-700 mt-4"
                                        onclick="encodeInstruction()" id="encode-btn" disabled>
                                    üîÑ Generate Binary Encoding
                                </button>
                            </div>
                            
                            <div>
                                <div class="mb-6">
                                    <h4 class="font-medium mb-2">32-bit Binary Encoding:</h4>
                                    <div id="binary-output" class="bg-gray-100 p-4 rounded code-font text-lg text-center min-h-16">
                                        <div class="text-gray-500 mt-2">Select and configure instruction</div>
                                    </div>
                                </div>

                                <div class="mb-6">
                                    <h4 class="font-medium mb-2">Field Breakdown:</h4>
                                    <div id="field-breakdown" class="bg-gray-50 p-4 rounded min-h-32">
                                        <div class="text-center text-gray-500 mt-4">
                                            Binary breakdown will appear here
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="font-medium mb-2">Hexadecimal:</h4>
                                    <div id="hex-output" class="bg-green-50 p-3 rounded code-font text-center text-lg">
                                        0x00000000
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Binary Editor - FIXED -->
<!-- Replace the Binary Editor section with this corrected version: -->
<div class="interactive-box p-6">
    <h3 class="text-xl font-semibold mb-4">‚úèÔ∏è Interactive Binary Instruction Editor</h3>
    
    <div class="bg-blue-50 p-4 rounded-lg mb-6">
        <h4 class="font-semibold mb-2">üéØ How to Use This Tool:</h4>
        <div class="text-sm space-y-2">
            <p><strong>Purpose:</strong> Manually create and decode 32-bit MIPS instructions by toggling individual bits.</p>
            <p><strong>Instructions:</strong></p>
            <ul class="list-disc list-inside ml-4 space-y-1">
                <li>Click any bit to toggle it between 0 (gray) and 1 (blue)</li>
                <li>Watch the instruction decode in real-time as you modify bits</li>
                <li>Use this to understand how different bit patterns create different instructions</li>
                <li>Try setting the first 6 bits to known opcodes (e.g., 000100 for beq)</li>
            </ul>
            <p><strong>Learning Goals:</strong> Understand the relationship between binary patterns and MIPS instructions</p>
        </div>
    </div>
    
    <div class="mb-6">
        <h4 class="font-medium mb-3">32-Bit Instruction Editor:</h4>
        
        <!-- Container with fixed width to match bit editor -->
        <div class="overflow-x-auto">
            <div class="inline-block">
                <!-- Bit position labels with exact positioning -->
                <div class="relative mb-2" style="width: 892px; height: 20px;">
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 12px; top: 0;">31</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 96px; top: 0;">28</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 196px; top: 0;">24</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 296px; top: 0;">20</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 396px; top: 0;">16</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 496px; top: 0;">12</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 596px; top: 0;">8</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 696px; top: 0;">4</div>
                    <div class="absolute text-xs text-gray-500 font-mono" style="left: 868px; top: 0;">0</div>
                </div>
                
                <!-- Binary editor with exact fixed width -->
                <div class="flex gap-1 p-3 bg-gray-100 rounded border" 
                     style="width: 892px;" id="binary-editor">
                    <!-- 32 binary digits will be generated here -->
                </div>
                
                <!-- Field grouping indicators -->
                <div class="mt-3" style="width: 892px;">
                    <div class="text-xs text-gray-600 mb-2">Instruction Fields:</div>
                    <div class="relative" style="height: 24px;">
                        <!-- Opcode field (bits 31-26) -->
                        <div class="absolute bg-red-100 border border-red-300 rounded px-1 text-xs flex items-center"
                             style="left: 3px; width: 146px; height: 20px;">
                            <span class="text-red-700 font-semibold">Opcode (31-26)</span>
                        </div>
                        
                        <!-- Register fields (bits 25-16) -->
                        <div class="absolute bg-blue-100 border border-blue-300 rounded px-1 text-xs flex items-center"
                             style="left: 153px; width: 246px; height: 20px;">
                            <span class="text-blue-700 font-semibold">rs (25-21) | rt (20-16)</span>
                        </div>
                        
                        <!-- Immediate/Address field (bits 15-0) -->
                        <div class="absolute bg-green-100 border border-green-300 rounded px-1 text-xs flex items-center"
                             style="left: 403px; width: 486px; height: 20px;">
                            <span class="text-green-700 font-semibold">Immediate/Address (15-0)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div>
            <h4 class="font-medium mb-3">Control Buttons:</h4>
            <div class="space-y-2">
                <button class="w-full bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
                        onclick="clearBinary()">
                    üóëÔ∏è Clear All Bits
                </button>
                <button class="w-full bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700"
                        onclick="randomBinary()">
                    üé≤ Random Pattern
                </button>
                <button class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
                        onclick="loadExamplePattern()">
                    üìù Load beq Example
                </button>
            </div>
        </div>
        <div>
            <h4 class="font-medium mb-3">Current Values:</h4>
            <div class="space-y-2">
                <div class="bg-gray-50 p-2 rounded">
                    <div class="text-sm font-medium">Binary String:</div>
                    <div class="code-font text-sm break-all" id="binary-string">00000000000000000000000000000000</div>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <div class="text-sm font-medium">Hexadecimal:</div>
                    <div class="code-font text-lg" id="manual-hex">0x00000000</div>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <div class="text-sm font-medium">Decimal:</div>
                    <div class="code-font text-lg" id="manual-decimal">0</div>
                </div>
            </div>
        </div>
    </div>
    
    <div>
        <h4 class="font-medium mb-2">üîç Decoded Instruction:</h4>
        <div id="decoded-instruction" class="bg-blue-50 p-4 rounded min-h-24">
            <div class="text-center text-gray-500">
                Click bits above to create an instruction pattern
            </div>
        </div>
    </div>
    
    <!-- Quick Examples -->
    <div class="mt-6 bg-gray-50 p-4 rounded">
        <h5 class="font-medium mb-3">üöÄ Try These Examples:</h5>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
            <button class="bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 flex flex-col items-center"
                    onclick="setBinaryPattern('00010001000010010000000000001000')">
                <span class="font-semibold">beq $t0, $t1, 8</span>
                <span class="text-xs opacity-80">Branch if Equal</span>
            </button>
            <button class="bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 flex flex-col items-center"
                    onclick="setBinaryPattern('00001000000100000000000000100000')">
                <span class="font-semibold">j 0x100020</span>
                <span class="text-xs opacity-80">Jump</span>
            </button>
            <button class="bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600 flex flex-col items-center"
                    onclick="setBinaryPattern('00000011111000000000000000001000')">
                <span class="font-semibold">jr $ra</span>
                <span class="text-xs opacity-80">Jump Register</span>
            </button>
            <button class="bg-orange-500 text-white px-3 py-2 rounded text-sm hover:bg-orange-600 flex flex-col items-center"
                    onclick="setBinaryPattern('00010101001010010000000000001100')">
                <span class="font-semibold">bne $t1, $t1, 12</span>
                <span class="text-xs opacity-80">Branch Not Equal</span>
            </button>
            <button class="bg-teal-500 text-white px-3 py-2 rounded text-sm hover:bg-teal-600 flex flex-col items-center"
                    onclick="setBinaryPattern('00001100000100000000000001000000')">
                <span class="font-semibold">jal 0x100040</span>
                <span class="text-xs opacity-80">Jump and Link</span>
            </button>
            <button class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600 flex flex-col items-center"
                    onclick="setBinaryPattern('00000101000000000000000000001000')">
                <span class="font-semibold">bltz $t0, 8</span>
                <span class="text-xs opacity-80">Branch Less Zero</span>
            </button>
        </div>
    </div>
</div>

                    <!-- Opcode Reference -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìã Quick Reference Tables</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <h4 class="font-semibold mb-3 text-blue-600">Branch Opcodes</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="flex justify-between code-font bg-blue-50 p-1 rounded">
                                        <span>beq</span><span>000100</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-blue-50 p-1 rounded">
                                        <span>bne</span><span>000101</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-blue-50 p-1 rounded">
                                        <span>bltz</span><span>000001</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-blue-50 p-1 rounded">
                                        <span>bgez</span><span>000001</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-3 text-orange-600">Jump Opcodes</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="flex justify-between code-font bg-orange-50 p-1 rounded">
                                        <span>j</span><span>000010</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-orange-50 p-1 rounded">
                                        <span>jal</span><span>000011</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-orange-50 p-1 rounded">
                                        <span>jr</span><span>000000</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-orange-50 p-1 rounded">
                                        <span>jalr</span><span>000000</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-3 text-gray-600">Common Registers</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="flex justify-between code-font bg-gray-50 p-1 rounded">
                                        <span>$zero</span><span>00000</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-gray-50 p-1 rounded">
                                        <span>$t0</span><span>01000</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-gray-50 p-1 rounded">
                                        <span>$t1</span><span>01001</span>
                                    </div>
                                    <div class="flex justify-between code-font bg-gray-50 p-1 rounded">
                                        <span>$ra</span><span>11111</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Practice Quiz Panel -->
            <div id="practice-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üéØ Practice Quiz & Challenges</h2>
                    
                    <!-- Quiz Section -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìù Knowledge Check Quiz</h3>
                        <p class="mb-6">Test your understanding of MIPS control flow instructions:</p>
                        
                        <div class="space-y-6" id="quiz-questions">
                            <!-- Question 1 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 1: Which instruction format is used for beq?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q1" value="R" class="quiz-radio">
                                        <span>R-type (Register format)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q1" value="I" class="quiz-radio">
                                        <span>I-type (Immediate format)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q1" value="J" class="quiz-radio">
                                        <span>J-type (Jump format)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 2 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 2: What is the opcode for jump (j) instruction?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q2" value="000010" class="quiz-radio">
                                        <span class="code-font">000010</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q2" value="000011" class="quiz-radio">
                                        <span class="code-font">000011</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q2" value="000100" class="quiz-radio">
                                        <span class="code-font">000100</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 3 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 3: Which instruction saves the return address?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q3" value="j" class="quiz-radio">
                                        <span class="code-font">j (jump)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q3" value="jal" class="quiz-radio">
                                        <span class="code-font">jal (jump and link)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q3" value="jr" class="quiz-radio">
                                        <span class="code-font">jr (jump register)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 4 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 4: What is the function code for jr instruction?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q4" value="001000" class="quiz-radio">
                                        <span class="code-font">001000</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q4" value="001001" class="quiz-radio">
                                        <span class="code-font">001001</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q4" value="100000" class="quiz-radio">
                                        <span class="code-font">100000</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 5 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 5: The main difference between branch and jump instructions is:</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q5" value="conditional" class="quiz-radio">
                                        <span>Branches are conditional, jumps are unconditional</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q5" value="format" class="quiz-radio">
                                        <span>They use different instruction formats</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q5" value="both" class="quiz-radio">
                                        <span>Both A and B are correct</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 text-center">
                            <button class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700"
                                    onclick="checkQuiz()">
                                ‚úÖ Check Answers
                            </button>
                            <div id="quiz-results" class="mt-4"></div>
                        </div>
                    </div>

                    <!-- Binary Challenges -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üß© Binary Decoding Challenge</h3>
                        <p class="mb-4">Decode these binary instructions and identify what they do:</p>
                        
                        <div class="space-y-4">
                            <!-- Challenge 1 -->
                            <div class="challenge-card p-4 bg-gray-50 rounded">
                                <h4 class="font-medium mb-2">Challenge 1: Decode this 32-bit instruction</h4>
                                <div class="code-font text-lg mb-3 bg-white p-2 rounded border">
                                    00010001000010010000000000001000
                                </div>
                                <div class="text-xs text-gray-600 mb-2">
                                    Hint: Look at the first 6 bits (opcode) and identify the instruction type
                                </div>
                                <input type="text" class="w-full p-2 border rounded" 
                                       placeholder="Enter your answer (e.g., beq $t0, $t1, 8)"
                                       id="challenge1-answer">
                                <button class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                        onclick="checkChallenge(1, 'beq $t0, $t1, 8')">
                                    Check Answer
                                </button>
                                <div id="challenge1-feedback" class="mt-2"></div>
                            </div>

                            <!-- Challenge 2 -->
                            <div class="challenge-card p-4 bg-gray-50 rounded">
                                <h4 class="font-medium mb-2">Challenge 2: Decode this jump instruction</h4>
                                <div class="code-font text-lg mb-3 bg-white p-2 rounded border">
                                    00001000000100000000000000100000
                                </div>
                                <div class="text-xs text-gray-600 mb-2">
                                    Hint: This is a J-type instruction with a 26-bit address field
                                </div>
                                <input type="text" class="w-full p-2 border rounded" 
                                       placeholder="Enter your answer"
                                       id="challenge2-answer">
                                <button class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                        onclick="checkChallenge(2, 'j 0x100020')">
                                    Check Answer
                                </button>
                                <div id="challenge2-feedback" class="mt-2"></div>
                            </div>

                            <!-- Challenge 3 -->
                            <div class="challenge-card p-4 bg-gray-50 rounded">
                                <h4 class="font-medium mb-2">Challenge 3: Decode this register jump</h4>
                                <div class="code-font text-lg mb-3 bg-white p-2 rounded border">
                                    00000011111000000000000000001000
                                </div>
                                <div class="text-xs text-gray-600 mb-2">
                                    Hint: R-type instruction - check the function code in the last 6 bits
                                </div>
                                <input type="text" class="w-full p-2 border rounded" 
                                       placeholder="Enter your answer"
                                       id="challenge3-answer">
                                <button class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                        onclick="checkChallenge(3, 'jr $ra')">
                                    Check Answer
                                </button>
                                <div id="challenge3-feedback" class="mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Summary -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìä Your Session Progress</h3>
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600" id="quiz-score">0</div>
                                <div class="text-sm">Quiz Score (%)</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" id="challenges-solved">0</div>
                                <div class="text-sm">Challenges Solved</div>
                            </div>
                                                        <div class="text-center">
                                <div class="text-3xl font-bold text-purple-600" id="total-score">0</div>
                                <div class="text-sm">Total Score</div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 text-sm"
                                    onclick="exportResults()">
                                üìä Export Results
                            </button>
                            <button class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 text-sm ml-2"
                                    onclick="resetProgress()">
                                üîÑ Reset Progress
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Global state
        let currentBits = new Array(32).fill(0);
        let quizState = {
            score: 0,
            challengesSolved: 0,
            totalScore: 0
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeBinaryEditor();
            calculateJump();
            updateScoreboard();
            
            // Set up input event listeners for real-time updates
            const branchInput = document.getElementById('branch-input');
            if (branchInput) {
                branchInput.addEventListener('input', decodeBranch);
            }
        });

        // Tab switching functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('tab-active');
                    b.classList.add('tab-inactive');
                    b.setAttribute('aria-selected', 'false');
                });
                
                // Show selected tab
                document.getElementById(`${tabName}-panel`).classList.remove('hidden');
                btn.classList.add('tab-active');
                btn.classList.remove('tab-inactive');
                btn.setAttribute('aria-selected', 'true');
            });
        });

        // Helper functions
        function getOpcode(instruction) {
            const opcodes = {
                'beq': '000100',
                'bne': '000101',
                'bltz': '000001',
                'bgez': '000001',
                'j': '000010',
                'jal': '000011',
                'jr': '000000'
            };
            return opcodes[instruction] || '??????';
        }

        function getFunctionCode(instruction) {
            const funcCodes = {
                'jr': '001000',
                'jalr': '001001'
            };
            return funcCodes[instruction] || '??????';
        }

        function getRegisterNumber(reg) {
            const registers = {
                '$zero': '00000', '$t0': '01000', '$t1': '01001', '$t2': '01010',
                '$s0': '10000', '$s1': '10001', '$ra': '11111', '$sp': '11101'
            };
            return registers[reg] || '00000';
        }

        // Instruction format display
        function showInstructionFormat(instruction, format) {
            const display = document.getElementById('format-display');
            let formatHtml = '';
            
            if (format === 'I') {
                const opcode = getOpcode(instruction);
                formatHtml = `
                    <div class="mb-3">
                        <h4 class="font-semibold text-blue-600 mb-2">I-Type Format: ${instruction}</h4>
                        <div class="grid grid-cols-4 gap-0 text-xs mb-1">
                            <div class="field-label">opcode (6)</div>
                            <div class="field-label">rs (5)</div>
                            <div class="field-label">rt (5)</div>
                            <div class="field-label">immediate (16)</div>
                        </div>
                        <div class="grid grid-cols-4 gap-0">
                            <div class="binary-field p-2">${opcode}</div>
                            <div class="binary-field p-2">rs</div>
                            <div class="binary-field p-2">rt</div>
                            <div class="binary-field p-2">offset</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        Branch target = PC + 4 + (offset √ó 4)
                    </div>
                `;
            } else if (format === 'J') {
                const opcode = getOpcode(instruction);
                formatHtml = `
                    <div class="mb-3">
                        <h4 class="font-semibold text-orange-600 mb-2">J-Type Format: ${instruction}</h4>
                        <div class="grid grid-cols-2 gap-0 text-xs mb-1">
                            <div class="field-label">opcode (6)</div>
                            <div class="field-label">address (26)</div>
                        </div>
                        <div class="grid grid-cols-2 gap-0">
                            <div class="binary-field p-2">${opcode}</div>
                            <div class="binary-field p-2">jump target</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        Jump target = (PC+4)[31:28] | address << 2
                    </div>
                `;
            } else if (format === 'R') {
                const funct = getFunctionCode(instruction);
                formatHtml = `
                    <div class="mb-3">
                        <h4 class="font-semibold text-red-600 mb-2">R-Type Format: ${instruction}</h4>
                        <div class="grid grid-cols-6 gap-0 text-xs mb-1">
                            <div class="field-label">op (6)</div>
                            <div class="field-label">rs (5)</div>
                            <div class="field-label">rt (5)</div>
                            <div class="field-label">rd (5)</div>
                            <div class="field-label">shamt (5)</div>
                            <div class="field-label">funct (6)</div>
                        </div>
                        <div class="grid grid-cols-6 gap-0">
                            <div class="binary-field p-2">000000</div>
                            <div class="binary-field p-2">rs</div>
                            <div class="binary-field p-2">00000</div>
                            <div class="binary-field p-2">00000</div>
                            <div class="binary-field p-2">00000</div>
                            <div class="binary-field p-2">${funct}</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        Jump to address stored in register rs
                    </div>
                `;
            }
            
            display.innerHTML = formatHtml;
        }

        // Branch decoder
        function decodeBranch() {
            const input = document.getElementById('branch-input').value.trim();
            const result = document.getElementById('branch-decode-result');
            
            if (!input) {
                result.innerHTML = '<div class="text-center text-gray-500 mt-4">Enter a branch instruction</div>';
                return;
            }

            try {
                const parts = input.split(/[\s,]+/).filter(p => p);
                const opcode = parts[0];
                
                let binary = '';
                let breakdown = '';
                
                if (opcode === 'beq' || opcode === 'bne') {
                    const opcodeField = getOpcode(opcode);
                    const rs = getRegisterNumber(parts[1]);
                    const rt = getRegisterNumber(parts[2]);
                    
                    // Handle both numeric offsets and labels
                    let offset = 0;
                    if (parts[3] && !isNaN(parseInt(parts[3]))) {
                        offset = parseInt(parts[3]);
                    } else if (parts[3]) {
                        // For labels, use a placeholder offset
                        offset = 8; // Example offset for demonstration
                    }
                    
                    const offsetBinary = (offset & 0xFFFF).toString(2).padStart(16, '0');
                    
                    binary = opcodeField + rs + rt + offsetBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode (${opcode}):</strong> ${opcodeField}</div>
                            <div><strong>rs (${parts[1]}):</strong> ${rs}</div>
                            <div><strong>rt (${parts[2]}):</strong> ${rt}</div>
                            <div><strong>Offset:</strong> ${offsetBinary} (${offset})</div>
                        </div>
                    `;
                } else if (opcode === 'bltz' || opcode === 'bgez') {
                    const opcodeField = getOpcode(opcode);
                    const rs = getRegisterNumber(parts[1]);
                    const rt = opcode === 'bgez' ? '00001' : '00000';
                    
                    let offset = 0;
                    if (parts[2] && !isNaN(parseInt(parts[2]))) {
                        offset = parseInt(parts[2]);
                    } else if (parts[2]) {
                        offset = 8; // Example offset for labels
                    }
                    
                    const offsetBinary = (offset & 0xFFFF).toString(2).padStart(16, '0');
                    
                    binary = opcodeField + rs + rt + offsetBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode (${opcode}):</strong> ${opcodeField}</div>
                            <div><strong>rs (${parts[1]}):</strong> ${rs}</div>
                            <div><strong>rt field:</strong> ${rt}</div>
                            <div><strong>Offset:</strong> ${offsetBinary} (${offset})</div>
                        </div>
                    `;
                } else {
                    throw new Error('Unsupported instruction');
                }

                const hex = parseInt(binary, 2).toString(16).toUpperCase().padStart(8, '0');
                
                result.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold mb-2">Binary Encoding:</h4>
                            <div class="code-font text-lg bg-blue-50 p-2 rounded break-all">${binary}</div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Field Breakdown:</h4>
                            ${breakdown}
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Hexadecimal:</h4>
                            <div class="code-font text-lg bg-green-50 p-2 rounded">0x${hex}</div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `<div class="text-red-600 p-3 bg-red-50 rounded">Error: ${error.message}</div>`;
            }
        }

        function loadBranchExample(example) {
            document.getElementById('branch-input').value = example;
            decodeBranch();
        }

        // Jump address calculator
        function calculateJump() {
            try {
                const pcStr = document.getElementById('j-pc').value;
                const addressStr = document.getElementById('j-address').value;
                
                const pc = parseInt(pcStr, 16) || 0;
                const address = parseInt(addressStr, 16) || 0;
                
                const pcPlus4 = pc + 4;
                const upperBits = pcPlus4 & 0xF0000000;
                const shiftedAddress = (address & 0x3FFFFFF) << 2;
                const target = upperBits | shiftedAddress;
                
                document.getElementById('j-result').textContent = `0x${target.toString(16).toUpperCase().padStart(8, '0')}`;
                
                document.getElementById('j-steps').innerHTML = `
                    <div class="space-y-1">
                        <div>1. PC + 4 = 0x${pcPlus4.toString(16).toUpperCase().padStart(8, '0')}</div>
                        <div>2. Upper 4 bits = 0x${(upperBits >>> 28).toString(16).toUpperCase()}</div>
                        <div>3. Address field = 0x${address.toString(16).toUpperCase()}</div>
                        <div>4. Shifted address = 0x${shiftedAddress.toString(16).toUpperCase().padStart(8, '0')}</div>
                        <div>5. Final target = 0x${target.toString(16).toUpperCase().padStart(8, '0')}</div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('j-result').textContent = 'Invalid input';
            }
        }

        // Instruction builder
        function updateInstructionBuilder() {
            const type = document.getElementById('instruction-type').value;
            const fieldsDiv = document.getElementById('instruction-fields');
            const encodeBtn = document.getElementById('encode-btn');
            
            if (!type) {
                fieldsDiv.innerHTML = '<div class="text-center text-gray-500 py-8">Select instruction type</div>';
                encodeBtn.disabled = true;
                return;
            }

            let fieldsHtml = '';
            
            if (type === 'beq' || type === 'bne') {
                fieldsHtml = `
                    <div>
                        <label class="block font-medium mb-1">Source Register (rs):</label>
                        <select id="field-rs" class="w-full p-2 border rounded">
                            <option value="01000">$t0 (8)</option>
                            <option value="01001">$t1 (9)</option>
                            <option value="10000">$s0 (16)</option>
                            <option value="00000">$zero (0)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-1">Target Register (rt):</label>
                        <select id="field-rt" class="w-full p-2 border rounded">
                            <option value="01000">$t0 (8)</option>
                            <option value="01001">$t1 (9)</option>
                            <option value="10000">$s0 (16)</option>
                            <option value="00000">$zero (0)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-1">Branch Offset:</label>
                        <input type="number" id="field-offset" class="w-full p-2 border rounded" value="4" min="-32768" max="32767">
                        <div class="text-xs text-gray-500 mt-1">Word offset (-32768 to 32767)</div>
                    </div>
                `;
            } else if (type === 'j' || type === 'jal') {
                fieldsHtml = `
                    <div>
                        <label class="block font-medium mb-1">Jump Address (26-bit):</label>
                        <input type="text" id="field-address" class="w-full p-2 border rounded code-font" 
                               value="0x100000" placeholder="0x100000">
                        <div class="text-xs text-gray-500 mt-1">26-bit address field (hex)</div>
                    </div>
                `;
            } else if (type === 'jr') {
                fieldsHtml = `
                    <div>
                        <label class="block font-medium mb-1">Jump Register (rs):</label>
                        <select id="field-rs" class="w-full p-2 border rounded">
                            <option value="11111">$ra (31)</option>
                            <option value="01000">$t0 (8)</option>
                            <option value="01001">$t1 (9)</option>
                            <option value="10000">$s0 (16)</option>
                        </select>
                    </div>
                `;
            }
            
            fieldsDiv.innerHTML = fieldsHtml;
            encodeBtn.disabled = false;
        }

        function encodeInstruction() {
            const type = document.getElementById('instruction-type').value;
            
            try {
                let binary = '';
                let breakdown = '';
                let opcode = getOpcode(type);
                
                if (type === 'beq' || type === 'bne') {
                    const rs = document.getElementById('field-rs').value;
                    const rt = document.getElementById('field-rt').value;
                    const offset = parseInt(document.getElementById('field-offset').value) || 0;
                    const offsetBinary = (offset & 0xFFFF).toString(2).padStart(16, '0');
                    
                    binary = opcode + rs + rt + offsetBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode:</strong> ${opcode}</div>
                            <div><strong>rs:</strong> ${rs}</div>
                            <div><strong>rt:</strong> ${rt}</div>
                            <div><strong>Offset:</strong> ${offsetBinary}</div>
                        </div>
                    `;
                } else if (type === 'j' || type === 'jal') {
                    const addressStr = document.getElementById('field-address').value;
                    const address = parseInt(addressStr, 16) & 0x3FFFFFF;
                    const addressBinary = address.toString(2).padStart(26, '0');
                    
                    binary = opcode + addressBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode:</strong> ${opcode}</div>
                            <div><strong>Address:</strong> ${addressBinary}</div>
                        </div>
                    `;
                } else if (type === 'jr') {
                    const rs = document.getElementById('field-rs').value;
                    const funct = '001000';
                    
                    binary = '000000' + rs + '00000' + '00000' + '00000' + funct;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode:</strong> 000000</div>
                            <div><strong>rs:</strong> ${rs}</div>
                            <div><strong>Unused fields:</strong> 00000</div>
                            <div><strong>Function:</strong> ${funct}</div>
                        </div>
                    `;
                }
                
                const hex = parseInt(binary, 2).toString(16).toUpperCase().padStart(8, '0');
                
                document.getElementById('binary-output').innerHTML = `<div class="text-blue-700 break-all">${binary}</div>`;
                document.getElementById('field-breakdown').innerHTML = breakdown;
                document.getElementById('hex-output').textContent = '0x' + hex;
                
            } catch (error) {
                document.getElementById('binary-output').innerHTML = `<div class="text-red-600">Error: ${error.message}</div>`;
            }
        }

        // Binary editor - FIXED to be horizontal
        // Replace the initializeBinaryEditor function and related functions with these:

// Updated binary editor functions with fixed positioning

function initializeBinaryEditor() {
    const editor = document.getElementById('binary-editor');
    editor.innerHTML = '';
    
    // Create 32 bits in horizontal layout with exact positioning
    for (let i = 0; i < 32; i++) {
        const bit = document.createElement('div');
        
        // Add field-specific classes for visual grouping
        let fieldClass = '';
        if (i < 6) fieldClass = 'opcode-field';
        else if (i < 16) fieldClass = 'register-field';
        else fieldClass = 'immediate-field';
        
        bit.className = `binary-bit ${fieldClass}`;
        bit.textContent = '0';
        bit.title = `Bit ${31-i} (position ${31-i})`; // Add tooltip
        bit.onclick = () => toggleBit(i);
        bit.style.width = '24px';  // Ensure consistent width
        bit.style.height = '32px'; // Ensure consistent height
        editor.appendChild(bit);
    }
    
    updateBinaryDisplay();
}

function updateBinaryDisplay() {
    const editor = document.getElementById('binary-editor');
    const children = editor.children;
    
    for (let i = 0; i < 32; i++) {
        const bit = children[i];
        bit.textContent = currentBits[i];
        
        // Update classes based on bit value
        if (currentBits[i] === 1) {
            bit.classList.add('active');
        } else {
            bit.classList.remove('active');
        }
    }
    
    // Update all displays
    const binaryString = currentBits.join('');
    const value = parseInt(binaryString, 2);
    const hex = value.toString(16).toUpperCase().padStart(8, '0');
    
    // Update binary string display with grouping
    const groupedBinary = binaryString.match(/.{1,4}/g).join(' ');
    document.getElementById('binary-string').textContent = groupedBinary;
    
    document.getElementById('manual-hex').textContent = '0x' + hex;
    if (document.getElementById('manual-decimal')) {
        document.getElementById('manual-decimal').textContent = value.toLocaleString();
    }
    
    // Decode the instruction
    decodeBinaryInstruction(binaryString);
}

// Add this function to show bit boundaries clearly
function highlightField(fieldType) {
    const editor = document.getElementById('binary-editor');
    const children = editor.children;
    
    // Remove previous highlights
    for (let i = 0; i < 32; i++) {
        children[i].style.boxShadow = '';
    }
    
    // Add highlight based on field type
    let startBit, endBit;
    let color;
    
    switch (fieldType) {
        case 'opcode':
            startBit = 0; endBit = 6;
            color = '0 0 0 3px rgba(239, 68, 68, 0.5)';
            break;
        case 'registers':
            startBit = 6; endBit = 16;
            color = '0 0 0 3px rgba(59, 130, 246, 0.5)';
            break;
        case 'immediate':
            startBit = 16; endBit = 32;
            color = '0 0 0 3px rgba(34, 197, 94, 0.5)';
            break;
        default:
            return;
    }
    
    for (let i = startBit; i < endBit; i++) {
        children[i].style.boxShadow = color;
    }
    
    // Remove highlight after 2 seconds
    setTimeout(() => {
        for (let i = 0; i < 32; i++) {
            children[i].style.boxShadow = '';
        }
    }, 2000);
}

// Add click handlers to field labels for highlighting
document.addEventListener('DOMContentLoaded', () => {
    // Add click events to field indicators (if they exist)
    setTimeout(() => {
        const fieldIndicators = document.querySelectorAll('[style*="bg-red-100"], [style*="bg-blue-100"], [style*="bg-green-100"]');
        fieldIndicators.forEach((indicator, index) => {
            const fieldTypes = ['opcode', 'registers', 'immediate'];
            indicator.style.cursor = 'pointer';
            indicator.onclick = () => highlightField(fieldTypes[index]);
        });
    }, 100);
});
function toggleBit(index) {
    currentBits[index] = 1 - currentBits[index];
    updateBinaryDisplay();
}

function clearBinary() {
    currentBits = new Array(32).fill(0);
    updateBinaryDisplay();
}

function randomBinary() {
    // Generate a more realistic random instruction
    const opcodes = ['000100', '000101', '000010', '000011', '000000'];
    const randomOpcode = opcodes[Math.floor(Math.random() * opcodes.length)];
    
    let binaryString = randomOpcode;
    for (let i = 6; i < 32; i++) {
        binaryString += Math.random() > 0.5 ? '1' : '0';
    }
    
    setBinaryPattern(binaryString);
}

function loadExamplePattern() {
    // Load beq $t0, $t1, 8 as example
    setBinaryPattern('00010001000010010000000000001000');
}

function setBinaryPattern(binaryString) {
    for (let i = 0; i < 32 && i < binaryString.length; i++) {
        currentBits[i] = parseInt(binaryString[i]) || 0;
    }
    updateBinaryDisplay();
}



function decodeBinaryInstruction(binary) {
    const decoded = document.getElementById('decoded-instruction');
    const opcode = binary.substring(0, 6);
    
    let instruction = 'Unknown instruction';
    let details = '';
    let breakdown = '';
    
    switch (opcode) {
        case '000100': 
            const rs_beq = parseInt(binary.substring(6, 11), 2);
            const rt_beq = parseInt(binary.substring(11, 16), 2);
            const offset_beq = parseInt(binary.substring(16, 32), 2);
            // Handle signed offset
            const signed_offset = offset_beq > 32767 ? offset_beq - 65536 : offset_beq;
            instruction = 'beq (Branch if Equal)';
            details = `Compare registers $${rs_beq} and $${rt_beq}, branch if equal`;
            breakdown = `Offset: ${signed_offset} words (${signed_offset * 4} bytes)`;
            break;
            
        case '000101': 
            const rs_bne = parseInt(binary.substring(6, 11), 2);
            const rt_bne = parseInt(binary.substring(11, 16), 2);
            const offset_bne = parseInt(binary.substring(16, 32), 2);
            const signed_offset_bne = offset_bne > 32767 ? offset_bne - 65536 : offset_bne;
            instruction = 'bne (Branch if Not Equal)';
            details = `Compare registers $${rs_bne} and $${rt_bne}, branch if not equal`;
            breakdown = `Offset: ${signed_offset_bne} words`;
            break;
            
        case '000010': 
            const addr_j = parseInt(binary.substring(6, 32), 2);
            instruction = 'j (Jump)';
            details = `Unconditional jump to address`;
            breakdown = `Target address field: 0x${addr_j.toString(16).toUpperCase()}`;
            break;
            
        case '000011': 
            const addr_jal = parseInt(binary.substring(6, 32), 2);
            instruction = 'jal (Jump and Link)';
            details = `Jump to address and save return address in $ra`;
            breakdown = `Target address field: 0x${addr_jal.toString(16).toUpperCase()}`;
            break;
            
        case '000000':
            const funct = binary.substring(26, 32);
            const rs_r = parseInt(binary.substring(6, 11), 2);
            if (funct === '001000') {
                instruction = 'jr (Jump Register)';
                details = `Jump to address stored in register $${rs_r}`;
                breakdown = `Source register: $${rs_r}`;
            } else if (funct === '001001') {
                const rd_jalr = parseInt(binary.substring(16, 21), 2);
                instruction = 'jalr (Jump and Link Register)';
                details = `Jump to address in $${rs_r}, save return in $${rd_jalr}`;
                breakdown = `rs: $${rs_r}, rd: $${rd_jalr}`;
            } else {
                instruction = 'Unknown R-type instruction';
                details = `Function code: ${funct}`;
            }
            break;
            
        case '000001':
            const rs_branch = parseInt(binary.substring(6, 11), 2);
            const rt_field = parseInt(binary.substring(11, 16), 2);
            const offset_branch = parseInt(binary.substring(16, 32), 2);
            const signed_offset_branch = offset_branch > 32767 ? offset_branch - 65536 : offset_branch;
            
            if (rt_field === 0) {
                instruction = 'bltz (Branch if Less Than Zero)';
                details = `Branch if register $${rs_branch} < 0`;
            } else if (rt_field === 1) {
                instruction = 'bgez (Branch if Greater or Equal Zero)';
                details = `Branch if register $${rs_branch} >= 0`;
            }
            breakdown = `Offset: ${signed_offset_branch} words`;
            break;
    }
    
    decoded.innerHTML = `
        <div class="space-y-3">
            <div>
                <div class="font-semibold text-lg text-blue-800">${instruction}</div>
                <div class="text-sm text-gray-600 mt-1">${details}</div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4 text-sm">
                <div>
                    <strong>Opcode:</strong> ${opcode} (${parseInt(opcode, 2)})
                </div>
                <div>
                    <strong>Format:</strong> ${opcode === '000000' ? 'R-type' : (opcode === '000010' || opcode === '000011' ? 'J-type' : 'I-type')}
                </div>
            </div>
            
            ${breakdown ? `<div class="text-sm text-gray-700 bg-gray-100 p-2 rounded">${breakdown}</div>` : ''}
        </div>
    `;
}

        // Quiz functionality
        function checkQuiz() {
            const answers = { 
                q1: 'I', 
                q2: '000010', 
                q3: 'jal', 
                q4: '001000', 
                q5: 'both' 
            };
            
            let correct = 0;
            let total = Object.keys(answers).length;
            
            Object.keys(answers).forEach(question => {
                const selected = document.querySelector(`input[name="${question}"]:checked`);
                if (selected && selected.value === answers[question]) {
                    correct++;
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            quizState.score = percentage;
            
            const resultsDiv = document.getElementById('quiz-results');
            resultsDiv.innerHTML = `
                <div class="p-4 rounded ${correct === total ? 'success-highlight' : 'bg-yellow-100 text-yellow-800'}">
                    <div class="font-semibold">Quiz Results: ${correct}/${total} correct (${percentage}%)</div>
                    ${correct === total ? 
                        '<div class="mt-2">üéâ Perfect score! You have mastered the concepts!</div>' :
                        '<div class="mt-2">Review the concepts and try again to improve your score.</div>'
                    }
                </div>
            `;
            
            updateScoreboard();
        }

        // Challenge checking
        function checkChallenge(challengeNum, correctAnswer) {
            const userAnswer = document.getElementById(`challenge${challengeNum}-answer`).value.trim();
            const feedback = document.getElementById(`challenge${challengeNum}-feedback`);
            
            // Normalize answers for comparison
            const normalizedUser = userAnswer.toLowerCase().replace(/\s+/g, ' ');
            const normalizedCorrect = correctAnswer.toLowerCase().replace(/\s+/g, ' ');
            
            if (normalizedUser === normalizedCorrect) {
                feedback.innerHTML = '<div class="text-green-600 font-semibold">‚úÖ Correct!</div>';
                if (!feedback.dataset.solved) {
                    quizState.challengesSolved++;
                    feedback.dataset.solved = 'true';
                }
            } else {
                feedback.innerHTML = `<div class="text-red-600">‚ùå Incorrect. Expected: <code class="bg-gray-100 px-1 rounded">${correctAnswer}</code></div>`;
                feedback.dataset.solved = 'false';
            }
            
            updateScoreboard();
        }

        // Scoreboard update
        function updateScoreboard() {
            document.getElementById('quiz-score').textContent = quizState.score;
            document.getElementById('challenges-solved').textContent = quizState.challengesSolved;
            document.getElementById('total-score').textContent = quizState.score + (quizState.challengesSolved * 20);
        }

        // Export and reset functionality
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                quizScore: quizState.score,
                challengesSolved: quizState.challengesSolved,
                totalScore: quizState.totalScore
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `mips-control-flow-results-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress?')) {
                quizState = { score: 0, challengesSolved: 0, totalScore: 0 };
                updateScoreboard();
                
                // Reset quiz selections
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // Clear challenge answers and feedback
                document.querySelectorAll('[id$="-answer"]').forEach(input => {
                    input.value = '';
                });
                
                document.querySelectorAll('[id$="-feedback"]').forEach(feedback => {
                    feedback.innerHTML = '';
                    feedback.dataset.solved = 'false';
                });
                
                document.getElementById('quiz-results').innerHTML = '';
                
                // Reset binary editor
                clearBinary();
            }
        }

        // Console log for debugging
        console.log('MIPS Control Flow Instructions Guide loaded successfully!');
    </script>
</body>
</html>
