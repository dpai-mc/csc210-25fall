<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIPS Control Flow Instructions - Interactive Reference Guide</title>
    
    <!-- CDN Links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #FDFBF8;
            color: #383838;
            font-family: 'Inter', sans-serif;
        }
        
        .code-font {
            font-family: 'Fira Code', monospace;
        }
        
        .tab-active {
            background-color: #EADDD7;
            border-bottom: 3px solid #383838;
        }
        
        .tab-inactive {
            background-color: #F0EBE8;
        }
        
        .tab-inactive:hover {
            background-color: #EADDD7;
        }
        
        .interactive-box {
            border: 2px solid #EADDD7;
            border-radius: 8px;
            background-color: #FDFBF8;
        }
        
        .instruction-card {
            border: 1px solid #EADDD7;
            border-radius: 6px;
            background-color: #FDFBF8;
            transition: all 0.3s ease;
        }
        
        .instruction-card:hover {
            background-color: #F0EBE8;
            border-color: #383838;
        }
        
        .binary-field {
            border: 1px solid #383838;
            text-align: center;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            background-color: #F0EBE8;
        }
        
        .field-label {
            font-size: 10px;
            color: #666;
            text-align: center;
        }
        
        .success-highlight {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .binary-bit {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid #ccc;
        }
        
        .binary-bit.active {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">üìò MIPS Control Flow Instructions</h1>
            <h2 class="text-xl md:text-2xl text-gray-600 mb-6">Interactive Reference & Binary Encoding Guide</h2>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-red-600">15+</div>
                    <div class="text-sm">Branch Instructions</div>
                </div>
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-blue-600">4</div>
                    <div class="text-sm">Jump Instructions</div>
                </div>
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-orange-600">3</div>
                    <div class="text-sm">Instruction Formats</div>
                </div>
                <div class="interactive-box p-3">
                    <div class="text-2xl font-bold text-green-600">32</div>
                    <div class="text-sm">Bits per Instruction</div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="mb-8" role="tablist">
            <div class="flex flex-wrap justify-center gap-2">
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-active" 
                        data-tab="formats" role="tab" aria-selected="true">
                    üìã Instruction Formats
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="branches" role="tab" aria-selected="false">
                    üîÄ Branch Instructions
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="jumps" role="tab" aria-selected="false">
                    üöÄ Jump Instructions
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="encoder" role="tab" aria-selected="false">
                    üîß Binary Encoder
                </button>
                <button class="tab-btn px-4 py-2 rounded-t-lg font-medium focus:ring-2 focus:ring-blue-500 tab-inactive" 
                        data-tab="practice" role="tab" aria-selected="false">
                    üéØ Practice Quiz
                </button>
            </div>
        </nav>

        <main id="main-content">
            <!-- Instruction Formats Panel -->
            <div id="formats-panel" class="tab-content">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üìã MIPS Instruction Formats</h2>
                    
                    <!-- Format Overview -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéØ Three Main Instruction Types</h3>
                        <p class="mb-6">All MIPS instructions are exactly 32 bits long and follow one of three formats:</p>
                        
                        <div class="grid lg:grid-cols-3 gap-6">
                            <!-- R-Type -->
                            <div class="bg-white p-4 rounded-lg border-l-4 border-red-500">
                                <h4 class="font-semibold text-red-600 mb-3">R-Type (Register)</h4>
                                <p class="text-sm mb-4">Used for register operations like jr</p>
                                
                                <div class="mb-4">
                                    <div class="grid grid-cols-6 gap-0 text-xs">
                                        <div class="field-label">op (6)</div>
                                        <div class="field-label">rs (5)</div>
                                        <div class="field-label">rt (5)</div>
                                        <div class="field-label">rd (5)</div>
                                        <div class="field-label">shamt (5)</div>
                                        <div class="field-label">funct (6)</div>
                                    </div>
                                    <div class="grid grid-cols-6 gap-0">
                                        <div class="binary-field p-2">000000</div>
                                        <div class="binary-field p-2">rs</div>
                                        <div class="binary-field p-2">00000</div>
                                        <div class="binary-field p-2">00000</div>
                                        <div class="binary-field p-2">00000</div>
                                        <div class="binary-field p-2">funct</div>
                                    </div>
                                </div>
                                
                                <div class="text-xs space-y-1">
                                    <div><strong>op:</strong> Always 000000 for R-type</div>
                                    <div><strong>rs:</strong> Source register</div>
                                    <div><strong>funct:</strong> Function code (jr=001000)</div>
                                </div>
                            </div>

                            <!-- I-Type -->
                            <div class="bg-white p-4 rounded-lg border-l-4 border-blue-500">
                                <h4 class="font-semibold text-blue-600 mb-3">I-Type (Immediate)</h4>
                                <p class="text-sm mb-4">Used for branches with offsets</p>
                                
                                <div class="mb-4">
                                    <div class="grid grid-cols-4 gap-0 text-xs">
                                        <div class="field-label">op (6)</div>
                                        <div class="field-label">rs (5)</div>
                                        <div class="field-label">rt (5)</div>
                                        <div class="field-label">immediate (16)</div>
                                    </div>
                                    <div class="grid grid-cols-4 gap-0">
                                        <div class="binary-field p-2">opcode</div>
                                        <div class="binary-field p-2">rs</div>
                                        <div class="binary-field p-2">rt</div>
                                        <div class="binary-field p-2">offset</div>
                                    </div>
                                </div>
                                
                                <div class="text-xs space-y-1">
                                    <div><strong>op:</strong> Identifies instruction</div>
                                    <div><strong>rs/rt:</strong> Registers to compare</div>
                                    <div><strong>immediate:</strong> Branch offset</div>
                                </div>
                            </div>

                            <!-- J-Type -->
                            <div class="bg-white p-4 rounded-lg border-l-4 border-orange-500">
                                <h4 class="font-semibold text-orange-600 mb-3">J-Type (Jump)</h4>
                                <p class="text-sm mb-4">Used for jumps with large addresses</p>
                                
                                <div class="mb-4">
                                    <div class="grid grid-cols-2 gap-0 text-xs">
                                        <div class="field-label">op (6)</div>
                                        <div class="field-label">address (26)</div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-0">
                                        <div class="binary-field p-2">opcode</div>
                                        <div class="binary-field p-2">jump target</div>
                                    </div>
                                </div>
                                
                                <div class="text-xs space-y-1">
                                    <div><strong>op:</strong> j=000010, jal=000011</div>
                                    <div><strong>address:</strong> 26-bit jump target</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Format Identifier -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéÆ Interactive Format Identifier</h3>
                        <p class="mb-4">Click on an instruction to see its format breakdown:</p>
                        
                        <div class="grid md:grid-cols-3 gap-4 mb-6">
                            <button class="instruction-btn p-4 border rounded-lg hover:bg-gray-50 transition-colors" 
                                    onclick="showInstructionFormat('beq', 'I')">
                                <div class="code-font font-semibold">beq $t0, $t1, label</div>
                                <div class="text-sm text-gray-600">Branch if Equal</div>
                            </button>
                            <button class="instruction-btn p-4 border rounded-lg hover:bg-gray-50 transition-colors" 
                                    onclick="showInstructionFormat('j', 'J')">
                                <div class="code-font font-semibold">j label</div>
                                <div class="text-sm text-gray-600">Jump</div>
                            </button>
                            <button class="instruction-btn p-4 border rounded-lg hover:bg-gray-50 transition-colors" 
                                    onclick="showInstructionFormat('jr', 'R')">
                                <div class="code-font font-semibold">jr $ra</div>
                                <div class="text-sm text-gray-600">Jump Register</div>
                            </button>
                        </div>
                        
                        <div id="format-display" class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-center text-gray-500">
                                Click an instruction above to see its binary format
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Branch Instructions Panel -->
            <div id="branches-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üîÄ Branch Instructions</h2>
                    
                    <!-- Branch Overview -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üéØ Complete Branch Reference</h3>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <!-- Two-Register Branches -->
                            <div>
                                <h4 class="font-semibold mb-4 text-blue-600">üî¢ Two-Register Branches</h4>
                                <div class="space-y-3">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">beq rs, rt, label</div>
                                                <div class="text-sm text-gray-600">Branch if Equal</div>
                                            </div>
                                            <div class="text-xs bg-blue-100 px-2 py-1 rounded">000100</div>
                                        </div>
                                        <div class="text-sm">Branches if rs == rt</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">bne rs, rt, label</div>
                                                <div class="text-sm text-gray-600">Branch if Not Equal</div>
                                            </div>
                                            <div class="text-xs bg-blue-100 px-2 py-1 rounded">000101</div>
                                        </div>
                                        <div class="text-sm">Branches if rs != rt</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Single Register Branches -->
                            <div>
                                <h4 class="font-semibold mb-4 text-green-600">üéØ Single Register Branches</h4>
                                <div class="space-y-3">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">bltz rs, label</div>
                                                <div class="text-sm text-gray-600">Branch if Less Than Zero</div>
                                            </div>
                                            <div class="text-xs bg-green-100 px-2 py-1 rounded">000001</div>
                                        </div>
                                        <div class="text-sm">Branches if rs < 0</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">bgez rs, label</div>
                                                <div class="text-sm text-gray-600">Branch Greater or Equal Zero</div>
                                            </div>
                                            <div class="text-xs bg-green-100 px-2 py-1 rounded">000001</div>
                                        </div>
                                        <div class="text-sm">Branches if rs ‚â• 0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Branch Decoder -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üîç Interactive Branch Decoder</h3>
                        <p class="mb-4">Enter a branch instruction to see its binary encoding:</p>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block font-medium mb-2">Enter Branch Instruction:</label>
                                <input type="text" id="branch-input" 
                                       class="w-full p-3 border rounded code-font" 
                                       placeholder="beq $t0, $t1, 8"
                                       oninput="decodeBranch()">
                                
                                <div class="mt-4 space-y-2">
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm"
                                            onclick="loadBranchExample('beq $t0, $t1, 8')">
                                        Example: beq
                                    </button>
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm ml-2"
                                            onclick="loadBranchExample('bne $s0, $zero, -4')">
                                        Example: bne
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-2">Binary Encoding:</h4>
                                <div id="branch-decode-result" class="bg-gray-50 p-4 rounded min-h-32">
                                    <div class="text-center text-gray-500 mt-4">
                                        Enter a branch instruction to see its encoding
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Jump Instructions Panel -->
            <div id="jumps-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üöÄ Jump Instructions</h2>
                    
                    <!-- Jump Instructions Reference -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìö Complete Jump Reference</h3>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <!-- J-Type Jumps -->
                            <div>
                                <h4 class="font-semibold mb-4 text-orange-600">üåê J-Type Jumps</h4>
                                <div class="space-y-4">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">j target</div>
                                                <div class="text-sm text-gray-600">Jump</div>
                                            </div>
                                            <div class="text-xs bg-orange-100 px-2 py-1 rounded">000010</div>
                                        </div>
                                        <div class="text-sm mb-2">Unconditionally jump to target</div>
                                        <div class="text-xs text-gray-500">PC = (PC+4)[31:28] | address << 2</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">jal target</div>
                                                <div class="text-sm text-gray-600">Jump and Link</div>
                                            </div>
                                            <div class="text-xs bg-orange-100 px-2 py-1 rounded">000011</div>
                                        </div>
                                        <div class="text-sm mb-2">Jump and save return address in $ra</div>
                                        <div class="text-xs text-gray-500">$ra = PC + 4, then jump</div>
                                    </div>
                                </div>
                            </div>

                            <!-- R-Type Jumps -->
                            <div>
                                <h4 class="font-semibold mb-4 text-red-600">üìç R-Type Jumps</h4>
                                <div class="space-y-4">
                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">jr rs</div>
                                                <div class="text-sm text-gray-600">Jump Register</div>
                                            </div>
                                            <div class="text-xs bg-red-100 px-2 py-1 rounded">001000</div>
                                        </div>
                                        <div class="text-sm mb-2">Jump to address in register rs</div>
                                        <div class="text-xs text-gray-500">PC = rs (function return)</div>
                                    </div>

                                    <div class="instruction-card p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="code-font font-semibold">jalr rs, rd</div>
                                                <div class="text-sm text-gray-600">Jump and Link Register</div>
                                            </div>
                                            <div class="text-xs bg-red-100 px-2 py-1 rounded">001001</div>
                                        </div>
                                        <div class="text-sm mb-2">Jump to rs, save address in rd</div>
                                        <div class="text-xs text-gray-500">rd = PC + 4, PC = rs</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Jump Address Calculator -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üßÆ Jump Address Calculator</h3>
                        <p class="mb-4">Calculate jump target addresses:</p>
                        
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium mb-3">J-Type Address Calculation</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium">Current PC (hex):</label>
                                        <input type="text" id="j-pc" class="w-full p-2 border rounded code-font" 
                                               value="0x00400000" oninput="calculateJump()">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">26-bit Address (hex):</label>
                                        <input type="text" id="j-address" class="w-full p-2 border rounded code-font" 
                                               value="0x100010" oninput="calculateJump()">
                                    </div>
                                    <div class="bg-green-50 p-3 rounded">
                                        <div class="text-sm font-medium">Target Address:</div>
                                        <div id="j-result" class="code-font text-lg text-green-700">0x00400040</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-3">Calculation Steps</h4>
                                <div id="j-steps" class="bg-gray-50 p-3 rounded text-sm">
                                    <div>Loading...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Binary Encoder Panel -->
            <div id="encoder-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üîß Interactive Binary Encoder</h2>
                    
                    <!-- Instruction Builder -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üèóÔ∏è Build Your Own Instruction</h3>
                        
                        <div class="grid lg:grid-cols-2 gap-8">
                            <div>
                                <div class="mb-6">
                                    <label class="block font-medium mb-2">Instruction Type:</label>
                                    <select id="instruction-type" class="w-full p-3 border rounded" onchange="updateInstructionBuilder()">
                                        <option value="">Select instruction type...</option>
                                        <option value="beq">beq - Branch if Equal</option>
                                        <option value="bne">bne - Branch if Not Equal</option>
                                        <option value="j">j - Jump</option>
                                        <option value="jal">jal - Jump and Link</option>
                                        <option value="jr">jr - Jump Register</option>
                                    </select>
                                </div>

                                <div id="instruction-fields" class="space-y-4">
                                    <div class="text-center text-gray-500 py-8">
                                        Select an instruction type to configure fields
                                    </div>
                                </div>

                                <button class="w-full bg-blue-600 text-white p-3 rounded font-semibold hover:bg-blue-700 mt-4"
                                        onclick="encodeInstruction()" id="encode-btn" disabled>
                                    üîÑ Generate Binary Encoding
                                </button>
                            </div>
                            
                            <div>
                                <div class="mb-6">
                                    <h4 class="font-medium mb-2">32-bit Binary Encoding:</h4>
                                    <div id="binary-output" class="bg-gray-100 p-4 rounded code-font text-lg text-center min-h-16">
                                        <div class="text-gray-500 mt-2">Select and configure instruction</div>
                                    </div>
                                </div>

                                <div class="mb-6">
                                    <h4 class="font-medium mb-2">Field Breakdown:</h4>
                                    <div id="field-breakdown" class="bg-gray-50 p-4 rounded min-h-32">
                                        <div class="text-center text-gray-500 mt-4">
                                            Binary breakdown will appear here
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="font-medium mb-2">Hexadecimal:</h4>
                                    <div id="hex-output" class="bg-green-50 p-3 rounded code-font text-center text-lg">
                                        0x00000000
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Binary Editor -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">‚úèÔ∏è Manual Binary Editor</h3>
                        <p class="mb-4">Click on any bit to toggle it:</p>
                        
                        <div class="mb-6">
                            <div class="grid grid-cols-32 gap-1 mb-2" id="binary-editor">
                                <!-- 32 binary digits will be generated here -->
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>31</span>
                                <span>24</span>
                                <span>16</span>
                                <span>8</span>
                                <span>0</span>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <button class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 mr-2"
                                        onclick="clearBinary()">
                                    üóëÔ∏è Clear All
                                </button>
                                <button class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700"
                                        onclick="randomBinary()">
                                    üé≤ Random
                                </button>
                            </div>
                            <div>
                                <div class="text-right">
                                    <strong>Hex:</strong> <span id="manual-hex" class="code-font">0x00000000</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <h4 class="font-medium mb-2">Decoded Instruction:</h4>
                            <div id="decoded-instruction" class="bg-blue-50 p-4 rounded">
                                                              <div class="text-center text-gray-500">
                                    Edit bits above to decode instruction
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Practice Quiz Panel -->
            <div id="practice-panel" class="tab-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold">üéØ Practice Quiz & Challenges</h2>
                    
                    <!-- Quiz Section -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìù Knowledge Check Quiz</h3>
                        <p class="mb-6">Test your understanding of MIPS control flow instructions:</p>
                        
                        <div class="space-y-6" id="quiz-questions">
                            <!-- Question 1 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 1: Which instruction format is used for beq?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q1" value="R" class="quiz-radio">
                                        <span>R-type (Register format)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q1" value="I" class="quiz-radio">
                                        <span>I-type (Immediate format)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q1" value="J" class="quiz-radio">
                                        <span>J-type (Jump format)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 2 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 2: What is the opcode for jump (j) instruction?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q2" value="000010" class="quiz-radio">
                                        <span class="code-font">000010</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q2" value="000011" class="quiz-radio">
                                        <span class="code-font">000011</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q2" value="000100" class="quiz-radio">
                                        <span class="code-font">000100</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 3 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 3: Which instruction saves the return address?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q3" value="j" class="quiz-radio">
                                        <span class="code-font">j (jump)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q3" value="jal" class="quiz-radio">
                                        <span class="code-font">jal (jump and link)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q3" value="jr" class="quiz-radio">
                                        <span class="code-font">jr (jump register)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 4 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 4: What is the function code for jr instruction?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q4" value="001000" class="quiz-radio">
                                        <span class="code-font">001000</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q4" value="001001" class="quiz-radio">
                                        <span class="code-font">001001</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q4" value="100000" class="quiz-radio">
                                        <span class="code-font">100000</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Question 5 -->
                            <div class="question-card p-4 border rounded">
                                <h4 class="font-medium mb-3">Question 5: What is the register number for $ra?</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q5" value="11111" class="quiz-radio">
                                        <span class="code-font">11111 (31)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q5" value="11110" class="quiz-radio">
                                        <span class="code-font">11110 (30)</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="q5" value="11101" class="quiz-radio">
                                        <span class="code-font">11101 (29)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 text-center">
                            <button class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700"
                                    onclick="checkQuiz()">
                                ‚úÖ Check Answers
                            </button>
                            <div id="quiz-results" class="mt-4"></div>
                        </div>
                    </div>

                    <!-- Binary Challenges -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üß© Binary Decoding Challenge</h3>
                        <p class="mb-4">Decode these binary instructions:</p>
                        
                        <div class="space-y-4">
                            <!-- Challenge 1 -->
                            <div class="challenge-card p-4 bg-gray-50 rounded">
                                <h4 class="font-medium mb-2">Challenge 1: Decode this instruction</h4>
                                <div class="code-font text-lg mb-3">00010001000010010000000000001000</div>
                                <input type="text" class="w-full p-2 border rounded" 
                                       placeholder="Enter your answer (e.g., beq $t0, $t1, 8)"
                                       id="challenge1-answer">
                                <button class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                        onclick="checkChallenge(1, 'beq $t0, $t1, 8')">
                                    Check Answer
                                </button>
                                <div id="challenge1-feedback" class="mt-2"></div>
                            </div>

                            <!-- Challenge 2 -->
                            <div class="challenge-card p-4 bg-gray-50 rounded">
                                <h4 class="font-medium mb-2">Challenge 2: Decode this instruction</h4>
                                <div class="code-font text-lg mb-3">00001000000100000000000000100000</div>
                                <input type="text" class="w-full p-2 border rounded" 
                                       placeholder="Enter your answer"
                                       id="challenge2-answer">
                                <button class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                        onclick="checkChallenge(2, 'j 0x100020')">
                                    Check Answer
                                </button>
                                <div id="challenge2-feedback" class="mt-2"></div>
                            </div>

                            <!-- Challenge 3 -->
                            <div class="challenge-card p-4 bg-gray-50 rounded">
                                <h4 class="font-medium mb-2">Challenge 3: Decode this instruction</h4>
                                <div class="code-font text-lg mb-3">00000011111000000000000000001000</div>
                                <input type="text" class="w-full p-2 border rounded" 
                                       placeholder="Enter your answer"
                                       id="challenge3-answer">
                                <button class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                        onclick="checkChallenge(3, 'jr $ra')">
                                    Check Answer
                                </button>
                                <div id="challenge3-feedback" class="mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Summary -->
                    <div class="interactive-box p-6">
                        <h3 class="text-xl font-semibold mb-4">üìä Your Progress</h3>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600" id="quiz-score">0</div>
                                <div>Quiz Score (%)</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" id="challenges-solved">0</div>
                                <div>Challenges Solved</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-600" id="total-score">0</div>
                                <div>Total Score</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Global state
        let currentBits = new Array(32).fill(0);
        let quizState = {
            score: 0,
            challengesSolved: 0,
            totalScore: 0
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeBinaryEditor();
            calculateJump(); // Initialize jump calculator
            updateScoreboard();
        });

        // Tab switching functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('tab-active');
                    b.classList.add('tab-inactive');
                    b.setAttribute('aria-selected', 'false');
                });
                
                // Show selected tab
                document.getElementById(`${tabName}-panel`).classList.remove('hidden');
                btn.classList.add('tab-active');
                btn.classList.remove('tab-inactive');
                btn.setAttribute('aria-selected', 'true');
            });
        });

        // Instruction format display
        function showInstructionFormat(instruction, format) {
            const display = document.getElementById('format-display');
            let formatHtml = '';
            
            if (format === 'I') {
                const opcode = getOpcode(instruction);
                formatHtml = `
                    <div class="mb-3">
                        <h4 class="font-semibold text-blue-600 mb-2">I-Type Format: ${instruction}</h4>
                        <div class="grid grid-cols-4 gap-0 text-xs mb-1">
                            <div class="field-label">opcode (6)</div>
                            <div class="field-label">rs (5)</div>
                            <div class="field-label">rt (5)</div>
                            <div class="field-label">immediate (16)</div>
                        </div>
                        <div class="grid grid-cols-4 gap-0">
                            <div class="binary-field p-2">${opcode}</div>
                            <div class="binary-field p-2">rs</div>
                            <div class="binary-field p-2">rt</div>
                            <div class="binary-field p-2">offset</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        Branch target = PC + 4 + (offset √ó 4)
                    </div>
                `;
            } else if (format === 'J') {
                const opcode = getOpcode(instruction);
                formatHtml = `
                    <div class="mb-3">
                        <h4 class="font-semibold text-orange-600 mb-2">J-Type Format: ${instruction}</h4>
                        <div class="grid grid-cols-2 gap-0 text-xs mb-1">
                            <div class="field-label">opcode (6)</div>
                            <div class="field-label">address (26)</div>
                        </div>
                        <div class="grid grid-cols-2 gap-0">
                            <div class="binary-field p-2">${opcode}</div>
                            <div class="binary-field p-2">jump target</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        Jump target = (PC+4)[31:28] | address << 2
                    </div>
                `;
            } else if (format === 'R') {
                const funct = getFunctionCode(instruction);
                formatHtml = `
                    <div class="mb-3">
                        <h4 class="font-semibold text-red-600 mb-2">R-Type Format: ${instruction}</h4>
                        <div class="grid grid-cols-6 gap-0 text-xs mb-1">
                            <div class="field-label">op (6)</div>
                            <div class="field-label">rs (5)</div>
                            <div class="field-label">rt (5)</div>
                            <div class="field-label">rd (5)</div>
                            <div class="field-label">shamt (5)</div>
                            <div class="field-label">funct (6)</div>
                        </div>
                        <div class="grid grid-cols-6 gap-0">
                            <div class="binary-field p-2">000000</div>
                            <div class="binary-field p-2">rs</div>
                            <div class="binary-field p-2">00000</div>
                            <div class="binary-field p-2">00000</div>
                            <div class="binary-field p-2">00000</div>
                            <div class="binary-field p-2">${funct}</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        Jump to address stored in register rs
                    </div>
                `;
            }
            
            display.innerHTML = formatHtml;
        }

        // Helper functions
        function getOpcode(instruction) {
            const opcodes = {
                'beq': '000100',
                'bne': '000101',
                'bltz': '000001',
                'bgez': '000001',
                'j': '000010',
                'jal': '000011',
                'jr': '000000'
            };
            return opcodes[instruction] || '??????';
        }

        function getFunctionCode(instruction) {
            const funcCodes = {
                'jr': '001000',
                'jalr': '001001'
            };
            return funcCodes[instruction] || '??????';
        }

        function getRegisterNumber(reg) {
            const registers = {
                '$zero': '00000', '$t0': '01000', '$t1': '01001', '$t2': '01010',
                '$s0': '10000', '$s1': '10001', '$ra': '11111', '$sp': '11101'
            };
            return registers[reg] || '00000';
        }

        // Branch decoder
        function decodeBranch() {
            const input = document.getElementById('branch-input').value.trim();
            const result = document.getElementById('branch-decode-result');
            
            if (!input) {
                result.innerHTML = '<div class="text-center text-gray-500 mt-4">Enter a branch instruction</div>';
                return;
            }

            try {
                const parts = input.split(/[\s,]+/).filter(p => p);
                const opcode = parts[0];
                
                let binary = '';
                let breakdown = '';
                
                if (opcode === 'beq' || opcode === 'bne') {
                    const opcodeField = getOpcode(opcode);
                    const rs = getRegisterNumber(parts[1]);
                    const rt = getRegisterNumber(parts[2]);
                    const offset = parseInt(parts[3]) || 0;
                    const offsetBinary = (offset & 0xFFFF).toString(2).padStart(16, '0');
                    
                    binary = opcodeField + rs + rt + offsetBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode (${opcode}):</strong> ${opcodeField}</div>
                            <div><strong>rs (${parts[1]}):</strong> ${rs}</div>
                            <div><strong>rt (${parts[2]}):</strong> ${rt}</div>
                            <div><strong>Offset:</strong> ${offsetBinary} (${offset})</div>
                        </div>
                    `;
                } else {
                    throw new Error('Unsupported instruction');
                }

                const hex = parseInt(binary, 2).toString(16).toUpperCase().padStart(8, '0');
                
                result.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold mb-2">Binary Encoding:</h4>
                            <div class="code-font text-lg bg-blue-50 p-2 rounded">${binary}</div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Field Breakdown:</h4>
                            ${breakdown}
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Hexadecimal:</h4>
                            <div class="code-font text-lg bg-green-50 p-2 rounded">0x${hex}</div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `<div class="text-red-600 p-3 bg-red-50 rounded">Error: ${error.message}</div>`;
            }
        }

        function loadBranchExample(example) {
            document.getElementById('branch-input').value = example;
            decodeBranch();
        }

        // Jump address calculator
        function calculateJump() {
            try {
                const pcStr = document.getElementById('j-pc').value;
                const addressStr = document.getElementById('j-address').value;
                
                const pc = parseInt(pcStr, 16) || 0;
                const address = parseInt(addressStr, 16) || 0;
                
                const pcPlus4 = pc + 4;
                const upperBits = pcPlus4 & 0xF0000000;
                const shiftedAddress = (address & 0x3FFFFFF) << 2;
                const target = upperBits | shiftedAddress;
                
                document.getElementById('j-result').textContent = `0x${target.toString(16).toUpperCase().padStart(8, '0')}`;
                
                document.getElementById('j-steps').innerHTML = `
                    <div class="space-y-1">
                        <div>1. PC + 4 = 0x${pcPlus4.toString(16).toUpperCase().padStart(8, '0')}</div>
                        <div>2. Upper 4 bits = 0x${(upperBits >>> 28).toString(16).toUpperCase()}</div>
                        <div>3. Address field = 0x${address.toString(16).toUpperCase()}</div>
                        <div>4. Shifted address = 0x${shiftedAddress.toString(16).toUpperCase().padStart(8, '0')}</div>
                        <div>5. Final target = 0x${target.toString(16).toUpperCase().padStart(8, '0')}</div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('j-result').textContent = 'Invalid input';
            }
        }

        // Instruction builder
        function updateInstructionBuilder() {
            const type = document.getElementById('instruction-type').value;
            const fieldsDiv = document.getElementById('instruction-fields');
            const encodeBtn = document.getElementById('encode-btn');
            
            if (!type) {
                fieldsDiv.innerHTML = '<div class="text-center text-gray-500 py-8">Select instruction type</div>';
                encodeBtn.disabled = true;
                return;
            }

            let fieldsHtml = '';
            
            if (type === 'beq' || type === 'bne') {
                fieldsHtml = `
                    <div>
                        <label class="block font-medium mb-1">Source Register (rs):</label>
                        <select id="field-rs" class="w-full p-2 border rounded">
                            <option value="01000">$t0</option>
                            <option value="01001">$t1</option>
                            <option value="10000">$s0</option>
                            <option value="00000">$zero</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-1">Target Register (rt):</label>
                        <select id="field-rt" class="w-full p-2 border rounded">
                            <option value="01000">$t0</option>
                            <option value="01001">$t1</option>
                            <option value="10000">$s0</option>
                            <option value="00000">$zero</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-1">Branch Offset:</label>
                        <input type="number" id="field-offset" class="w-full p-2 border rounded" value="4">
                    </div>
                `;
            } else if (type === 'j' || type === 'jal') {
                fieldsHtml = `
                    <div>
                        <label class="block font-medium mb-1">Jump Address (26-bit):</label>
                        <input type="text" id="field-address" class="w-full p-2 border rounded code-font" 
                               value="0x100000" placeholder="0x100000">
                    </div>
                `;
            } else if (type === 'jr') {
                fieldsHtml = `
                    <div>
                        <label class="block font-medium mb-1">Jump Register (rs):</label>
                        <select id="field-rs" class="w-full p-2 border rounded">
                            <option value="11111">$ra</option>
                            <option value="01000">$t0</option>
                            <option value="01001">$t1</option>
                        </select>
                    </div>
                `;
            }
            
            fieldsDiv.innerHTML = fieldsHtml;
            encodeBtn.disabled = false;
        }

        function encodeInstruction() {
            const type = document.getElementById('instruction-type').value;
            
            try {
                let binary = '';
                let breakdown = '';
                let opcode = getOpcode(type);
                
                if (type === 'beq' || type === 'bne') {
                    const rs = document.getElementById('field-rs').value;
                    const rt = document.getElementById('field-rt').value;
                    const offset = parseInt(document.getElementById('field-offset').value) || 0;
                    const offsetBinary = (offset & 0xFFFF).toString(2).padStart(16, '0');
                    
                    binary = opcode + rs + rt + offsetBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode:</strong> ${opcode}</div>
                            <div><strong>rs:</strong> ${rs}</div>
                            <div><strong>rt:</strong> ${rt}</div>
                            <div><strong>Offset:</strong> ${offsetBinary}</div>
                        </div>
                    `;
                } else if (type === 'j' || type === 'jal') {
                    const addressStr = document.getElementById('field-address').value;
                    const address = parseInt(addressStr, 16) & 0x3FFFFFF;
                    const addressBinary = address.toString(2).padStart(26, '0');
                    
                    binary = opcode + addressBinary;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode:</strong> ${opcode}</div>
                            <div><strong>Address:</strong> ${addressBinary}</div>
                        </div>
                    `;
                } else if (type === 'jr') {
                    const rs = document.getElementById('field-rs').value;
                    const funct = '001000';
                    
                    binary = '000000' + rs + '00000' + '00000' + '00000' + funct;
                    breakdown = `
                        <div class="space-y-2 text-sm">
                            <div><strong>Opcode:</strong> 000000</div>
                            <div><strong>rs:</strong> ${rs}</div>
                            <div><strong>Function:</strong> ${funct}</div>
                        </div>
                    `;
                }
                
                const hex = parseInt(binary, 2).toString(16).toUpperCase().padStart(8, '0');
                
                document.getElementById('binary-output').innerHTML = `<div class="text-blue-700">${binary}</div>`;
                document.getElementById('field-breakdown').innerHTML = breakdown;
                document.getElementById('hex-output').textContent = '0x' + hex;
                
            } catch (error) {
                document.getElementById('binary-output').innerHTML = `<div class="text-red-600">Error: ${error.message}</div>`;
            }
        }

        // Binary editor
        function initializeBinaryEditor() {
            const editor = document.getElementById('binary-editor');
            editor.innerHTML = '';
            
            for (let i = 0; i < 32; i++) {
                const bit = document.createElement('div');
                bit.className = 'binary-bit bg-gray-200 text-center cursor-pointer hover:bg-gray-300';
                bit.textContent = '0';
                bit.onclick = () => toggleBit(i);
                editor.appendChild(bit);
            }
            
            updateBinaryDisplay();
        }

        function toggleBit(index) {
            currentBits[index] = 1 - currentBits[index];
            updateBinaryDisplay();
        }

        function clearBinary() {
            currentBits = new Array(32).fill(0);
            updateBinaryDisplay();
        }

        function randomBinary() {
            currentBits = Array.from({length: 32}, () => Math.random() > 0.5 ? 1 : 0);
            updateBinaryDisplay();
        }

        function updateBinaryDisplay() {
            const editor = document.getElementById('binary-editor');
            const children = editor.children;
            
            for (let i = 0; i < 32; i++) {
                children[i].textContent = currentBits[i];
                children[i].className = currentBits[i] === 1 ? 
                    'binary-bit bg-blue-500 text-white text-center cursor-pointer hover:bg-blue-600' :
                    'binary-bit bg-gray-200 text-center cursor-pointer hover:bg-gray-300';
            }
            
            const binaryString = currentBits.join('');
            const hex = parseInt(binaryString, 2).toString(16).toUpperCase().padStart(8, '0');
            document.getElementById('manual-hex').textContent = '0x' + hex;
            
            decodeBinaryInstruction(binaryString);
        }

        function decodeBinaryInstruction(binary) {
            const decoded = document.getElementById('decoded-instruction');
            const opcode = binary.substring(0, 6);
            
            let instruction = 'Unknown instruction';
            
            switch (opcode) {
                case '000100': instruction = 'beq (Branch if Equal)'; break;
                case '000101': instruction = 'bne (Branch if Not Equal)'; break;
                case '000010': instruction = 'j (Jump)'; break;
                case '000011': instruction = 'jal (Jump and Link)'; break;
                case '000000':
                    const funct = binary.substring(26, 32);
                    if (funct === '001000') instruction = 'jr (Jump Register)';
                    else if (funct === '001001') instruction = 'jalr (Jump and Link Register)';
                    break;
            }
            
            decoded.innerHTML = `
                <div class="text-center">
                    <div class="font-semibold text-lg">${instruction}</div>
                    <div class="text-sm text-gray-600 mt-2">Opcode: ${opcode}</div>
                </div>
            `;
        }

                // Quiz functionality
        function checkQuiz() {
            const answers = { q1: 'I', q2: '000010', q3: 'jal', q4: '001000', q5: '11111' };
            
            let correct = 0;
            let total = Object.keys(answers).length;
            
            Object.keys(answers).forEach(question => {
                const selected = document.querySelector(`input[name="${question}"]:checked`);
                if (selected && selected.value === answers[question]) {
                    correct++;
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            quizState.score = percentage;
            
            const resultsDiv = document.getElementById('quiz-results');
            resultsDiv.innerHTML = `
                <div class="p-4 rounded ${correct === total ? 'success-highlight' : 'bg-yellow-100 text-yellow-800'}">
                    <div class="font-semibold">Quiz Results: ${correct}/${total} correct (${percentage}%)</div>
                    ${correct === total ? 
                        '<div class="mt-2">üéâ Perfect score! You have mastered the concepts!</div>' :
                        '<div class="mt-2">Review the concepts and try again to improve your score.</div>'
                    }
                </div>
            `;
            
            updateScoreboard();
        }

        // Challenge checking
        function checkChallenge(challengeNum, correctAnswer) {
            const userAnswer = document.getElementById(`challenge${challengeNum}-answer`).value.trim();
            const feedback = document.getElementById(`challenge${challengeNum}-feedback`);
            
            // Normalize answers for comparison
            const normalizedUser = userAnswer.toLowerCase().replace(/\s+/g, ' ');
            const normalizedCorrect = correctAnswer.toLowerCase().replace(/\s+/g, ' ');
            
            if (normalizedUser === normalizedCorrect) {
                feedback.innerHTML = '<div class="text-green-600 font-semibold">‚úÖ Correct!</div>';
                if (!feedback.dataset.solved) {
                    quizState.challengesSolved++;
                    feedback.dataset.solved = 'true';
                }
            } else {
                feedback.innerHTML = `<div class="text-red-600">‚ùå Incorrect. Expected: <code>${correctAnswer}</code></div>`;
                feedback.dataset.solved = 'false';
            }
            
            updateScoreboard();
        }

        // Scoreboard update
        function updateScoreboard() {
            document.getElementById('quiz-score').textContent = quizState.score;
            document.getElementById('challenges-solved').textContent = quizState.challengesSolved;
            document.getElementById('total-score').textContent = quizState.score + (quizState.challengesSolved * 20);
        }

        // Reset functionality
        function resetAllProgress() {
            if (confirm('Are you sure you want to reset all progress?')) {
                quizState = { score: 0, challengesSolved: 0, totalScore: 0 };
                updateScoreboard();
                
                // Reset quiz selections
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // Clear challenge answers and feedback
                document.querySelectorAll('[id$="-answer"]').forEach(input => {
                    input.value = '';
                });
                
                document.querySelectorAll('[id$="-feedback"]').forEach(feedback => {
                    feedback.innerHTML = '';
                    feedback.dataset.solved = 'false';
                });
                
                document.getElementById('quiz-results').innerHTML = '';
            }
        }

        // Helper function to format binary for display
        function formatBinary(binary) {
            // Add spaces every 4 bits for readability
            return binary.match(/.{1,4}/g).join(' ');
        }

        // Additional helper function for instruction analysis
        function analyzeInstruction(binary) {
            const opcode = binary.substring(0, 6);
            let analysis = {};
            
            switch (opcode) {
                case '000100': // beq
                case '000101': // bne
                    analysis = {
                        type: 'I-Type Branch',
                        opcode: opcode,
                        rs: binary.substring(6, 11),
                        rt: binary.substring(11, 16),
                        immediate: binary.substring(16, 32)
                    };
                    break;
                case '000010': // j
                case '000011': // jal
                    analysis = {
                        type: 'J-Type Jump',
                        opcode: opcode,
                        address: binary.substring(6, 32)
                    };
                    break;
                case '000000': // R-Type
                    analysis = {
                        type: 'R-Type',
                        opcode: opcode,
                        rs: binary.substring(6, 11),
                        rt: binary.substring(11, 16),
                        rd: binary.substring(16, 21),
                        shamt: binary.substring(21, 26),
                        funct: binary.substring(26, 32)
                    };
                    break;
                default:
                    analysis = {
                        type: 'Unknown',
                        opcode: opcode
                    };
            }
            
            return analysis;
        }

        // Enhanced instruction decoder with more detail
        function enhancedDecodeBinary(binary) {
            const analysis = analyzeInstruction(binary);
            const decoded = document.getElementById('decoded-instruction');
            
            let html = `<div class="space-y-2">`;
            html += `<div class="font-semibold text-lg">${getInstructionName(analysis)}</div>`;
            html += `<div class="text-sm"><strong>Type:</strong> ${analysis.type}</div>`;
            html += `<div class="text-sm"><strong>Opcode:</strong> ${analysis.opcode}</div>`;
            
            if (analysis.type === 'I-Type Branch') {
                html += `<div class="text-xs mt-2">`;
                html += `<div>rs: ${analysis.rs} (${parseInt(analysis.rs, 2)})</div>`;
                html += `<div>rt: ${analysis.rt} (${parseInt(analysis.rt, 2)})</div>`;
                html += `<div>offset: ${analysis.immediate} (${parseInt(analysis.immediate, 2)})</div>`;
                html += `</div>`;
            } else if (analysis.type === 'J-Type Jump') {
                html += `<div class="text-xs mt-2">`;
                html += `<div>address: ${analysis.address}</div>`;
                html += `<div>target: 0x${(parseInt(analysis.address, 2) << 2).toString(16).toUpperCase()}</div>`;
                html += `</div>`;
            } else if (analysis.type === 'R-Type') {
                html += `<div class="text-xs mt-2">`;
                html += `<div>rs: ${analysis.rs} (${parseInt(analysis.rs, 2)})</div>`;
                html += `<div>funct: ${analysis.funct}</div>`;
                html += `</div>`;
            }
            html += `</div>`;
            
            decoded.innerHTML = html;
        }

        function getInstructionName(analysis) {
            if (analysis.opcode === '000100') return 'beq (Branch if Equal)';
            if (analysis.opcode === '000101') return 'bne (Branch if Not Equal)';
            if (analysis.opcode === '000010') return 'j (Jump)';
            if (analysis.opcode === '000011') return 'jal (Jump and Link)';
            if (analysis.opcode === '000000') {
                if (analysis.funct === '001000') return 'jr (Jump Register)';
                if (analysis.funct === '001001') return 'jalr (Jump and Link Register)';
            }
            return 'Unknown Instruction';
        }

        // Keyboard shortcuts for better usability
        document.addEventListener('keydown', (e) => {
            // Press 'R' to clear binary editor
            if (e.key === 'r' || e.key === 'R') {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    clearBinary();
                }
            }
            
            // Press 'T' to generate random binary
            if (e.key === 't' || e.key === 'T') {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    randomBinary();
                }
            }
        });

        // Auto-save functionality for form inputs
        function saveFormState() {
            const formData = {};
            
            // Save instruction builder state
            const instrType = document.getElementById('instruction-type');
            if (instrType) formData.instructionType = instrType.value;
            
            // Save branch input
            const branchInput = document.getElementById('branch-input');
            if (branchInput) formData.branchInput = branchInput.value;
            
            // Save jump calculator inputs
            const jPc = document.getElementById('j-pc');
            const jAddress = document.getElementById('j-address');
            if (jPc) formData.jumpPc = jPc.value;
            if (jAddress) formData.jumpAddress = jAddress.value;
            
            localStorage.setItem('mipsGuideState', JSON.stringify(formData));
        }

        function loadFormState() {
            try {
                const saved = localStorage.getItem('mipsGuideState');
                if (!saved) return;
                
                const formData = JSON.parse(saved);
                
                // Restore instruction builder
                const instrType = document.getElementById('instruction-type');
                if (instrType && formData.instructionType) {
                    instrType.value = formData.instructionType;
                    updateInstructionBuilder();
                }
                
                // Restore branch input
                const branchInput = document.getElementById('branch-input');
                if (branchInput && formData.branchInput) {
                    branchInput.value = formData.branchInput;
                    decodeBranch();
                }
                
                // Restore jump calculator
                const jPc = document.getElementById('j-pc');
                const jAddress = document.getElementById('j-address');
                if (jPc && formData.jumpPc) jPc.value = formData.jumpPc;
                if (jAddress && formData.jumpAddress) jAddress.value = formData.jumpAddress;
                if (formData.jumpPc || formData.jumpAddress) calculateJump();
                
            } catch (error) {
                console.log('Could not restore form state:', error);
            }
        }

        // Auto-save on input changes
        document.addEventListener('input', (e) => {
            if (e.target.id === 'instruction-type' || 
                e.target.id === 'branch-input' || 
                e.target.id === 'j-pc' || 
                e.target.id === 'j-address') {
                setTimeout(saveFormState, 500); // Debounce saves
            }
        });

        // Load saved state on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadFormState, 100); // Give DOM time to fully load
        });

        // Export functionality for instructors
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                quizScore: quizState.score,
                challengesSolved: quizState.challengesSolved,
                totalScore: quizState.totalScore,
                currentSession: {
                    instructionType: document.getElementById('instruction-type').value,
                    branchInput: document.getElementById('branch-input').value,
                    jumpCalculator: {
                        pc: document.getElementById('j-pc').value,
                        address: document.getElementById('j-address').value
                    }
                }
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `mips-control-flow-results-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
        }

        // Add export button to progress section
        document.addEventListener('DOMContentLoaded', () => {
            const progressSection = document.querySelector('#practice-panel .interactive-box:last-child .grid');
            if (progressSection) {
                const exportDiv = document.createElement('div');
                exportDiv.className = 'text-center col-span-full mt-4';
                exportDiv.innerHTML = `
                    <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 text-sm"
                            onclick="exportResults()">
                        üìä Export Results
                    </button>
                `;
                progressSection.parentNode.appendChild(exportDiv);
            }
        });

        // Tooltip functionality for better UX
        function addTooltips() {
            const tooltips = {
                'binary-editor': 'Click any bit to toggle between 0 and 1',
                'instruction-type': 'Choose an instruction to see its binary encoding',
                'branch-input': 'Enter a branch instruction like: beq $t0, $t1, 8',
                'j-pc': 'Current program counter value in hexadecimal',
                'j-address': '26-bit address field from the jump instruction'
            };
            
            Object.keys(tooltips).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.title = tooltips[id];
                }
            });
        }

        // Initialize tooltips after DOM loads
        document.addEventListener('DOMContentLoaded', addTooltips);

        // Performance optimization: Debounce rapid operations
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Optimized versions of frequently called functions
        const debouncedDecodeBranch = debounce(decodeBranch, 300);
        const debouncedCalculateJump = debounce(calculateJump, 300);

        // Replace direct calls with debounced versions for better performance
        document.addEventListener('DOMContentLoaded', () => {
            const branchInput = document.getElementById('branch-input');
            if (branchInput) {
                branchInput.removeAttribute('oninput');
                branchInput.addEventListener('input', debouncedDecodeBranch);
            }
            
            const jPc = document.getElementById('j-pc');
            const jAddress = document.getElementById('j-address');
            if (jPc) {
                jPc.removeAttribute('oninput');
                jPc.addEventListener('input', debouncedCalculateJump);
            }
            if (jAddress) {
                jAddress.removeAttribute('oninput');
                jAddress.addEventListener('input', debouncedCalculateJump);
            }
        });

        // Final initialization
        console.log('MIPS Control Flow Instructions Guide loaded successfully!');
    </script>
</body>
</html>
