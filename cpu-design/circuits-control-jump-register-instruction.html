<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuits: Jump Register-Only</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      
      * {
        font-family: 'Inter', sans-serif;
      }
      
      body {
        background-color: #FDFBF8;
        color: #1A1A1A;
      }
      
      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: #2563EB;
        color: white;
        padding: 0.5rem 1rem;
        text-decoration: none;
        border-radius: 0 0 4px 0;
        z-index: 1000;
      }
      
      .skip-link:focus {
        top: 0;
      }
      
      h1, h2, h3 {
        color: #1A1A1A;
      }
      
      h1 {
        font-weight: 700;
        letter-spacing: -0.025em;
      }
      
      /* Transcript Highlight Styles */
      .transcript-line {
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 6px;
        transition: background-color 0.2s ease, border-left-color 0.2s ease;
        border-left: 4px solid transparent;
      }
      
      .transcript-line:hover {
        background-color: #f3f4f6;
      }
      
      .transcript-line.highlight {
        background-color: #e2e8f0;
        border-left: 4px solid #3b82f6;
        font-weight: 500;
      }

      /* Custom Scrollbar for Transcript */
      #transcript-container::-webkit-scrollbar {
        width: 8px;
      }
      
      #transcript-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }
      
      #transcript-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      
      #transcript-container::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col">
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          <div class="flex items-center gap-2">
            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
            </svg>
            <span class="font-bold text-xl tracking-tight">Computer Organization</span>
          </div>
          <nav class="flex space-x-4">
            <a href="#" class="text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium">Home</a>
            <a href="#" class="text-gray-900 bg-gray-100 px-3 py-2 rounded-md text-sm font-medium" aria-current="page">Modules</a>
          </nav>
        </div>
      </div>
    </header>

    <main id="main-content" class="flex-grow py-8 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Breadcrumb -->
        <nav class="flex mb-8 text-sm text-gray-500" aria-label="Breadcrumb">
          <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
              <a href="#" class="inline-flex items-center hover:text-blue-600">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                Modules
              </a>
            </li>
            <li>
              <div class="flex items-center">
                <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                <a href="#" class="ml-1 hover:text-blue-600 md:ml-2">CPU Design</a>
              </div>
            </li>
            <li aria-current="page">
              <div class="flex items-center">
                <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                <span class="ml-1 text-gray-800 font-semibold md:ml-2">Jump Register</span>
              </div>
            </li>
          </ol>
        </nav>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
          <div class="p-6 md:p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Jump Register Instruction</h1>
            <p class="text-lg text-gray-600 mb-8 max-w-3xl">
              Understand how the Jump Register instruction alters program flow by loading a specific register's value directly into the Program Counter.
            </p>

            <!-- Video and Transcript Section (Updated per Guide v2) -->
            <div class="flex flex-col lg:flex-row gap-6 w-full mb-10">
                <!-- Video Player Section: 66% width on large screens -->
                <div class="w-full lg:w-2/3">
                    <div class="relative w-full rounded-xl overflow-hidden shadow-md bg-black" style="padding-bottom: 56.25%; height: 0;">
                        <iframe 
                            id="video-player"
                            class="absolute top-0 left-0 w-full h-full"
                            src="https://www.youtube.com/embed/MsYq6yor3Ag?enablejsapi=1" 
                            title="YouTube video player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>

                <!-- Transcript Section: 33% width on large screens -->
                <div class="w-full lg:w-1/3 flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm h-96 lg:h-auto">
                    <div class="p-4 border-b border-gray-100 bg-gray-50 rounded-t-xl">
                        <h3 class="font-semibold text-gray-700 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            Transcript
                        </h3>
                    </div>
                    <!-- The container that scrolls -->
                    <div id="transcript-container" class="flex-grow overflow-y-auto p-4 space-y-2 bg-white rounded-b-xl">
                        <div id="transcript-content" class="text-sm text-gray-600 leading-relaxed">
                            <!-- Transcript lines will be injected here by JS -->
                            <div class="animate-pulse space-y-3">
                                <div class="h-4 bg-gray-100 rounded w-3/4"></div>
                                <div class="h-4 bg-gray-100 rounded"></div>
                                <div class="h-4 bg-gray-100 rounded w-5/6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Tabs -->
            <div class="mt-8">
              <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs" role="tablist">
                  <button 
                    class="border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none focus:text-blue-800 focus:border-blue-800 transition-colors"
                    id="tab-overview"
                    role="tab"
                    aria-selected="true"
                    aria-controls="panel-overview"
                    tabindex="0">
                    Overview
                  </button>
                  <button 
                    class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none focus:text-gray-700 focus:border-gray-400 transition-colors"
                    id="tab-diagram"
                    role="tab"
                    aria-selected="false"
                    aria-controls="panel-diagram"
                    tabindex="-1">
                    Circuit Diagram
                  </button>
                  <button 
                    class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none focus:text-gray-700 focus:border-gray-400 transition-colors"
                    id="tab-quiz"
                    role="tab"
                    aria-selected="false"
                    aria-controls="panel-quiz"
                    tabindex="-1">
                    Knowledge Check
                  </button>
                </nav>
              </div>

              <!-- Tab Panels -->
              <div class="mt-6">
                <!-- Overview Panel -->
                <div id="panel-overview" role="tabpanel" aria-labelledby="tab-overview" class="space-y-4">
                  <h3 class="text-lg font-medium text-gray-900">Key Concepts</h3>
                  <ul class="list-disc pl-5 space-y-2 text-gray-700">
                    <li><strong>Opcode:</strong> The Jump Register opcode is <code class="bg-gray-100 px-1 py-0.5 rounded text-sm font-mono">0011</code>.</li>
                    <li><strong>Target:</strong> The instruction specifies a source register (e.g., Register B).</li>
                    <li><strong>Operation:</strong> The value stored in the source register is moved to the Bus, and then loaded into the Program Counter (PC).</li>
                    <li><strong>Effect:</strong> The next instruction fetch will occur at the memory address that was just loaded into the PC.</li>
                  </ul>
                </div>

                <!-- Diagram Panel -->
                <div id="panel-diagram" role="tabpanel" aria-labelledby="tab-diagram" class="hidden space-y-4">
                   <h3 class="text-lg font-medium text-gray-900">Data Path Visualization</h3>
                   <div class="bg-gray-100 p-8 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300">
                     <p class="text-gray-500 italic">Circuit diagram visualization placeholder</p>
                   </div>
                </div>

                <!-- Quiz Panel -->
                <div id="panel-quiz" role="tabpanel" aria-labelledby="tab-quiz" class="hidden space-y-4">
                  <h3 class="text-lg font-medium text-gray-900">Quick Quiz</h3>
                  <div class="space-y-4">
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                      <p class="font-medium text-gray-900 mb-3">Which component's value is updated during a Jump Register instruction?</p>
                      <div class="space-y-2">
                        <label class="flex items-center space-x-3">
                          <input type="radio" name="q1" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                          <span class="text-gray-700">The Accumulator</span>
                        </label>
                        <label class="flex items-center space-x-3">
                          <input type="radio" name="q1" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                          <span class="text-gray-700">The Instruction Register</span>
                        </label>
                        <label class="flex items-center space-x-3">
                          <input type="radio" name="q1" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                          <span class="text-gray-700">The Program Counter</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-white border-t border-gray-200 mt-auto">
      <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <p class="text-center text-sm text-gray-500">Â© 2024 Computer Organization Course. All rights reserved.</p>
      </div>
    </footer>

    <!-- Video & Transcript Scripts -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
      // 1. VTT Data
      const vttData = `WEBVTT

00:00.000 --> 00:11.120
Aloha in this little video I want to talk about the jump register command and

00:11.120 --> 00:16.620
operation and how it works and so let's look at the code first so jump register

00:16.620 --> 00:21.600
is zero zero one one are the first four bits the next two bits are not used and

00:21.600 --> 00:29.320
then the last two are to define register B in our control unit and what happens

00:29.320 --> 00:34.480
is so we use jump register register B which basically what we're going to do

00:34.480 --> 00:40.240
is we're going to take the value stored in register B and it's going to be a

00:40.240 --> 00:44.180
memory address and we're going to stick that into our program counter meaning

00:44.180 --> 00:51.280
this is the address for the next instruction okay so today what we've

00:51.280 --> 00:55.780
been doing is just adding one through the accumulator to get to the next

00:55.780 --> 01:03.960
instruction here we're going to jump to wherever register B points to okay so

01:03.960 --> 01:08.520
that's the idea of jump register this is what the micro code looks like so

01:08.520 --> 01:13.200
here's our address three there's our op code for jump register and then

01:13.200 --> 01:21.400
it's register B so the register B enable we're going to enable register B onto

01:21.400 --> 01:28.080
the bus and then we're going to jump register or load the program counter

01:28.080 --> 01:32.480
so that's this jump register part load the program counter from the bus so

01:32.480 --> 01:37.400
whatever's on register B goes on the bus and then it goes into the program counter

01:37.400 --> 01:43.900
so let's see how that works okay so let's start the simulation

01:43.900 --> 01:47.360
and let's go look at our code first so here's our code

01:47.360 --> 01:54.680
so we're going to do an immediate load of register B with a value of four

01:54.680 --> 02:00.680
okay so we're going to put four into register B then we're going to jump to

02:00.680 --> 02:05.100
register B so basically we're going to jump to line four which is right here

02:05.100 --> 02:11.580
okay that's what we want to have happen but let's go through the steps so

02:11.580 --> 02:16.860
first thing we do is we load four into register B so that works and let's go

02:16.860 --> 02:22.680
see that so here we are in register B and we have a value of four okay so

02:22.680 --> 02:28.320
that's good so now we're going to the next instruction this is instruction

02:28.320 --> 02:35.840
is in memory address two so we're fetching from two and we're getting

02:35.840 --> 02:40.620
this value here which is our jump register register B okay so now

02:40.620 --> 02:45.180
we've fetched it we put it into the instruction register the instruction

02:45.180 --> 02:49.120
register now tells the control unit what to do and here's our

02:49.120 --> 02:57.320
and we can see that we have turned on enable register B and jump which is

02:57.320 --> 02:58.080
super

02:58.080 --> 03:06.140
complex circuit all right so again but though it's starting at four because

03:06.140 --> 03:13.020
this is the one two and three is a fetch so we will go to our CPU and we will get

03:13.020 --> 03:28.080
to four there we're at four okay and so we got four and we did enable so

03:28.080 --> 03:33.080
we're able reg B we just registered three and so everything whatever is in

03:33.080 --> 03:39.700
registry is now on the bus okay so here it is on the bus it's all one it's on

03:39.700 --> 03:44.360
the bus it's not in our program counter yet because they haven't tried to set it

03:44.360 --> 03:50.300
so when we cycle the next one it's set now we've set our program counter and

03:50.300 --> 03:57.940
just taken the value of the bus which is all ones okay so now we're setting and

03:57.940 --> 04:02.980
we can see that here the program counter is now four we're done with

04:02.980 --> 04:08.520
that instruction so we go back to step one of the fetch cycle and where are

04:08.520 --> 04:15.540
we going to fetch from well we're going to fetch from address four so we go over

04:15.540 --> 04:22.280
to ram and we can see that we are fetching from address four which is a

04:22.280 --> 04:30.980
load immediate to register a with the value of one so that's how jump register

04:30.980 --> 04:36.560
works whatever is in the register that you define we put that into the program

04:36.560 --> 04:41.240
counter and that's where we go for our next instruction thanks for watching`;

      // 2. Transcript Manager Class
      class TranscriptManager {
          constructor(vttContent, videoId, transcriptId) {
              this.vttContent = vttContent;
              this.player = null;
              this.transcriptContainer = document.getElementById(transcriptId);
              this.cues = [];
              this.isAutoScrolling = false;
              
              this.init();
          }

          init() {
              this.parseVTT();
              this.renderTranscript();
              this.setupHeightSync();
          }

          parseVTT() {
              const lines = this.vttContent.split('\n');
              let currentTime = null;
              
              lines.forEach(line => {
                  line = line.trim();
                  if (!line || line === 'WEBVTT') return;
                  
                  // Support both MM:SS.mmm and HH:MM:SS.mmm formats
                  const timeMatch = line.match(/(\d{2}:)?(\d{2}:\d{2}\.\d{3}) --> (\d{2}:)?(\d{2}:\d{2}\.\d{3})/);
                  
                  if (timeMatch) {
                      currentTime = this.parseTime(timeMatch[0].split(' --> ')[0]);
                  } else if (currentTime !== null) {
                      this.cues.push({
                          time: currentTime,
                          text: line
                      });
                      currentTime = null; // Reset until next timestamp
                  }
              });
          }

          parseTime(timeString) {
              const parts = timeString.split(':');
              let seconds = 0;
              if (parts.length === 3) {
                  seconds = parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseFloat(parts[2]);
              } else {
                  seconds = parseInt(parts[0]) * 60 + parseFloat(parts[1]);
              }
              return seconds;
          }

          renderTranscript() {
              this.transcriptContainer.innerHTML = '';
              this.cues.forEach((cue, index) => {
                  const div = document.createElement('div');
                  div.className = 'transcript-line';
                  div.dataset.time = cue.time;
                  div.dataset.index = index;
                  div.textContent = cue.text;
                  div.addEventListener('click', () => {
                      if (this.player && this.player.seekTo) {
                          this.player.seekTo(cue.time, true);
                          this.player.playVideo();
                      }
                  });
                  this.transcriptContainer.appendChild(div);
              });
          }

          setPlayer(player) {
              this.player = player;
          }

          highlightCurrentLine(currentTime) {
              // Find the last cue that started before current time
              const activeIndex = this.cues.findLastIndex(cue => cue.time <= currentTime);
              
              if (activeIndex !== -1) {
                  const lines = this.transcriptContainer.children;
                  
                  // Remove highlight from all
                  Array.from(lines).forEach(line => line.classList.remove('highlight'));
                  
                  // Add highlight to current
                  const activeLine = lines[activeIndex];
                  activeLine.classList.add('highlight');
                  
                  // Auto-scroll logic
                  if (!this.isAutoScrolling) {
                      this.isAutoScrolling = true;
                      
                      // Calculate position to center the highlighted element within the container
                      const containerHeight = this.transcriptContainer.clientHeight;
                      const lineTop = activeLine.offsetTop;
                      const lineHeight = activeLine.clientHeight;
                      const containerTop = this.transcriptContainer.offsetTop; // Offset relative to parent
                      
                      // Standard scrollIntoView with block: 'center' works well, but we need
                      // to ensure it doesn't scroll the whole page.
                      // The container has overflow-y-auto, so basic calculation is safer.
                      
                      const scrollTarget = (lineTop - this.transcriptContainer.offsetTop) - (containerHeight / 2) + (lineHeight / 2);
                      
                      this.transcriptContainer.scrollTo({
                          top: Math.max(0, scrollTarget),
                          behavior: 'smooth'
                      });

                      setTimeout(() => {
                          this.isAutoScrolling = false;
                      }, 500);
                  }
              }
          }

          setupHeightSync() {
              const videoContainer = document.querySelector('.relative.w-full'); // The wrapper with padding-bottom
              
              const syncHeight = () => {
                  // Only sync on desktop (lg breakpoint in Tailwind is 1024px)
                  if (window.innerWidth >= 1024 && videoContainer) {
                      // Get the computed height of the video container
                      const videoHeight = videoContainer.getBoundingClientRect().height;
                      
                      // The parent of transcript-container includes the header (h3),
                      // so we set the parent's height to match video, then flex takes care of the rest.
                      const transcriptWrapper = this.transcriptContainer.parentElement;
                      transcriptWrapper.style.height = `${videoHeight}px`;
                  } else {
                      // Reset for mobile
                      const transcriptWrapper = this.transcriptContainer.parentElement;
                      transcriptWrapper.style.height = ''; // Fallback to CSS class (h-96 or auto)
                  }
              };

              // Initial sync
              // We need a small delay to ensure the video iframe has established its ratio
              setTimeout(syncHeight, 100);
              
              // Sync on resize with debounce
              let resizeTimer;
              window.addEventListener('resize', () => {
                  clearTimeout(resizeTimer);
                  resizeTimer = setTimeout(syncHeight, 250);
              });
          }
      }

      // 3. Initialize
      let transcriptManager;
      let player;

      function onYouTubeIframeAPIReady() {
          transcriptManager = new TranscriptManager(vttData, 'video-player', 'transcript-container');
          
          player = new YT.Player('video-player', {
              events: {
                  'onReady': onPlayerReady,
                  'onStateChange': onPlayerStateChange
              }
          });
          
          transcriptManager.setPlayer(player);
      }

      function onPlayerReady(event) {
          setInterval(() => {
              if (player && player.getCurrentTime) {
                  const time = player.getCurrentTime();
                  transcriptManager.highlightCurrentLine(time);
              }
          }, 250);
      }

      function onPlayerStateChange(event) {
          // Optional: Handle state changes (play/pause) if needed
      }

      // --- Tab Interaction Logic (Existing functionality preservation) ---
      document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('[role="tab"]');
        const panels = document.querySelectorAll('[role="tabpanel"]');

        tabs.forEach(tab => {
          tab.addEventListener('click', function(e) {
            // Deselect all tabs
            tabs.forEach(t => {
              t.setAttribute('aria-selected', 'false');
              t.classList.remove('border-blue-500', 'text-blue-600');
              t.classList.add('border-transparent', 'text-gray-500');
            });

            // Hide all panels
            panels.forEach(p => p.classList.add('hidden'));

            // Select clicked tab
            this.setAttribute('aria-selected', 'true');
            this.classList.remove('border-transparent', 'text-gray-500');
            this.classList.add('border-blue-500', 'text-blue-600');

            // Show target panel
            const panelId = this.getAttribute('aria-controls');
            document.getElementById(panelId).classList.remove('hidden');
          });

          // Keyboard navigation
          tab.addEventListener('keydown', (e) => {
            let target = null;
            const idx = Array.from(tabs).indexOf(e.target);
            
            if (e.key === 'ArrowRight') {
              target = tabs[(idx + 1) % tabs.length];
            } else if (e.key === 'ArrowLeft') {
              target = tabs[(idx - 1 + tabs.length) % tabs.length];
            }

            if (target) {
              target.focus();
              target.click();
            }
          });
        });
      });
    </script>
  </body>
</html>
