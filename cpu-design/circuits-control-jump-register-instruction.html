<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuits: Jump Register-Only</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      
      * {
        font-family: 'Inter', sans-serif;
      }
      
      body {
        background-color: #FDFBF8;
        color: #1A1A1A;
      }
      
      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: #2563EB;
        color: white;
        padding: 0.5rem 1rem;
        text-decoration: none;
        border-radius: 0 0 4px 0;
        z-index: 1000;
      }
      
      .skip-link:focus {
        top: 0;
      }
      
      h1, h2, h3 {
        color: #1A1A1A;
      }
      
      h1 {
        font-size: 2.25rem;
        font-weight: 700;
        line-height: 1.2;
      }
      
      h2 {
        font-size: 1.875rem;
        font-weight: 600;
        line-height: 1.3;
      }
      
      h3 {
        font-size: 1.25rem;
        font-weight: 600;
        line-height: 1.4;
      }
      
      p {
        font-size: 1rem;
        line-height: 1.6;
        color: #1A1A1A;
      }
      
      a {
        color: #2563EB;
        text-decoration: none;
        font-weight: 500;
      }
      
      a:hover {
        text-decoration: underline;
      }
      
      ul {
        list-style-type: disc;
        margin-left: 1.5rem;
      }
      
      li {
        margin-bottom: 0.75rem;
        line-height: 1.6;
      }
      
      figure {
        margin: 1.5rem 0;
      }
      
      figcaption {
        font-size: 0.875rem;
        color: #4B5563;
        font-style: italic;
        margin-top: 0.5rem;
        text-align: center;
      }
      
      img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        border: 1px solid #E5E7EB;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        display: block;
        margin: 0 auto;
      }

      /* Table Styling */
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1.5rem 0;
      }

      th, td {
        border: 1px solid #D1D5DB;
        padding: 0.75rem;
        text-align: center;
      }

      th {
        background-color: #E5E7EB;
        font-weight: 600;
        color: #1A1A1A;
      }

      td {
        background-color: #FFFFFF;
      }

      /* Accessible Tab Styling */
      .tabs-container {
        margin-bottom: 2rem;
      }

      [role="tablist"] {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        border-bottom: 2px solid #D1D5DB;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      [role="tab"] {
        padding: 0.75rem 1.25rem;
        background-color: #F3F4F6;
        border: 1px solid #D1D5DB;
        border-bottom: none;
        border-radius: 0.5rem 0.5rem 0 0;
        cursor: pointer;
        font-weight: 500;
        color: #1A1A1A;
        transition: all 0.2s ease;
        margin-bottom: -2px;
      }

      [role="tab"]:hover {
        background-color: #E5E7EB;
      }

      [role="tab"][aria-selected="true"] {
        background-color: #2563EB;
        color: #FFFFFF;
        border-color: #2563EB;
        border-bottom-color: #FDFBF8;
      }

      [role="tab"]:focus-visible {
        outline: 2px solid #2563EB;
        outline-offset: 2px;
      }

      [role="tabpanel"] {
        display: none;
        padding: 2rem 0;
        animation: fadeIn 0.2s ease;
      }

      [role="tabpanel"][data-active="true"] {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      [role="tabpanel"] h2 {
        margin-top: 0;
      }
    </style>
  </head>
  <body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <main id="main-content" class="container mx-auto px-4 py-12 max-w-4xl">
      <!-- Page Header -->
      <header class="mb-10">
        <h1 class="text-4xl font-bold mb-4">Circuits: Jump Register-Only</h1>
        <p class="text-lg text-gray-700">Before we begin, we first have to define how our Instruction Register works for Jump Register Instructions.</p>
      </header>

      <!-- Accessible Tab Interface -->
      <div class="tabs-container">
        <div role="tablist" aria-label="Content sections">
          <button role="tab" 
                  id="tab-instructions" 
                  aria-selected="true" 
                  aria-controls="panel-instructions">
            Jump Register Instructions
          </button>
          <button role="tab" 
                  id="tab-control-unit" 
                  aria-selected="false" 
                  aria-controls="panel-control-unit">
            Jump Register Control Unit Diagram
          </button>
          <button role="tab" 
                  id="tab-cpu-diagram" 
                  aria-selected="false" 
                  aria-controls="panel-cpu-diagram">
            Jump Register CPU Diagram
          </button>
          <button role="tab" 
                  id="tab-video" 
                  aria-selected="false" 
                  aria-controls="panel-video">
            Jump Register Video
          </button>
        </div>

        <!-- Section 1: Jump Register Instructions -->
        <section role="tabpanel" 
                 id="panel-instructions" 
                 aria-labelledby="tab-instructions"
                 data-active="true">
          <h2 class="text-3xl font-semibold mb-6">Jump Register Instructions</h2>
        
          <p class="mb-6">The Operation instruction is an 8-bit value that is broken down as follows:</p>
          
          <div class="overflow-x-auto mb-6">
            <table>
              <thead>
                <tr>
                  <th style="width: 12.5%;">bit 0</th>
                  <th style="width: 12.5%;">bit 1</th>
                  <th style="width: 12.5%;">bit 2</th>
                  <th style="width: 12.5%;">bit 3</th>
                  <th style="width: 12.5%;">bit 4</th>
                  <th style="width: 12.5%;">bit 5</th>
                  <th style="width: 12.5%;">bit 6</th>
                  <th style="width: 12.5%;">bit 7</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0 for Non-ALU Instr.</td>
                  <td>0</td>
                  <td>1</td>
                  <td>1</td>
                  <td>x</td>
                  <td>x</td>
                  <td>Reg B</td>
                  <td>Reg B</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p class="mb-6"><strong>Where:</strong></p>
          <ul class="mb-6 space-y-2">
            <li><strong>bit 0:</strong> When this is 0, then we have either a Load or a Store Instruction</li>
            <li><strong>bits 1-3:</strong> are 011 for a jump register instruction</li>
            <li><strong>bits 4-5:</strong> not used by this operation</li>
            <li><strong>bits 6-7:</strong> define which Register, 0-3, will be used for this operation</li>
          </ul>

          <h3 class="text-xl font-semibold mb-4">Jump Register Instructions:</h3>
          
          <p class="mb-4">What a Jump Register Instruction does is "jumps" to the address defined in Register B. An assembly language mnemonic might be:</p>
          
          <p class="mb-4 bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500"><code class="text-code-gray">JMPR RB</code></p>
          
          <p class="mb-4">where <strong>RB</strong> is the Register, R0-R3, defined by bits 6 and 7.</p>
          
          <p class="text-lg">This instruction will let us jump about rather than just incrementing the location by 1 as we have done so far.</p>
        </section>

        <!-- Section 2: Jump Register Control Unit Diagram -->
        <section role="tabpanel" 
                 id="panel-control-unit" 
                 aria-labelledby="tab-control-unit"
                 data-active="false">
          <h2 class="text-3xl font-semibold mb-6">Jump Register Instruction Control Unit Diagram</h2>
          
          <p class="mb-6">The actual Control unit for this system appears below. Please note that the following elements have been added and/or removed from this control unit that was not in the previous ones:</p>
          
          <ul class="mb-8 space-y-2">
            <li>Since the Data Instruction is 011 (or 3), we are only wiring up the output for this from the 3x8 decoder</li>
          </ul>

          <figure class="my-6">
            <img id="381100" 
                 src="images/control-unit-diagram-jump-register.jpg" 
                 alt="Jump Register Control Unit Circuit Diagram showing decoder output wiring for instruction 011" 
                 class="max-w-full h-auto rounded-lg border border-gray-300 shadow-sm mx-auto"
                 style="max-width: 640px;"
                 loading="lazy">
            <figcaption>Jump Register Control Unit Circuit Diagram</figcaption>
          </figure>
        </section>

        <!-- Section 3: Jump Register CPU Diagram -->
        <section role="tabpanel" 
                 id="panel-cpu-diagram" 
                 aria-labelledby="tab-cpu-diagram"
                 data-active="false">
          <h2 class="text-3xl font-semibold mb-6">CPU for Jump Register Instruction</h2>
          
          <p class="mb-6">The temporary modifications included here include:</p>
          
          <ul class="mb-8 space-y-2">
            <li>Disconnect the Register we are going to use as RB in the Jump Register Instruction (and fix the "set" at 1)</li>
            <li>Removing IR from the BUS so can manually set the value (IR_S is 1)</li>
          </ul>

          <figure class="my-6">
            <img id="381099" 
                 src="images/cpu-diagram-jump-register.jpg" 
                 alt="Jump Register CPU Circuit Diagram showing register disconnection and IR bus modifications" 
                 class="max-w-full h-auto rounded-lg border border-gray-300 shadow-sm mx-auto"
                 style="max-width: 640px;"
                 loading="lazy">
            <figcaption>Jump Register CPU Circuit Diagram</figcaption>
          </figure>
        </section>

        <!-- Section 4: Video Description of Operation -->
        <section role="tabpanel" 
                 id="panel-video" 
                 aria-labelledby="tab-video"
                 data-active="false">
          <h2 class="text-3xl font-semibold mb-6">Video Description of Operation</h2>
          
          <p class="mb-6">The following video walks through the details of the Jump Register Instruction Operation. Use the transcript panel to navigate the video or click any transcript line to jump to that moment.</p>
          
          <!-- Video and Transcript Container -->
          <div class="flex flex-col lg:flex-row gap-4 w-full my-6">
            <!-- Video Player Section: 66% width on large screens -->
            <div class="w-full lg:w-2/3 flex-shrink-0">
              <div id="video-container" style="width: 100%; height: 0; padding-bottom: 56.25%; position: relative;">
                <iframe id="youtube-player"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        src="https://www.youtube.com/embed/MsYq6yor3Ag?enablejsapi=1"
                        title="Jump Register Instruction: Detailed Walkthrough of Jump Operations and Register Selection"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        referrerpolicy="strict-origin-when-cross-origin"
                        allowfullscreen>
                </iframe>
              </div>
            </div>

            <!-- Transcript Container Section: 33% width on large screens -->
            <div class="w-full lg:w-1/3 flex-shrink-0">
              <div id="transcript-container" class="h-96 overflow-y-scroll bg-white shadow-inner p-4 rounded-lg border border-gray-300">
                <p class="text-gray-500 text-center">Loading transcript...</p>
              </div>
            </div>
          </div>

          <!-- CSS for highlighting the active line -->
          <style>
            .active-transcript-line {
              background-color: #f0f7ff;
              font-weight: 600;
              border-left: 4px solid #1e88e5;
              padding-left: 12px;
              transition: background-color 0.2s;
            }
          </style>
        </section>
      </div>    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t border-gray-300 mt-12 py-6">
      <div class="container mx-auto px-4 max-w-4xl text-center text-sm text-gray-600">
        <p>CSC210: Computer Organization & Architecture</p>
      </div>
    </footer>

    <!-- Tab Functionality and YouTube Transcript Sync Script -->
    <script>
      // ============== TAB SWITCHING LOGIC ==============
      document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('[role="tab"]');
        const panels = document.querySelectorAll('[role="tabpanel"]');

        // Click handler for tabs
        tabs.forEach(tab => {
          tab.addEventListener('click', function() {
            const tabId = this.id;
            const panelId = this.getAttribute('aria-controls');

            // Hide all panels
            panels.forEach(panel => {
              panel.setAttribute('data-active', 'false');
            });

            // Deselect all tabs
            tabs.forEach(t => {
              t.setAttribute('aria-selected', 'false');
            });

            // Show selected panel
            const selectedPanel = document.getElementById(panelId);
            if (selectedPanel) {
              selectedPanel.setAttribute('data-active', 'true');
            }

            // Select clicked tab
            this.setAttribute('aria-selected', 'true');
            this.focus();

            // Initialize transcript when video tab is opened
            if (panelId === 'panel-video') {
              initializeVideoTranscript();
            }
          });
        });

        // Keyboard navigation (Arrow keys)
        tabs.forEach((tab, index) => {
          tab.addEventListener('keydown', function(e) {
            let targetTab = null;

            switch(e.key) {
              case 'ArrowLeft':
              case 'ArrowUp':
                e.preventDefault();
                // Go to previous tab
                targetTab = index > 0 ? tabs[index - 1] : tabs[tabs.length - 1];
                break;
              case 'ArrowRight':
              case 'ArrowDown':
                e.preventDefault();
                // Go to next tab
                targetTab = index < tabs.length - 1 ? tabs[index + 1] : tabs[0];
                break;
              case 'Home':
                e.preventDefault();
                targetTab = tabs[0];
                break;
              case 'End':
                e.preventDefault();
                targetTab = tabs[tabs.length - 1];
                break;
            }

            if (targetTab) {
              targetTab.click();
            }
          });
        });
      });

      // ============== YOUTUBE TRANSCRIPT SYNC LOGIC ==============
      const VIDEO_ID = 'MsYq6yor3Ag';
      let player;
      let timeUpdater;
      let parsedTranscript = [];
      let videoInitialized = false;

      // --- RAW VTT CONTENT ---
      const vttContent = `WEBVTT

00:00.000 --> 00:11.120
Aloha in this little video I want to talk about the jump register command and

00:11.120 --> 00:16.620
operation and how it works and so let's look at the code first so jump register

00:16.620 --> 00:21.600
is zero zero one one are the first four bits the next two bits are not used and

00:21.600 --> 00:29.320
then the last two are to define register B in our control unit and what happens

00:29.320 --> 00:34.480
is so we use jump register register B which basically what we're going to do

00:34.480 --> 00:40.240
is we're going to take the value stored in register B and it's going to be a

00:40.240 --> 00:44.180
memory address and we're going to stick that into our program counter meaning

00:44.180 --> 00:51.280
this is the address for the next instruction okay so today what we've

00:51.280 --> 00:55.780
been doing is just adding one through the accumulator because all the

00:55.780 --> 00:59.100
instructions we're assuming are right next to each other well when we have to

00:59.100 --> 00:59.300
jump register B we're going to take the value stored in register B and we're going to

00:59.300 --> 01:04.760
jump somewhere that next instruction might not be the next line or the next

01:04.760 --> 01:11.120
byte so we can stick that value into like using store and load we can stick

01:11.120 --> 01:18.800
that value into a register and then we can use jump register to jump our code

01:18.800 --> 01:25.040
executable code from where it is in RAM to that new location all right so how

01:25.040 --> 01:29.080
that works in logism

01:29.080 --> 01:34.400
is so we have our CPU and so what we're going to do is hard code this because we

01:34.400 --> 01:36.980
don't really have everything all set up but we're going to hard code this and

01:36.980 --> 01:43.300
say okay so when we jump the register that it needs to go to is like if we did

01:43.300 --> 01:51.060
all one it would be by 256 meaning the last one or 255 meaning the very very

01:51.060 --> 01:56.640
last byte in Ram which I don't really even have in my model but it's okay it

01:56.640 --> 01:58.860
doesn't matter and the code is the one we want so our model is empty let's just

01:58.860 --> 02:08.280
is because this is in register three so my RB will be register three and then

02:08.280 --> 02:15.600
believe it zero zero one one I put that up real quick for jump register zero

02:15.600 --> 02:22.680
zero one one for jump register okay so zero zero one one zero zero one one for

02:22.680 --> 02:28.080
register three okay so what we're gonna do is I'm gonna take the program this

02:28.080 --> 02:32.400
value here all ones I'm gonna stick it into the program counter so that the

02:32.400 --> 02:41.580
next cycle through would be a use the instruction at this byte location okay

02:41.580 --> 02:45.160
so if we look at our control unit it's fairly simple all it does we hit the

02:45.160 --> 02:54.540
step it enables register B and then it writes it to it sets it into the program

02:54.540 --> 02:56.560
counter that's really all it does it's not a

02:56.560 --> 02:57.320
super

02:58.080 --> 03:06.140
complex circuit all right so again but though it's starting at four because

03:06.140 --> 03:13.020
this is the one two and three is a fetch so we will go to our CPU and we will get

03:13.020 --> 03:28.080
to four there we're at four okay and so we got four and we did enable so

03:28.080 --> 03:33.080
we're able reg B we just registered three and so everything whatever is in

03:33.080 --> 03:39.700
registry is now on the bus okay so here it is on the bus it's all one it's on

03:39.700 --> 03:44.360
the bus it's not in our program counter yet because they haven't tried to set it

03:44.360 --> 03:50.300
so when we cycle the next one it's set now we've set our program counter and

03:50.300 --> 03:57.940
just taken the value of the bus which is all ones okay so now we're setting and

03:58.080 --> 04:04.060
So it's taking the program counter set value, which is from the bus and sticking it into the program counter.

04:06.640 --> 04:15.640
All right, and that's really the entire cycle for that, okay, for jump register.

04:15.920 --> 04:16.600
That's what you do.

04:16.680 --> 04:23.000
You jump register is where is the next instruction in RAM, okay?

04:23.020 --> 04:26.500
Or if it's a loop, how do I get back to the top of the loop in RAM?

04:26.500 --> 04:30.200
Or if it's a function, where is that function located in RAM?

04:30.740 --> 04:32.080
So that's how that works.`;

      // 2. CORE UTILITIES
      function timeToSeconds(timeStr) {
        if (!timeStr) return 0;
        const parts = timeStr.trim().split(':');
        
        // Handle both MM:SS.mmm and HH:MM:SS.mmm formats
        if (parts.length === 2) {
          // MM:SS.mmm format
          let minutes = parseInt(parts[0]) || 0;
          let seconds = parseFloat(parts[1]) || 0;
          return minutes * 60 + seconds;
        } else if (parts.length === 3) {
          // HH:MM:SS.mmm format
          let hours = parseInt(parts[0]) || 0;
          let minutes = parseInt(parts[1]) || 0;
          let seconds = parseFloat(parts[2]) || 0;
          return hours * 3600 + minutes * 60 + seconds;
        }
        return 0;
      }

      function parseVtt(vttText) {
        const cues = vttText.trim().split(/\n\n+/);
        const parsedCues = [];
        
        cues.forEach(cueBlock => {
          if (cueBlock.startsWith('WEBVTT') || cueBlock.trim() === '') return;
          
          const lines = cueBlock.trim().split('\n');
          const timeLine = lines.find(line => line.includes('-->'));
          if (!timeLine) return;

          const [startTimeStr, endTimeStr] = timeLine.split(' --> ');
          const textLines = lines.slice(lines.indexOf(timeLine) + 1);
          
          parsedCues.push({
            start: timeToSeconds(startTimeStr),
            end: timeToSeconds(endTimeStr),
            text: textLines.join(' ').trim()
          });
        });
        return parsedCues;
      }

      // 3. TRANSCRIPT RENDERING AND INTERACTIVITY
      function populateTranscript() {
        const container = document.getElementById('transcript-container');
        if (!container) return;
        container.innerHTML = '';

        parsedTranscript.forEach(cue => {
          const lineElement = document.createElement('div');
          lineElement.className = 'transcript-line p-2 cursor-pointer hover:bg-gray-100 rounded-lg';
          lineElement.dataset.start = cue.start;
          lineElement.dataset.end = cue.end;
          lineElement.textContent = cue.text;
          lineElement.setAttribute('role', 'button');
          lineElement.setAttribute('tabindex', '0');

          const seekToTime = () => {
            if (player && player.seekTo) {
              player.seekTo(cue.start, true);
              player.playVideo();
            }
          };
          
          lineElement.addEventListener('click', seekToTime);
          lineElement.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') { 
              e.preventDefault(); 
              seekToTime(); 
            }
          });

          container.appendChild(lineElement);
        });
      }

      // 4. SYNC LOGIC
      function highlightCurrentLine() {
        if (!player || !player.getCurrentTime) return;

        const currentTime = player.getCurrentTime();
        const lines = document.querySelectorAll('#transcript-container .transcript-line');

        lines.forEach(line => {
          const start = parseFloat(line.dataset.start);
          const end = parseFloat(line.dataset.end);

          if (currentTime >= start && currentTime < end) {
            if (!line.classList.contains('active-transcript-line')) {
              document.querySelector('.active-transcript-line')?.classList.remove('active-transcript-line');
              line.classList.add('active-transcript-line');
              line.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          } else {
            line.classList.remove('active-transcript-line');
          }
        });
      }

      // 5. HEIGHT SYNCHRONIZATION (Transcript matches video container)
      function syncTranscriptHeight() {
        const mediaQuery = window.matchMedia('(min-width: 1024px)');
        const videoContainer = document.getElementById('video-container');
        const transcriptContainer = document.getElementById('transcript-container');
        
        if (!videoContainer || !transcriptContainer) return;
        
        if (mediaQuery.matches) {
          // On large screens, match the video container height
          const videoHeight = videoContainer.offsetHeight;
          transcriptContainer.style.maxHeight = videoHeight + 'px';
        } else {
          // On mobile, use fixed height
          transcriptContainer.style.maxHeight = '24rem';
        }
      }

      // 6. PLAYER STATE HANDLER
      function onPlayerStateChange(event) {
        clearInterval(timeUpdater);
        if (event.data === YT.PlayerState.PLAYING) {
          timeUpdater = setInterval(highlightCurrentLine, 300);
        }
      }

      // 7. INITIALIZATION
      function initializeVideoTranscript() {
        if (videoInitialized) return;
        videoInitialized = true;

        parsedTranscript = parseVtt(vttContent);
        populateTranscript();
        syncTranscriptHeight();

        if (!player) {
          player = new YT.Player('youtube-player', {
            events: {
              'onStateChange': onPlayerStateChange
            }
          });
        }
      }

      // 8. CENTRAL INITIALIZATION
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof(YT) == 'undefined' || typeof(YT.Player) == 'undefined') {
          const tag = document.createElement('script');
          tag.src = "https://www.youtube.com/iframe_api";
          document.head.appendChild(tag);
          window.onYouTubeIframeAPIReady = initializeVideoTranscript;
        }

        // Handle window resize for transcript height sync
        let resizeTimeout;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(syncTranscriptHeight, 250);
        });
      });
    </script>
  </body>
</html>
